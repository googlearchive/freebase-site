
/*
 * Copyright 2010, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
/*
 
 jQuery Tools @VERSION Overlay - Overlay base. Extend it.

 NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.

 http://flowplayer.org/tools/overlay/

 Since: March 2008
 Date: @DATE 
*/
var CodeMirrorConfig=window.CodeMirrorConfig||{},CodeMirror=function(){function a(g,h){for(var j in h)g.hasOwnProperty(j)||(g[j]=h[j])}function b(g,h){for(var j=0;j<g.length;j++)h(g[j])}function c(g,h){var j=document.createElement("DIV"),l=document.createElement("DIV");j.style.position="absolute";j.style.height="100%";if(j.style.setExpression)try{j.style.setExpression("height","this.previousSibling.offsetHeight + 'px'")}catch(o){}j.style.top="0px";j.style.left="0px";j.style.overflow="hidden";g.appendChild(j);
l.className="CodeMirror-line-numbers";j.appendChild(l);l.innerHTML="<div>"+h+"</div>";return j}function d(g){if(typeof g.parserfile=="string")g.parserfile=[g.parserfile];if(typeof g.basefiles=="string")g.basefiles=[g.basefiles];if(typeof g.stylesheet=="string")g.stylesheet=[g.stylesheet];var h=['<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head>'];h.push('<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>');b(g.stylesheet,function(j){h.push('<link rel="stylesheet" type="text/css" href="'+
j+'"/>')});b(g.basefiles.concat(g.parserfile),function(j){/^https?:/.test(j)||(j=g.path+j);h.push('<script type="text/javascript" src="'+j+(g.noScriptCaching?"?nocache="+(new Date).getTime().toString(16):"")+'"><\/script>')});h.push('</head><body style="border-width: 0;" class="editbox" spellcheck="'+(g.disableSpellcheck?"false":"true")+'"></body></html>');return h.join("")}function e(g,h){this.options=h=h||{};a(h,CodeMirrorConfig);if(h.dumbTabs)h.tabMode="spaces";else if(h.normalTab)h.tabMode="default";
var j=this.frame=document.createElement("IFRAME");if(h.iframeClass)j.className=h.iframeClass;j.frameBorder=0;j.style.border="0";j.style.width="100%";j.style.height="100%";j.style.display="block";var l=this.wrapping=document.createElement("DIV");l.style.position="relative";l.className="CodeMirror-wrapping";l.style.width=h.width;l.style.height=h.height=="dynamic"?h.minHeight+"px":h.height;var o=this.textareaHack=document.createElement("TEXTAREA");l.appendChild(o);o.style.position="absolute";o.style.left=
"-10000px";o.style.width="10px";j.CodeMirror=this;if(h.domain&&f){this.html=d(h);j.src="javascript:(function(){document.open();"+(h.domain?'document.domain="'+h.domain+'";':"")+"document.write(window.frameElement.CodeMirror.html);document.close();})()"}else j.src="javascript:;";g.appendChild?g.appendChild(l):g(l);l.appendChild(j);if(h.lineNumbers)this.lineNumbers=c(l,h.firstLineNumber);this.win=j.contentWindow;if(!h.domain||!f){this.win.document.open();this.win.document.write(d(h));this.win.document.close()}}
a(CodeMirrorConfig,{stylesheet:[],path:"",parserfile:[],basefiles:["util.js","stringstream.js","select.js","undo.js","editor.js","tokenize.js"],iframeClass:null,passDelay:200,passTime:50,lineNumberDelay:200,lineNumberTime:50,continuousScanning:false,saveFunction:null,onChange:null,undoDepth:50,undoDelay:800,disableSpellcheck:true,textWrapping:true,readOnly:false,width:"",height:"300px",minHeight:100,autoMatchParens:false,parserConfig:null,tabMode:"indent",enterMode:"indent",electricChars:true,reindentOnLoad:false,
activeTokens:null,cursorActivity:null,lineNumbers:false,firstLineNumber:1,indentUnit:2,domain:null,noScriptCaching:false});var f=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);e.prototype={init:function(){this.options.initCallback&&this.options.initCallback(this);this.options.lineNumbers&&this.activateLineNumbers();this.options.reindentOnLoad&&this.reindent();this.options.height=="dynamic"&&this.setDynamicHeight()},getCode:function(){return this.editor.getCode()},setCode:function(g){this.editor.importCode(g)},
selection:function(){this.focusIfIE();return this.editor.selectedText()},reindent:function(){this.editor.reindent()},reindentSelection:function(){this.focusIfIE();this.editor.reindentSelection(null)},focusIfIE:function(){this.win.select.ie_selection&&this.focus()},focus:function(){this.win.focus();this.editor.selectionSnapshot&&this.win.select.setBookmark(this.win.document.body,this.editor.selectionSnapshot)},replaceSelection:function(g){this.focus();this.editor.replaceSelection(g);return true},replaceChars:function(g,
h,j){this.editor.replaceChars(g,h,j)},getSearchCursor:function(g,h,j){return this.editor.getSearchCursor(g,h,j)},undo:function(){this.editor.history.undo()},redo:function(){this.editor.history.redo()},historySize:function(){return this.editor.history.historySize()},clearHistory:function(){this.editor.history.clear()},grabKeys:function(g,h){this.editor.grabKeys(g,h)},ungrabKeys:function(){this.editor.ungrabKeys()},setParser:function(g,h){this.editor.setParser(g,h)},setSpellcheck:function(g){this.win.document.body.spellcheck=
g},setStylesheet:function(g){if(typeof g==="string")g=[g];for(var h={},j={},l=this.win.document.getElementsByTagName("link"),o=0,n;n=l[o];o++)if(n.rel.indexOf("stylesheet")!==-1)for(var k=0;k<g.length;k++){var m=g[k];if(n.href.substring(n.href.length-m.length)===m){h[n.href]=true;j[m]=true}}for(o=0;n=l[o];o++)if(n.rel.indexOf("stylesheet")!==-1)n.disabled=!(n.href in h);for(k=0;k<g.length;k++){m=g[k];if(!(m in j)){n=this.win.document.createElement("link");n.rel="stylesheet";n.type="text/css";n.href=
m;this.win.document.getElementsByTagName("head")[0].appendChild(n)}}},setTextWrapping:function(g){if(g!=this.options.textWrapping){this.win.document.body.style.whiteSpace=g?"":"nowrap";this.options.textWrapping=g;if(this.lineNumbers){this.setLineNumbers(false);this.setLineNumbers(true)}}},setIndentUnit:function(g){this.win.indentUnit=g},setUndoDepth:function(g){this.editor.history.maxDepth=g},setTabMode:function(g){this.options.tabMode=g},setEnterMode:function(g){this.options.enterMode=g},setLineNumbers:function(g){if(g&&
!this.lineNumbers){this.lineNumbers=c(this.wrapping,this.options.firstLineNumber);this.activateLineNumbers()}else if(!g&&this.lineNumbers){this.wrapping.removeChild(this.lineNumbers);this.wrapping.style.paddingLeft="";this.lineNumbers=null}},cursorPosition:function(g){this.focusIfIE();return this.editor.cursorPosition(g)},firstLine:function(){return this.editor.firstLine()},lastLine:function(){return this.editor.lastLine()},nextLine:function(g){return this.editor.nextLine(g)},prevLine:function(g){return this.editor.prevLine(g)},
lineContent:function(g){return this.editor.lineContent(g)},setLineContent:function(g,h){this.editor.setLineContent(g,h)},removeLine:function(g){this.editor.removeLine(g)},insertIntoLine:function(g,h,j){this.editor.insertIntoLine(g,h,j)},selectLines:function(g,h,j,l){this.win.focus();this.editor.selectLines(g,h,j,l)},nthLine:function(g){for(var h=this.firstLine();g>1&&h!==false;g--)h=this.nextLine(h);return h},lineNumber:function(g){for(var h=0;g!==false;){h++;g=this.prevLine(g)}return h},jumpToLine:function(g){if(typeof g==
"number")g=this.nthLine(g);this.selectLines(g,0);this.win.focus()},currentLine:function(){return this.lineNumber(this.cursorLine())},cursorLine:function(){return this.cursorPosition().line},cursorCoords:function(g){return this.editor.cursorCoords(g)},activateLineNumbers:function(){function g(){if(n.offsetWidth!=0){for(var p=n;p.parentNode;p=p.parentNode);if(!q.parentNode||p!=document||!k.Editor){try{w()}catch(t){}clearInterval(z)}else if(q.offsetWidth!=A){A=q.offsetWidth;n.parentNode.style.paddingLeft=
A+"px"}}}function h(){q.scrollTop=r.scrollTop||m.documentElement.scrollTop||0}function j(p){var t=v.firstChild.offsetHeight;if(t!=0){t=Math.ceil((50+Math.max(r.offsetHeight,Math.max(n.offsetHeight,r.scrollHeight||0)))/t);for(var s=v.childNodes.length;s<=t;s++){var y=document.createElement("DIV");y.appendChild(document.createTextNode(p?String(s+u.options.firstLineNumber):"\u00a0"));v.appendChild(y)}}}function l(){function p(){j(true);h()}u.updateNumbers=p;var t=k.addEventHandler(k,"scroll",h,true),
s=k.addEventHandler(k,"resize",p,true);w=function(){t();s();if(u.updateNumbers==p)u.updateNumbers=null};p()}function o(){function p(F,I){D||(D=v.appendChild(document.createElement("DIV")));K&&K(D,I,F);G.push(D);G.push(F);J=D.offsetHeight+D.offsetTop;D=D.nextSibling}function t(){for(var F=0;F<G.length;F+=2)G[F].innerHTML=G[F+1];G=[]}function s(){if(!(!v.parentNode||v.parentNode!=u.lineNumbers)){for(var F=(new Date).getTime()+u.options.lineNumberTime;C;){for(p(E++,C.previousSibling);C&&!k.isBR(C);C=
C.nextSibling)for(var I=C.offsetTop+C.offsetHeight;v.offsetHeight&&I-3>J;)p("&nbsp;");if(C)C=C.nextSibling;if((new Date).getTime()>F){t();H=setTimeout(s,u.options.lineNumberDelay);return}}for(;D;)p(E++);t();h()}}function y(F){h();j(F);C=r.firstChild;D=v.firstChild;J=0;E=u.options.firstLineNumber;s()}function B(){H&&clearTimeout(H);if(u.editor.allClean())y();else H=setTimeout(B,200)}var C,D,E,J,G=[],K=u.options.styleNumbers;y(true);var H=null;u.updateNumbers=B;var L=k.addEventHandler(k,"scroll",h,
true),M=k.addEventHandler(k,"resize",B,true);w=function(){H&&clearTimeout(H);if(u.updateNumbers==B)u.updateNumbers=null;L();M()}}var n=this.frame,k=n.contentWindow,m=k.document,r=m.body,q=this.lineNumbers,v=q.firstChild,u=this,A=null,w=function(){};g();var z=setInterval(g,500);(this.options.textWrapping||this.options.styleNumbers?o:l)()},setDynamicHeight:function(){function g(){for(var r=0,q=o.lastChild,v;q&&l.isBR(q);){q.hackBR||r++;q=q.previousSibling}if(q){n=q.offsetHeight;v=q.offsetTop+(1+r)*
n}else if(n)v=r*n;if(v)h.wrapping.style.height=Math.max(m+v,h.options.minHeight)+"px"}var h=this,j=h.options.cursorActivity,l=h.win,o=l.document.body,n=null,k=null,m=2*h.frame.offsetTop;o.style.overflowY="hidden";l.document.documentElement.style.overflowY="hidden";this.frame.scrolling="no";setTimeout(g,300);h.options.cursorActivity=function(r){j&&j(r);clearTimeout(k);k=setTimeout(g,100)}}};e.InvalidLineHandle={toString:function(){return"CodeMirror.InvalidLineHandle"}};e.replace=function(g){if(typeof g==
"string")g=document.getElementById(g);return function(h){g.parentNode.replaceChild(h,g)}};e.fromTextArea=function(g,h){if(typeof g=="string")g=document.getElementById(g);h=h||{};if(g.style.width&&h.width==null)h.width=g.style.width;if(g.style.height&&h.height==null)h.height=g.style.height;if(h.content==null)h.content=g.value;if(g.form){var j=function(){g.value=n.getCode()};typeof g.form.addEventListener=="function"?g.form.addEventListener("submit",j,false):g.form.attachEvent("onsubmit",j);var l=g.form.submit,
o=function(){j();g.form.submit=l;g.form.submit();g.form.submit=o};g.form.submit=o}g.style.display="none";var n=new e(function(k){g.nextSibling?g.parentNode.insertBefore(k,g.nextSibling):g.parentNode.appendChild(k)},h);n.toTextArea=function(){j();g.parentNode.removeChild(n.wrapping);g.style.display="";if(g.form){g.form.submit=l;typeof g.form.removeEventListener=="function"?g.form.removeEventListener("submit",j,false):g.form.detachEvent("onsubmit",j)}};return n};e.isProbablySupported=function(){var g;
return window.opera?Number(window.opera.version())>=9.52:/Apple Computer, Inc/.test(navigator.vendor)&&(g=navigator.userAgent.match(/Version\/(\d+(?:\.\d+)?)\./))?Number(g[1])>=3:document.selection&&window.ActiveXObject&&(g=navigator.userAgent.match(/MSIE (\d+(?:\.\d*)?)\b/))?Number(g[1])>=6:(g=navigator.userAgent.match(/gecko\/(\d{8})/i))?Number(g[1])>=20050901:(g=navigator.userAgent.match(/AppleWebKit\/(\d+)/))?Number(g[1])>=525:null};return e}();
(function(){var a=window.mjt,b=window.mjt={};b.noConflict=function(){window.mjt=a;return b};b.NAME="mjt";b.VERSION="0.9.3";b.LICENSE="========================================================================\nCopyright (c) 2007-2009, Metaweb Technologies, Inc.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY METAWEB TECHNOLOGIES ``AS IS'' AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\nPURPOSE ARE DISCLAIMED. IN NO EVENT SHALL METAWEB TECHNOLOGIES BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\nWHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\nOR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN\nIF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n========================================================================\n"})();
var JSON=JSON||{};
(function(){function a(l){return l<10?"0"+l:l}function b(l){e.lastIndex=0;return e.test(l)?'"'+l.replace(e,function(o){var n=h[o];return typeof n==="string"?n:"\\u"+("0000"+o.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+l+'"'}function c(l,o){var n,k,m,r,q=f,v,u=o[l];if(u&&typeof u==="object"&&typeof u.toJSON==="function")u=u.toJSON(l);if(typeof j==="function")u=j.call(o,l,u);switch(typeof u){case "string":return b(u);case "number":return isFinite(u)?String(u):"null";case "boolean":case "null":return String(u);case "object":if(!u)return"null";
f+=g;v=[];if(Object.prototype.toString.apply(u)==="[object Array]"){r=u.length;for(n=0;n<r;n+=1)v[n]=c(n,u)||"null";m=v.length===0?"[]":f?"[\n"+f+v.join(",\n"+f)+"\n"+q+"]":"["+v.join(",")+"]";f=q;return m}if(j&&typeof j==="object"){r=j.length;for(n=0;n<r;n+=1){k=j[n];if(typeof k==="string")if(m=c(k,u))v.push(b(k)+(f?": ":":")+m)}}else for(k in u)if(Object.hasOwnProperty.call(u,k))if(m=c(k,u))v.push(b(k)+(f?": ":":")+m);m=v.length===0?"{}":f?"{\n"+f+v.join(",\n"+f)+"\n"+q+"}":"{"+v.join(",")+"}";
f=q;return m}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return this.valueOf()?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},j;if(typeof JSON.stringify!=="function")JSON.stringify=function(l,o,n){var k;g=f="";if(typeof n==="number")for(k=0;k<n;k+=1)g+=" ";else if(typeof n==="string")g=n;if((j=o)&&typeof o!=="function"&&(typeof o!=="object"||typeof o.length!=="number"))throw new Error("JSON.stringify");return c("",
{"":l})};if(typeof JSON.parse!=="function")JSON.parse=function(l,o){function n(m,r){var q,v,u=m[r];if(u&&typeof u==="object")for(q in u)if(Object.hasOwnProperty.call(u,q)){v=n(u,q);if(v!==undefined)u[q]=v;else delete u[q]}return o.call(m,r,u)}var k;d.lastIndex=0;if(d.test(l))l=l.replace(d,function(m){return"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(l.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){k=eval("("+l+")");return typeof o==="function"?n({"":k},""):k}throw new SyntaxError("JSON.parse");}})();
(function(a){if(typeof a.services=="undefined")a.services={};a.debug=0;var b={};a.uniqueid=function(d){var e=b[d];if(typeof e!=="number")e=1;b[d]=e+1;return d+"_"+e};var c=function(d,e){var f=document.createElement("div"),g,h;g=document.createElement("h3");g.style.backgroundColor="#fff0f0";g.appendChild(document.createTextNode(d));f.appendChild(g);for(var j=0;j<e.length;j++){var l=e[j];if(l instanceof Array){g=document.createElement("div");g.innerHTML=a.flatten_markup(l)}else{g=document.createElement("pre");
if(typeof l=="string")h=l;else try{h=JSON.stringify(l)}catch(o){h=""+l}h=h.replace(/\r?\n/g,"\r\n");g.appendChild(document.createTextNode(h))}f.appendChild(g)}(g=document.getElementById("mjt_debug_output"))||(g=document.getElementsByTagName("body")[0]);g&&g.appendChild(f)};(function(){function d(f){return Array.prototype.slice.apply(f).join(" ")}if(typeof console!="object"||typeof console.log=="undefined")if(typeof document!="undefined"){a.error=function(){c("error",arguments);return""};a.warn=function(){c("warning",
arguments);return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}else{if(typeof Packages!="undefined"){var e=java.lang.System.err;a.error=function(){e.println("error: "+d(arguments));return""};a.warn=function(){e.println("error: "+d(arguments));return""};a.log=function(){e.println("log: "+d(arguments));return""};a.note=function(){e.println("note: "+d(arguments));return""};a.openlog=function(){return""};
a.closelog=function(){return""};a.assert=function(){return""}}}else if(typeof console.debug=="function"){a.error=function(){console.error.apply(console,arguments);return""};a.warn=function(){console.warn.apply(console,arguments);return""};a.log=function(){console.log.apply(console,arguments);return""};a.note=function(){a.debug&&console.info.apply(console,arguments);return""};a.openlog=typeof console.group!="undefined"?function(){a.debug&&console.group.apply(console,arguments)}:a.log;a.closelog=typeof console.groupEnd!=
"undefined"?function(){a.debug&&console.groupEnd.apply(console,arguments);return""}:function(){return""};a.assert=function(f){if(!f){console.error.apply(console,arguments);throw new Error("assertion failed");}return""}}else{a.error=function(){console.log("error: "+d(arguments));return""};a.warn=function(){console.log("warning: "+d(arguments));return""};a.log=function(){return""};a.note=function(){return""};a.openlog=function(){return""};a.closelog=function(){return""};a.assert=function(){return""}}})();
a.formquote=function(d){if(/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(d))return d;return encodeURIComponent(d).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g")};a.formencode=function(d){var e=[],f="",g,h,j,l=[];for(g in d)l.push(g);l.sort();for(j in l){g=l[j];h=d[g];if(typeof h!="undefined"){h instanceof Array||(h=[h]);for(var o=0;o<h.length;o++){var n=h[o];e.push(f);f="&";e.push(a.formquote(g));e.push("=");e.push(a.formquote(n))}}}return e.join("")};
a.formdecode=function(d){if(typeof d=="undefined"||d===null)return{};d=d.replace(/^\s*/m,"").replace(/\s+$/m,"");if(d=="")return{};var e={};d=d.split("&");for(var f=0;f<d.length;f++){var g=d[f].indexOf("=");if(g<1)a.log('bad uri query argument, missing "=": ',d[f]);else{var h=[d[f].substring(0,g),d[f].substring(g+1)];g=decodeURIComponent(h[0].replace(/\+/g," "));h=decodeURIComponent(h[1].replace(/\+/g," "));if(g in e)if(e[g]instanceof Array)e[g].push(h);else e[g]=[e[g],h];else e[g]=h}}return e};a.form_url=
function(d,e){if(!(e&&a.formencode(e)))return d;return d+"?"+a.formencode(e)};a.htmlencode=function(d){if(typeof d!="string")d=""+d;return d.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;")};a.label_package=function(d){var e=window;if(d){for(var f=d.split(".");f.length;)e=e[f.shift()];if(typeof e=="function")e=e.prototype;if((typeof e=="object"||typeof e=="function")&&e!==null)e._package_name=d;else a.log("missing package",d)}for(var g in e){f=e[g];if(a&&
a.Task&&f&&typeof f!="string"&&!f.nodeName&&f.constructor!=Array&&/function/i.test(f+"")&&typeof f.prototype=="object"&&f.prototype instanceof a.Task)f.prototype._task_class=d+"."+g}}})(mjt);
(function(a){var b=["safe_constructor_token"],c=function(e){return!!e&&typeof e!="string"&&!e.nodeName&&e.constructor!=Array&&/function/i.test(e+"")},d=function(e){var f=[];if(typeof e!="array")for(var g=0,h=e.length;g<h;g++)f.push(e[g]);else f=e.slice(0);return f};a.thunk=function(){return a.vthunk(arguments)};a.vthunk=function(){var e,f,g;f=arguments[0];g=typeof f=="object"&&typeof f.length=="number"?d(f):d(arguments);f=g.shift();if(typeof f=="string"){e=g.shift();f=f;c(e[f])||a.warn("mjt.thunk:",
f,"is not a method of",e)}else{e=null;f=f;c(f)||a.error("mjt.thunk:",f,"is not a function")}var h=arguments.callee._next_thunk_id||1;arguments.callee._next_thunk_id=h+1;var j=function(){var l=arguments.callee,o=l.bound_args.concat(d(arguments)),n=l.bound_this===null?this:l.bound_this,k=l.bound_func;if(typeof k=="string")k=n[k];c(k)||a.error("mjt.thunk: bad function",l,l.bound_func,n);return k.apply(n,o)};j.bound_this=e;j.bound_func=f;j.bound_args=g;j.thunk_id=h;return j};a.vcall=function(e){var f=
d(arguments).slice(1);return a.vthunk(e).apply(this,f)};a.vapply=function(e,f){return a.vthunk(e).apply(this,f)};a.Task=function(){if(arguments.length!==1||arguments[0]!==b){a.error("new mjt.Task() is illegal");throw new Error("don't call mjt.Task()");}};a.Task.prototype.toString=function(){return"["+this._task_id+"]"};a.Task.prototype.toMarkup=function(){return'<span class="mjt_task">task '+this._task_id+":"+this.state+"</span>"};if(typeof Object.getPrototypeOf!=="function")Object.getPrototypeOf=
typeof"test".__proto__==="object"?function(e){return e.__proto__}:function(e){return e.constructor.prototype};a.define_task=function(e,f){var g=function(){var h,j=d(arguments);if(this instanceof arguments.callee)if(j.length!==1||j[0]!==b)throw new Error("Task class should not be invoked with new ()");else return;else{h=new arguments.callee(b);h._factory=this}for(var l=[],o=arguments.callee;o!==undefined;o=o.__super)l.push(o);for(;l.length;){o=l.pop();o.prototype.hasOwnProperty("init")&&o.prototype.init.apply(h,
j)}typeof arguments.callee._auto_enqueue!="undefined"&&h.enqueue();return h};if(!e)e=a.Task;g.prototype=new e(b);g.prototype.constructor=g;g.__super=e;g.prototype.parameters=f||[];return g};a.Task._default_timeout=1E4;a.Task.pending=null;a.Task._on_pending_empty=[];a.Task.add_pending=function(e){if(this.pending==null)this.pending={};this.pending[e._task_id]=e};a.Task.delete_pending=function(e){if(!(this.pending===null||!(e._task_id in this.pending))){delete this.pending[e._task_id];for(var f in this.pending)return;
for(this.pending=null;this.pending==null&&this._on_pending_empty.length;)this._on_pending_empty.shift().ready()}};a.Task.prototype.init=function(){a.assert(typeof this.state==="undefined");this.state="init";this._onready=[];this._onerror=[];this._timeout=null;this._prereqs={};this._task_id=a.uniqueid(this._task_class?this._task_class:"task");a.Task.add_pending(this);for(var e=0;e<this.parameters.length;e++){var f=this.parameters[e];this[f.name]=typeof arguments[e]!="undefined"?arguments[e]:f["default"]}return this};
a.Task.prototype.set_timeout=function(e){if(typeof e==="undefined")e=a.Task._default_timeout;this._timeout!==null&&a.error("timeout already set");if(typeof setTimeout!="undefined")this._timeout=setTimeout(a.thunk("timeout",this),e);return this};a.Task.prototype.clear_timeout=function(){this._timeout!==null&&clearTimeout(this._timeout);this._timeout=null;return this};a.Task.prototype.require=function(e){if(this.state!=="init")throw new Error("task.enqueue() already called - too late for .require()");
if(e.state=="ready")return this;if(this.state=="error")return this;if(e.state=="error")return this._prereq_error(e);this._prereqs[e._task_id]=e;e.onready("_prereq_ready",this,e).onerror("_prereq_error",this,e);return this};a.Task.prototype.enqueue=function(){if(this.state!="init")return this;this.state="wait";a.Task.debug&&a.openlog(this,".enqueue()");try{for(var e in this._prereqs)this._prereqs[e].enqueue();return this._prereqs_check()}finally{a.closelog()}};a.Task.prototype._prereqs_check=function(){if(this._prereqs===
null)return this;for(var e in this._prereqs)return this;if(this.state=="init")return this;this._prereqs=null;this.request();return this};a.Task.prototype.request=function(){return this.ready()};a.Task.prototype._prereq_ready=function(e){if(this._prereqs===null)return this;delete this._prereqs[e._task_id];return this._prereqs_check()};a.Task.prototype._prereq_error=function(e){if(this._prereqs===null)return this;this._prereqs=null;e=e.messages[0];return this.error(e.code,e.message,e.text)};a.Task.prototype.onready=
function(){if(this.state=="ready")a.vcall(arguments,this.result);else this._onready instanceof Array&&this._onready.push(a.vthunk(arguments));return this};a.Task.prototype.onerror=function(){if(this.state=="error")a.vcall(arguments,this.messages[0].code,this.messages[0].message,this.messages[0].text);else this._onerror instanceof Array&&this._onerror.push(a.vthunk(arguments));return this};a.Task.prototype.ondone=function(){this.onready.apply(this,arguments);this.onerror.apply(this,arguments);return this};
a.Task.prototype._state_notify=function(e,f,g){if(!a.Task.debug){for(var h=0;h<f.length;h++){var j=f[h];j.apply(this,g)}return this}for(h=0;h<f.length;h++){j=f[h];typeof j.bound_func!=="undefined"?a.openlog(this,".on"+e," -> "+j.bound_this+".",j.bound_func,j.bound_args,j):a.openlog(this,".on"+e,j);try{j.apply(this,g)}finally{a.closelog()}}return this};a.Task.prototype.ready=function(e){if(this._prereqs!==null)for(var f in this._prereqs)if(typeof this._prereqs[f]!="undefined"){a.error("task.ready() called with remaining prereqs",
this);throw new Error("task.ready() called with remaining prereqs");}if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.ready() called in bad state "'+this.state+'", should be "wait"');this._onerror=null;this.clear_timeout();this.state="ready";f=this._onready;this._onready=null;this.result=e;a.Task.delete_pending(this);this._state_notify("ready",f,[e]);return this};a.Task.prototype._error=function(e,f){this._onready=this._prereqs=null;this.clear_timeout();
var g=this._onerror;this._onerror=null;if(this.state=="init"){this._prereqs=null;this.state="wait"}if(this.state!=="wait")throw new Error('task.error() called in bad state "'+this.state+'". Error was '+e[0].message);this.state="error";this.messages=e;this._error_chain=f;var h=[e[0].code,e[0].message,e[0].text,this];a.Task.delete_pending(this);this._state_notify("error",g,h);return this};a.Task.prototype.error=function(e,f,g){return this._error([{code:e,message:f,text:typeof g!=="undefined"?g:""}])};
a.Task.prototype.error_nest=function(e){return this._error(e.messages,e)};a.Task.prototype.timeout=function(){this._timeout=null;return this.error("/user/mjt/messages/task_timeout","task timed out - possible unreachable server?")};a.Succeed=a.define_task(null,[{name:"succeed_result","default":null}]);a.Succeed.prototype.request=function(){return this.ready(this.succeed_result)};a.Fail=a.define_task(null,[{name:"fail_code","default":"mjt_fail"},{name:"fail_message","default":"error signaled using mjt.Fail"},
{name:"fail_full","default":""}]);a.Fail.prototype.request=function(){return this.error(this.fail_code,this.fail_message,this.fail_full)};a.Delay=a.define_task(null,[{name:"delay"}]);a.Delay.prototype.request=function(){var e=this;setTimeout(function(){e.ready(null)},this.delay)};a.NoPendingTasks=a.define_task();a.NoPendingTasks.prototype.init=function(){a.Task._on_pending_empty.push(this);a.Task.delete_pending(this)};a.NoPendingTasks.prototype.request=function(){}})(mjt);
(function(a){a.PagerSlice=a.define_task(null,[{name:"pager"},{name:"start"},{name:"count"}]);a.PagerSlice.prototype.init=function(){for(var b=this.chunks=this.pager.slice_chunks(this.start,this.count),c=0;c<b.length;c++)this.require(b[c]);return this.enqueue()};a.PagerSlice.prototype.request=function(){for(var b=this.chunks,c=[],d=0;d<b.length;d++){var e=b[d],f=this.start-e.start;if(!(f<0)){var g=f+this.count;if(f+g>e.count)g=e.count-f;g<=0||(c=f==0&&g==e.count?c.concat(e.result):c.concat(e.result.slice(f,
g)))}}return this.ready(c)};a.Pager=function(b){this.chunks=[];this.chunks_waiting=0;this.add_chunk(b)};a.Pager.prototype._next_chunk=function(b){b=this.chunks[this.chunks.length-1].next(b);this.add_chunk(b);return b};a.Pager.prototype.add_chunk=function(b){b.enqueue();this.chunks_waiting++;b.onready("chunk_ready",this).onerror("chunk_error",this);this.chunks.push(b);return this};a.Pager.prototype.chunk_ready=function(){this.chunks_waiting--};a.Pager.prototype.chunk_error=function(){this.chunks_waiting--};
a.Pager.prototype.slice_chunks=function(b,c){for(var d=[],e=b+c,f=this.chunks,g=0,h=0;h<f.length;h++){var j=this.chunks[h];if(!(j.start>=e))if(!(j.start+j.end<=b)){d.push(j);g=j.start+j.count}}e>g&&d.push(this._next_chunk(e-g));return d};a.Pager.prototype.slicetask=function(b,c){return a.PagerSlice(this,b,c)};a.Pager.prototype.slice=function(b,c,d,e){this.slicetask(b,c).onready(d).onerror(e)}})(mjt);
(function(a){a.dynamic_script=function(b,c,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.type="text/javascript";if(typeof b=="string")f.id=b;if(typeof c!=="undefined")f.src=c;if(typeof d!=="undefined"){if(/WebKit|Khtml/i.test(navigator.userAgent))throw new Error("safari doesnt evaluate dynamic script text");f.text=d}e.appendChild(f);return f};a.dynamic_iframe=function(b,c){var d=document.createElement("iframe");if(typeof b=="string")d.id=b;d.style.display=
"none";d.className="mjt_dynamic";d.setAttribute("src",c);return d};a.AsyncScript=a.define_task(null,[{name:"url"}]);a.AsyncScript.prototype.request=function(){var b=this,c=a.dynamic_script(null,this.url);if(/WebKit|Khtml/i.test(navigator.userAgent)){var d=a.dynamic_iframe();d.onload=function(){b.ready(null)};document.getElementsByTagName("body")[0].appendChild(d)}else{c.onreadystatechange=function(){/complete|loaded/.test(c.readyState)&&b.ready(null)};c.onload=function(){b.ready(null)}}};a.AsyncIframe=
a.define_task(null,[{name:"url"}]);a.AsyncIframe.prototype.request=function(){function b(){var e=d.contentWindow||d.contentDocument;if(e.document)return e.document;return e}this.domid=a.uniqueid("mjt_iframe");this.iframe=a.dynamic_iframe(this.domid,this.url);var c=this,d=this.iframe;d.onload=function(){c.ready(b(d))};d.onreadystatechange=function(){d.readyState=="complete"&&c.ready(b(d))};document.getElementsByTagName("body")[0].appendChild(d)}})(mjt);
(function(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];a.crc32=function(c,d){if(typeof d=="undefined")d=0;var e=0;d^=-1;for(var f=0,g=c.length;f<g;f++){e=(d^c.charCodeAt(f))&255;d=d>>>8^b[e]}return d^-1};a.hash=function(c){return(a.crc32(c)+2147483648).toString(16).toUpperCase()}})(mjt);
(function(a){a.JsonP=a.define_task();a.JsonP._cb={};a.JsonP._cache={};a.JsonP.flush_cache=function(){a.JsonP._cache={}};a.JsonP.prototype.init=function(){this._cbid=this.url=null;return this};a.JsonP.prototype.generate_callback_id=function(b){if(typeof b=="undefined"){this._cbid=a.uniqueid("cb");return this}this._cbid="c"+a.hash(this.url);if(typeof a.JsonP._cb[this._cbid]=="undefined")return this;a.log("info: repeated jsonp url hash",this._cbid,this.url);this._cbid=a.uniqueid("cb");return this};a.JsonP.prototype.install=
function(){a.JsonP._cache[this.url]=this;this.generate_callback_id(this.url);var b=this.callback_param+"=mjt.JsonP._cb."+this._cbid;this.cburl=this.url+(/\?/.test(this.url)?"&":"?")+b;var c=this;this._f=function(d){delete a.JsonP._cb[c._cbid];c.ready(d)};a.JsonP._cb[this._cbid]=this._f;this.onerror(function(d,e){function f(){a.log("JSONP already completed with ",d,":",e);delete a.JsonP._cb[c._cbid]}f._stale_jsonp_timed_out=new Date;a.JsonP._cb[c._cbid]=f});return this._send_request()};a.JsonP.prototype.request=
function(){if(!this.url)throw new Error("jsonp.url should be set, not "+this.url);if(typeof a.JsonP._cache[this.url]=="undefined")return this.install();var b=a.JsonP._cache[this.url];if(!(typeof b.cache_controller=="undefined"||b.cache_controller===null||b.cache_controller.is_fresh(b))){delete a.JsonP._cache[this.url];return this.install()}return b.onready("ready",this).onerror("error",this)};a.JsonP.prototype._send_request=function(){a.dynamic_script(undefined,this.cburl);return this};a.JsonP.prototype.jsonp_request_form=
function(b,c,d){c=typeof c=="string"?c:a.formencode(c);b=b;if(c)b+="?"+c;this.url=b;if(typeof acre==="undefined"&&b.length>2083){a.warn("mjt.JsonP: Warning: Adding a SCRIPT tag with a url of "+b.length+" chars. This is too long for Internet Explorer 7");a.log(b)}this.callback_param=d;return this.enqueue()}})(mjt);
(function(a){a.Xhr=a.define_task(null,[{name:"method"},{name:"url"},{name:"content_type","default":null},{name:"body","default":null},{name:"headers","default":null}]);a.Xhr.prototype.init=function(){var b;if(typeof XMLHttpRequest!="undefined")b=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")b=new ActiveXObject("MSXML2.XmlHttp");else return this.error("no XMLHttpRequest found");if(this.headers===null)this.headers={};this.xhr=b;return this};a.Xhr.prototype.request=function(){var b=this,
c=this.xhr;c.onreadystatechange=function(){if(c.readyState!=4)return b;c.onreadystatechange=function(){};if((""+c.status).charAt(0)=="2")return b.ready(c);return b.error("/apiary/http/status/"+c.status,c.statusText,c.responseText)};c.open(this.method,this.url,true);this.content_type!==null&&c.setRequestHeader("Content-Type",this.content_type);c.setRequestHeader("X-Requested-With","XMLHttpRequest");for(header in this.headers)c.setRequestHeader(header,this.headers[header]);if(this.body===null)var d=
c.send("");else{d=c.send(this.body);this.body=null}return this};a.XhrFormPost=function(b,c,d){c=a.formencode(c);return a.Xhr("POST",b,"application/x-www-form-urlencoded",c,d)}})(mjt);
(function(a){function b(){var c=a.freebase.readCookie("mwLastWriteTime");this.is_fresh=function(){var d=a.freebase.readCookie("mwLastWriteTime");return c==d}}if(typeof a.freebase=="undefined")a.freebase={};a.freebase.default_service_url="http://www.freebase.com";a.freebase.set_service_url=function(c){var d;if(typeof window!="undefined")d=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")d=acre.environ.server_protocol+"//"+acre.environ.host;a.freebase.service_url=c;a.freebase.xhr_ok=
a.freebase.service_url==d?true:false;if(typeof a.freebase.SchemaCache!="undefined")this.schema_cache=new this.SchemaCache(this)};a.freebase.set_service_url(a.freebase.default_service_url);a.freebase.FreebaseJsonPTask=a.define_task();a.freebase.FreebaseJsonPTask.prototype.init=function(){this.jsonp=a.JsonP();if(typeof a.freebase.readCookie!="undefined")this.jsonp.cache_controller=new b};a.freebase.FreebaseJsonPTask.prototype.service_request=function(c,d){var e=a.freebase.service_url;if(typeof this.service_url!=
"undefined"&&this.service_url)e=this.service_url;this.jsonp.set_timeout().jsonp_request_form(e+c,d,"callback").onready("handle_envelope",this).onerror("handle_error_jsonp",this);return this};a.freebase.FreebaseJsonPTask.prototype.handle_envelope=function(c){if(c.code!="/api/status/ok"){c=c.messages[0];return this.error(c.code,c.message,c)}return this.response(c)};a.freebase.FreebaseJsonPTask.prototype.handle_error_jsonp=function(){this.error.apply(this,arguments)};a.freebase.FreebaseJsonPTask.prototype.request=
function(){a.error("must override BaseTask.request()")};a.freebase.FreebaseJsonPTask.prototype.response=function(){a.error("must override BaseTask.response()")};a.freebase.MqlRead=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"query"},{name:"qenv","default":{}}]);a.freebase.MqlRead.prototype.build_envelope=function(){var c={escape:false};for(var d in this.qenv)c[d]=this.qenv[d];c.query=this.query;if(this.query instanceof Array){if(typeof c.cursor=="undefined"){c.cursor=true;this.start=0}this.requested_count=
this.query[0].limit||100}return c};a.freebase.MqlRead.prototype.request=function(){var c=this.build_envelope();return this.service_request("/api/service/mqlread",{query:JSON.stringify(c)})};a.freebase.MqlRead.prototype.response=function(c){if(c.result===null)return this.error("/user/mjt/messages/empty_result","no results found");if(typeof c.cursor==="string")this.next_cursor=c.cursor;if(c.result instanceof Array){this.count=c.result.length;this.more_available=false;if(this.count>=this.requested_count&&
this.next_cursor!=false)this.more_available=true}return this.ready(c.result)};a.freebase.MqlRead.prototype.next=function(c){if(this.state!=="ready")throw new Error("MqlRead.next(): bad state "+this.state);if(!this.more_available){a.warn("paging .next(): no more items",this);return null}var d=this.query[0],e={};for(var f in d)if(d.hasOwnProperty(f))e[f]=d[f];if(typeof c!="undefined")e.limit=c;c=a.freebase.MqlRead([e],{cursor:this.next_cursor});c.start=this.start+this.count;return c};a.freebase.MqlReadMultiple=
a.define_task(a.freebase.FreebaseJsonPTask);a.freebase.MqlReadMultiple.prototype.init=function(){this.reads={}};a.freebase.MqlReadMultiple.prototype.request=function(){var c={};for(var d in this.reads)c[d]=this.reads[d].build_envelope();return this.service_request("/api/service/mqlread",{queries:JSON.stringify(c)})};a.freebase.MqlReadMultiple.prototype.mqlread=function(c,d){this.reads[c]=d;return this};a.freebase.MqlReadMultiple.prototype.response=function(c){for(var d in this.reads)this.reads[d].handle_envelope(c[d]);
return this.ready(c.result)};a.freebase.TransGet=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"id"},{name:"trans_type","default":"raw"},{name:"values","default":null}]);a.freebase.TransGet.prototype.request=function(){if(this.values===null)this.values={};return this.service_request("/api/trans/"+this.trans_type+this.id,this.values)};a.freebase.TransGet.prototype.response=function(c){c.result.media_type=c.result.media_type.replace(/^\/media_type\//,"");if(typeof c.result.text_encoding=="string")c.result.text_encoding=
c.result.text_encoding.replace(/^\/media_type\/text_encoding\//,"");return this.ready(c.result)};a.freebase.Touch=a.define_task(a.freebase.FreebaseJsonPTask,[{name:"service_url","default":null}]);a.freebase.Touch.prototype.request=function(){this.jsonp.cache_controller={is_fresh:function(){return false}};return this.service_request("/api/service/touch")};a.freebase.Touch.prototype.response=function(){return this.ready(null)}})(mjt);
(function(a){var b=function(c,d,e){d||(d=6);if(e){var f=e.match(/([-+])([0-9]{2}):([0-9]{2})/),g=Number(f[2])*60+Number(f[3]);g*=f[1]=="-"?-1:1;c=new Date(Number(Number(c)+g*6E4))}else e="Z";f=function(h){return(h<10?"0":"")+h};g="";g+=c.getUTCFullYear();if(d>1)g+="-"+f(c.getUTCMonth()+1);if(d>2)g+="-"+f(c.getUTCDate());if(d>3)g+="T"+f(c.getUTCHours())+":"+f(c.getUTCMinutes());if(d>5){c=Number(c.getUTCSeconds()+"."+(c.getUTCMilliseconds()<100?"0":"")+f(c.getUTCMilliseconds()));g+=":"+f(c)}else if(d>
4)g+=":"+f(c.getUTCSeconds());if(d>3)g+=e;return g};a.freebase.date_from_iso=function(c){if(typeof c=="undefined"||c===null)return NaN;c=c.toString();var d=new Date(0,0);c=c.indexOf("T")==-1?c.split(" "):c.split("T");d=d;var e=c[0],f=e.match(/^(-?[0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$/);if(f){var g=f[4],h=f[6],j=f[8];e=f[10];var l=f[12]||1;d.setFullYear(f[1]);if(j){d.setMonth(0);d.setDate(Number(j))}else if(e){d.setMonth(0);d.setDate(1);f=d.getDay()||
7;e=Number(l)+7*Number(e);f<=4?d.setDate(e+1-f):d.setDate(e+8-f)}else{if(g){d.setDate(1);d.setMonth(g-1)}h&&d.setDate(h)}d=d}else{a.log("invalid date string: "+e);d=NaN}if(c.length==2){d=d;e=c[1];f=e.match(/Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$/);c=0;if(f){if(f[0]!="Z"){c=Number(f[3])*60+Number(f[5]||0);if(f[2]!="-")c*=-1}c-=d.getTimezoneOffset();e=e.substr(0,e.length-f[0].length)}if(f=e.match(/^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$/)){e=f[1];l=Number(f[3]||0);g=f[5]||0;f=f[7]?Number("0."+
f[7])*1E3:0;d.setHours(e);d.setMinutes(l);d.setSeconds(g);d.setMilliseconds(f);c!==0&&d.setTime(d.getTime()+c*6E4);d=d}else{a.log("invalid time string: "+e);d=NaN}}return d};a.freebase.date_to_iso=function(c){return b(c)}})(mjt);
(function(a){a.freebase.imgurl=function(b,c,d,e,f){var g={};if(typeof c!=="undefined")g.maxwidth=c;if(typeof d!=="undefined")g.maxheight=d;if(typeof e!=="undefined")g.mode=e;if(typeof e!=="undefined")g.errorid=f;return a.form_url(this.service_url+"/api/trans/image_thumb"+a.formquote(b),g)};a.freebase.extend_query=function(b,c){if(typeof c=="undefined")c={};if(typeof b=="undefined")throw new Error("extend_query: MQL query is undefined");for(var d in c){for(var e=c[d],f=d.split("."),g=f.pop(),h=b instanceof
Array?b[0]:b,j=0;j<f.length;j++){var l=f[j];if(typeof h[l]!="object"||h[l]===null)h[l]={};h=h[l];if(h instanceof Array){if(h.length==0)h=[{}];if(h.length>1)throw new Error("extend_query: path "+JSON.stringify(d)+" references an array with more than one element");h=h[0]}}if(h===null||typeof h!="object")throw new Error("extend_query: path "+JSON.stringify(d)+" does not exist in query");h[g]=e}return b}})(mjt);
(function(a){var b=/^[A-Za-z0-9][A-Za-z0-9_-]*$/,c=new RegExp("([^A-Za-z0-9_-])","g");a.freebase.mqlkey_quote=function(d){if(b.exec(d))return d;var e=function(f,g){var h=g.charCodeAt(0).toString(16).toUpperCase();if(h.length==2)h="00"+h;return"$"+h};x=d.replace(c,e);if(x.charAt(0)=="-"||x.charAt(0)=="_")x=e(x,x.charAt(0))+x.substr(1);return x};a.freebase.mqlkey_unquote=function(d){return d=d.replace(/\$([0-9A-Fa-f]{4})/g,function(e,f){return String.fromCharCode(parseInt(f,16))})}})(mjt);
(function(a,b){b.readCookie=function(c){if(typeof acre!="undefined"){if(typeof acre.environ.cookies[c]=="undefined")return"";return acre.environ.cookies[c].value}if(typeof document=="undefined")return"";var d="";c+="=";if(document.cookie.length>0){var e=document.cookie.indexOf(c);if(e!=-1){e+=c.length;c=document.cookie.indexOf(";",e);if(c==-1)c=document.cookie.length;d=document.cookie.substring(e,c)}}return d};b.parse_metaweb_cookies=function(){function c(f,g){var h=f.indexOf("|"+g+"_");if(h!=-1){h=
h+2+g.length;var j=f.indexOf("|",h);if(j!=-1)return decodeURIComponent(f.substr(h,j-h))}return null}a.freebase.freebase_user=null;var d=b.readCookie("metaweb-user-info");if(d.indexOf("A|")==0){var e={type:"/type/user"};e.id=c(d,"p");e.guid=c(d,"g");e.name=c(d,"u");if(!e.id)e.id=e.guid;a.freebase.freebase_user=e}};b.parse_metaweb_cookies();b.FreebaseXhrTask=a.define_task(null);b.FreebaseXhrTask.prototype.init=function(){};b.FreebaseXhrTask.prototype.xhr_request=function(c,d,e,f){d=b.service_url+d;
this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.xhr_form_post=function(c,d){c=b.service_url+c;this.xhr=a.XhrFormPost(c,d).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.FreebaseXhrTask.prototype.request=function(){};b.FreebaseXhrTask.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");d=d?d.replace(/;.*$/,""):"";if(!d.match(/^(application\/json|text\/javascript|text\/plain)$/))return this.error("/user/mjt/messages/json_response_expected",
"status: "+c.status+", content-type: "+d,c.responseText);this.envelope=c=JSON.parse(c.responseText);if(c.code!=="/api/status/ok")return this.error(c.code,c.messages[0].message,c.messages[0]);return this.ready(c.result)};b.FreebaseXhrTask.prototype.xhr_error=function(c,d,e,f){c=null;try{c=JSON.parse(f);var g=c.messages[0];return this.error(g.code,g.message,g)}catch(h){return this.error(d,e,f)}};b.TransUnsafe=a.define_task(null,[{name:"id"}]);b.TransUnsafe.prototype.xhr_request=function(c,d,e,f){d=
b.service_url+d;this.xhr=a.Xhr(c,d,e,f).enqueue();this.xhr.onready("xhr_ready",this).onerror("xhr_error",this,this.xhr.xhr);return this};b.TransUnsafe.prototype.xhr_ready=function(c){var d=c.getResponseHeader("content-type");this.content_type=d?d.replace(/;.*$/,""):"";this.responseText=c.responseText;return this.ready()};b.TransUnsafe.prototype.xhr_error=function(c,d,e,f){return this.error(d,e,f)};b.TransUnsafe.prototype.request=function(){return this.xhr_request("GET","/api/trans/unsafe"+this.id)};
b.MqlWrite=a.define_task(b.FreebaseXhrTask,[{name:"query"},{name:"qenv","default":{}}]);b.MqlWrite.prototype.request=function(){var c={query:this.query};for(var d in this.qenv)c[d]=this.qenv[d];return this.xhr_form_post("/api/service/mqlwrite",{query:JSON.stringify(c)})};b.FlushCache=a.define_task(b.FreebaseXhrTask);b.FlushCache.prototype.request=function(){return this.xhr_request("POST","/api/service/touch")};b.FlushCache.prototype.xhr_ready=function(){return this.ready(null)};b.Upload=a.define_task(b.FreebaseXhrTask,
[{name:"content_type"},{name:"body"},{name:"values"}]);b.Upload.prototype.request=function(){var c="/api/service/upload",d=a.formencode(this.values);if(d)c+="?"+d;return this.xhr_request("POST",c,this.content_type,this.body)};b.Signin=a.define_task(b.FreebaseXhrTask,[{name:"username"},{name:"password"},{name:"domain","default":null},{name:"options","default":{}}]);b.Signin.prototype.request=function(){if(typeof this.username=="undefined")return this.xhr_form_post("/api/account/logout",{});var c={username:this.username,
password:this.password};if(this.domain!==null)c.domain=this.domain;for(var d in this.options)c[d]=this.options[d];return this.xhr_form_post("/api/account/login",c).ondone("clear_password",this)};b.Signin.prototype.clear_password=function(){delete this.password;return this}})(mjt,mjt.freebase);
(function(a){a.bless=function(b){return new a.Markup(b)};a.MarkupList=function(){for(var b=0;b<arguments.length;b++)this[b]=arguments[b]};a.Markup=function(b){this.html=b};a.Markup.prototype.toMarkup=function(){return this.html};(function(){function b(d,e,f){f.push('<span style="outline-style:solid;color:red;">');if(e){f.push(e);f.push("</span>")}else{f.push("bad markup element, type [");f.push(typeof d);f.push("]</span>")}}function c(d,e){switch(typeof d){case "object":if(d===null)b(d,"[null]",e);
else if(d instanceof a.MarkupList)for(var f=0;f in d;f++)c(d[f],e);else if(typeof d.toMarkupList==="function")c(d.toMarkupList(),e);else if(typeof d.toMarkup==="function")e.push(d.toMarkup());else typeof d.toString==="function"?e.push(a.htmlencode(d.toString())):b(d,"[object]",e);break;case "undefined":b(d,"[undefined]",e);break;case "string":e.push(a.htmlencode(d));break;case "boolean":e.push(String(d));break;case "number":e.push(String(d));break;case "function":b(d,"[function]",e);break}return e}
a.flatten_markup=function(d){return c(d,[]).join("")}})();a.make_attr_safe=function(b){return a.bless(a.flatten_markup(b).replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\"/g,"&quot;"))}})(mjt);
(function(a){a.error_html=function(b,c,d){var e=[];if(c&&b.lineNumber){var f=b.lineNumber;c=c.split("\n");if(f<0)f=0;if(f>=c.length)f=c.length-1;var g=f-10;if(g<0)g=0;var h=[];e.push(a.bless(["\n<pre>"]));for(g=g;g<f;g++)h.push(c[g]);e.push(h.join("\n"));e.push(a.bless(['</pre>\n<pre style="color:red">']));e.push(c[f]+"\n");e.push(a.bless(["</pre>\n<pre>"]));h=[];for(g=f+1;g<c.length;g++)h.push(c[g]);e.push(h.join("\n"));e.push(a.bless(["</pre>\n"]))}b=[a.bless(['<div class="mjt_error"']),d?[a.bless([' id="']),
d,a.bless(['"'])]:[],a.bless([">"]),b.name,": ",b.message,e,a.bless(["</div>\n"])];return b=b.concat(e)};a.Codeblock=function(b,c){this.name=b;this.codestr=c;this.baseline=this.basefile=null};a.Codeblock.prototype.handle_exception=function(b,c){if(typeof c.mjt_error=="undefined"){var d=false;if(typeof c.sourceURL!="undefined")c.fileName=c.sourceURL;if(typeof c.line!="undefined"){d=true;c.lineNumber=c.line}c.mjt_error=c instanceof Error?{fileName:c.fileName,lineNumber:c.lineNumber,name:c.name,message:c.message,
stack:c.stack,rhinoException:c.rhinoException}:{name:"Unknown exception",fileName:"",message:""+c};if(this.basefile||d)if(typeof c.stack=="string"){d=this.basefile.replace(/(\W)/g,"\\$1")+":(\\d+)\n";d=new RegExp(d);if(d=d.exec(c.stack)){d=parseInt(d[1])-this.baseline;d>0&&this.log_error_context(b,c,d)}}else if(c.fileName==this.basefile||d){d=d?c.lineNumber-1:c.lineNumber-this.baseline;if(d>0){c.mjt_error.lineNumber=d;c.mjt_error.fileName="<generated code>";this.log_error_context(b,c,d)}}}};a.Codeblock.prototype.log_error_context=
function(b,c,d){var e=this.extract_context(this.codestr,d,5);d="---"+d+"--\>  ";for(var f=[],g=0;g<d.length;g++)f.push(" ");f=f.join("");e=[f,e.prev_lines.join("\n"+f),"\n",d,e.the_line,"\n",f,e.next_lines.join("\n"+f)].join("");a.error("error",b,"\n    "+c.name+": "+c.message+"\n",e)};a.Codeblock.prototype.extract_context=function(b,c,d){b=b.split("\n");if(c<0)c=0;if(c>=b.length)c=b.length-1;var e=c-d;if(e<0)e=0;var f=[];for(line=e;line<c;line++)f.push(b[line]);e=b[c];var g=[];for(line=c+1;line<
b.length&&line<c+d;line++)g.push(b[line]);return{prev_lines:f,the_line:e,next_lines:g}};a.Codeblock.prototype.evaluate=function(){var b=(new Date).getTime(),c=[this.codestr];c=["var __mjt_eval = (function(){",this.codestr,"})(); __mjt_eval;\n"];c=c.join("");a.debug&&a.log("evaluating code "+this.name,{click_me:"view code",codestr:c});var d;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined")d=eval(c);else{try{null()}catch(e){this.baseline=e.lineNumber+2;this.basefile=e.fileName}try{d=
eval(c)}catch(f){this.handle_exception("evaluating codeblock "+this.name,f);throw f;}}b=(new Date).getTime()-b;a.note("evaluated code in ",b,"msec, ",c.length,"chars, got ",typeof d);return d}})(mjt);
(function(a){a._eventcb={};a.kws=function(){for(var b={},c=0;c<arguments.length;c+=2)b[arguments[c]]=arguments[c+1];return b};a.foreach=function(b,c,d){var e,f;if(typeof c=="string"||c instanceof Array||typeof jQuery=="object"&&c instanceof jQuery){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c[e]])}else if(typeof c==="object")if(typeof document!="undefined"&&typeof c.item!="undefined"&&c.item===document.childNodes.item){f=c.length;for(e=0;e<f;e++)d.apply(b,[e,c.item(e)])}else for(e in c)c.hasOwnProperty(e)&&
d.apply(b,[e,c[e]])};a.ondomready=function(b,c){var d=a._ondomready_queue;if(a._ondomready_timer===null)a._ondomready_timer=setTimeout(a._ondomready_run,20);d.push(b);d.push(c)};a._ondomready_queue=[];a._ondomready_timer=null;a._ondomready_run=function(){a._ondomready_timer=null;var b=a._ondomready_queue;for(a._ondomready_queue=[];b.length;){var c=b.shift(),d=b.shift();c.apply(d)}};a.cleanup_noquote=function(b,c){var d=a.flatten_markup(b);d=d.replace(/&quot;/g,'"').replace(/&lt;/g,"<").replace(/&gt;/g,
">").replace(/&amp;/g,"&");if(typeof c!="undefined")d=d.replace(new RegExp("</("+c+"\\s*)>","ig"),"<\\/$1>");return a.bless(d)};a.ref=function(b){b=['<a href="view?name=',a.formquote(b),'">',a.htmlencode(b),"</a>"].join("");return new a.Markup(b)};a.TemplateCall=function(b){this.raw_tfunc=b;delete this._markup};a.TemplateCall.prototype.toMarkupList=function(){return this._markup};a.TemplateCall.prototype.toMarkup=function(){return a.flatten_markup(this._markup)};a.TemplateCall.prototype.redisplay=
function(){var b=new this.this_tfunc;b.prev_tcall=this;b.subst_id=this.subst_id;b.render(this.targs).display();return b};a.TemplateCall.prototype.display=function(b){if(typeof acre!="undefined")return this;if(typeof b!="undefined")this.subst_id=b;b=this.subst_id;if(typeof b=="string"){var c=document.getElementById(b);if(c)b=c;else{a.note("no element with id "+b);return null}}if(b.nodeName=="IFRAME"){b=b.contentWindow||b.contentDocument;if(b.document)b=b.document;b=b.getElementsByTagName("body")[0]}if(!b)return this;
typeof this._markup!="undefined"&&a.replace_html(b,this);return this};a.TemplateCall.prototype.render=function(b){if(typeof b!="undefined")this.targs=b;b=this.raw_tfunc;if(typeof window=="undefined"||typeof window.navigator.appName=="undefined"){this._markup=b.apply(this,this.targs);return this}try{this._markup=b.apply(this,this.targs)}catch(c){c.tcall=this;b=this.tpackage._codeblock;if(b===null)throw c;b.handle_exception("applying tfunc "+this.signature,c);b=[];for(var d in this.tasks){var e=this.tasks[d];
typeof e==="object"&&e!==null?b.push(d+":"+e.state):b.push(d+":"+typeof e)}this._markup=new a.MarkupList(a.bless("<h3>error applying "),this.signature," to id=",this.subst_id,a.bless("</h3>"),"states:[",b.join(" "),"]");throw c;}return this};a.TemplateCall.prototype.mktask=function(b,c){this.tasks[b]=c;var d=this;c.state=="init"&&c.enqueue();return c.ondone(function(){d.render().display()})};a.tfunc_factory=function(b,c,d,e){var f=function(){var g=arguments.callee;if(this instanceof g){this.tasks=
{};this.defs=this.exports={};typeof a.deprecate=="function"&&a.deprecate(this,"defs",".exports")}else{for(var h=new g,j=[],l=0;l<arguments.length;l++)j[l]=arguments[l];l=h.signature.replace(/\(.*\)$/,"");h.subst_id=g.prototype.has_tasks?a.uniqueid("tcall__"+l):null;h.render(j);return h}};f.prototype=new a.TemplateCall(c);f.prototype.signature=b;f.prototype.tpackage=d;f.prototype.has_tasks=e;f.prototype.source_microdata=c.source_microdata;return f.prototype.this_tfunc=f}})(mjt);
(function(a){a.TemplatePackage=function(){this.namespace=this._template_fragments=this.output_mode=this.debug_locs=this._codeblock=this._compiled=this._template_strings=this.source=null};a.TemplatePackage.prototype.runtime={_break_token:a._break_token,_continue_token:a._continue_token,bless:a.bless,cleanup_noquote:a.cleanup_noquote,foreach:a.foreach,htmlencode:a.htmlencode,make_attr_safe:a.make_attr_safe,new_markuplist:function(){return new a.MarkupList},ondomready:a.ondomready,ref:a.ref,tfunc_factory:a.tfunc_factory,
uniqueid:a.uniqueid};a.TemplatePackage.prototype.init_from_json=function(b){if(typeof b.file!="undefined")this.source=b.file;if(typeof b.stringtable!="undefined")this._template_strings=b.stringtable;this._codeblock=null;if(typeof b.code=="string")this._codeblock=new a.Codeblock(this.source,b.code);else if(typeof b.code=="function")this._compiled=b.code;if(typeof b.debug_locs!="undefined")this.debug_locs=b.debug_locs;if(typeof b.output_mode!="undefined")this.output_mode=b.output_mode;return this};
a.TemplatePackage.prototype.init_from_js=function(b){var c=b.def;this.init_from_json(b.info);this._compiled=c;return this};a.TemplatePackage.prototype.get_metadata=function(){return{file:this.source,stringtable:this._template_strings,debug_locs:this.debug_locs,output_mode:this.output_mode}};a.TemplatePackage.prototype.toJSON=function(){var b=this.get_metadata();if(this._codeblock===null){a.warn("TemplatePackage.toJSON: complete source code unavailable",this.source);b.code=this._compiled}else b.code=
this._codeblock.codestr;return JSON.stringify(b)};a.TemplatePackage.prototype.toJS=function(){var b=null;if(this._codeblock===null){a.warn("TemplatePackage.toJS: complete source code unavailable",this.source);b=this._compiled}else b="(function () {"+this._codeblock.codestr+"})()";return["{def: ",b,",\ninfo:",JSON.stringify(this.get_metadata()),"}\n"].join("")};a.TemplatePackage.prototype.lookup_line=function(b){if(!(debug_locs instanceof Array)||b>=this.debug_locs.length)return null;return this.debug_locs[b-
1]};a.TemplatePackage.prototype.compile_document=function(b,c){(new Date).getTime();if(typeof c=="undefined")c=new a.TemplateCompiler;c.compile_top(b,"rawmain()");(new Date).getTime();return this.init_from_json({source:this.source,stringtable:c.strings,code:c.codestr+"; return rawmain;",debug_locs:c.debug_locs,output_mode:c.output_mode})};a.TemplatePackage.prototype.load_document=function(b,c){this.source+="#"+b.id;this.compile_document(b);return this.load(c)};a.TemplatePackage.prototype.toplevel=
function(b){this.namespace===null&&this.load(b);return this.namespace};a.TemplatePackage.prototype.toString=function(){this.namespace===null&&this.load(targs);return a.flatten_markup(this.namespace._main.prototype.tpackage.tcall)};a.TemplatePackage.prototype.load=function(b){this._template_fragments=[];for(var c=0;c<this._template_strings.length;c++)this._template_fragments[c]=a.bless(this._template_strings[c]);if(this._compiled===null)if(this._codeblock===null)a.error("TemplatePackage has no code",
this.source);else this._compiled=this._codeblock.evaluate();if(typeof b=="undefined")b=[];this._args=b;b=a.tfunc_factory("_main()",this._compiled,this,false,true);c=new b;c.render(this._args);this.tcall=c;c.pkg=this;if(typeof this._compiled.doc_content_type!="undefined")c.doc_content_type=this._compiled.doc_content_type;if(typeof c.exports._main!="undefined")throw new Error("_main() is illegal as a template function name");this.namespace=c.exports;this.namespace._main=b;if(typeof c.exports.main!=
"undefined")throw new Error("main() is illegal as a template function name");this.namespace.main=b;typeof a.deprecate=="function"&&a.deprecate(this.namespace,"main","._main");return this}})(mjt);
(function(a){a.run=function(c,d,e){var f;if(typeof a.app=="undefined")a.app=new a.App;if(arguments.length==0){var g=new a.TemplatePackage;return a.run_page(g)}if(typeof c===null)throw new Error("mjt.run: null target");else if(typeof c=="string"){f=c;c=document.getElementById(f)}else if(typeof c=="object"){if(c.id=="")c.id=a.uniqueid("run_target");f=c.id}if(arguments.length==1){g=new a.TemplatePackage;g.source=window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+f;return a.run_element(g,
c,e)}if(typeof d!=="function"){a.error("invalid template function",d,arguments);throw new Error("mjt.run: invalid args");}g=new d;g.subst_id=f;g.render(e).display();return g.exports};var b=function(c,d){var e=[],f;for(f=d.firstChild;f!==null;f=f.nextSibling)f.nodeType==1&&e.push(f);for(var g=0;g<e.length;g++){f=e[g];switch(f.nodeName){case "TITLE":c.title=f.innerHTML;break;case "META":switch(f.name){case "description":c.summary=f.content;break;case "author":c.author=f.content;break;case "content-language":c.language=
f.content;break;case "x-mjt-id":c.id=f.content;break}break;case "SCRIPT":break;case "STYLE":break;default:break}}};a.run_page=function(c){b(c,document.getElementsByTagName("head")[0]);var d=a.Succeed();c.source=window.location.protocol+"//"+window.location.host+window.location.pathname;for(var e=document.createElement("div"),f=document.getElementsByTagName("body")[0],g=f.firstChild;g!==null;){var h=g;g=g.nextSibling;if(!(h.nodeName==="IFRAME"&&h.className==="mjt_dynamic")){f.removeChild(h);e.appendChild(h)}}e.id=
a.uniqueid("mjt_body");e.style.display="none";f.appendChild(e);if(f.style.display=="none")f.style.display="";d.enqueue().onready(function(){a.run_element(c,e,[])});return c.namespace};a.run_element=function(c,d,e){c.load_document(d,e);c.tcall.subst_id=d.id;c.tcall.display();return c.tcall.exports};a.load_element=function(c){var d=typeof c=="string"?document.getElementById(c):c,e=new a.TemplatePackage;e.source=window.location.protocol+"//"+window.location.host+window.location.pathname;if(typeof c==
"string")e.source+="#"+c;e.load_document(d,[]);return e};a.load_from_iframe=function(c){var d=new a.TemplatePackage;d.source=window.location.protocol+"//"+window.location.host+window.location.pathname;var e=c;if(typeof c=="string")e=document.getElementById(c);if(e.nodeName!="IFRAME"){a.error("called mjt.load_from_iframe on node tag",e.nodeName);return null}c=e.contentWindow||e.contentDocument;if(c.document)c=c.document;e=c.getElementsByTagName("body")[0];d.load_document(e,[]);return d.namespace};
a.load_string=function(c){var d=document.createElement("div");d.innerHTML=c;return a.load_element(d)};a.replace_html=function(c,d){var e=document.createElement("div"),f=a.flatten_markup(d);e.innerHTML=f;if(c.parentNode===null)a.warn("attempt to replace html that has already been replaced?");else{f=e.firstChild;if(f===null)a.warn("bad html in replace_innerhtml");else{if(f.nextSibling){a.warn("template output should have a single toplevel node");f=e}c.parentNode.replaceChild(f,c);if(f.style&&f.style.display==
"none")f.style.display=""}}}})(mjt);
(function(a){a.Scope=function(b,c,d){this.template=b;c||(c=null);this.parent=c;d||(d="[unnamed]");this.decl=d;this.tasks={};this.toplevel=false;this.microdata={items:{},item:null,stack:[],lastvalue:null};if(c!==null)this.microdata.items=c.microdata.items};a.TemplateCompiler=function(){this.strings=[];this.codestr=null;this.debug_locs=[];this.compiler_dt=this.source_loc=null;this._markup=[];this._code=[];this.next_unique_id={};this.debug=a.debug;this.browser_dom=typeof navigator!="undefined";this.browser_target=
true;this.document_content_type=this.output_prefix=null;this.set_output_mode("html");this.mjtns_re=/^(?:mjt\.|mjt:|acre:)(.+)$/;this._ie_attribute_bs=this.browser_dom&&/MSIE/.test(navigator.userAgent)};a.TemplateCompiler.prototype.set_output_mode=function(b){this.output_mode=b;this.empty_tags={};this.boolean_attrs={};this.preserve_space_tags={};this.noescape_tags={};switch(b){case "text":break;case "xml":break;case "html":this.empty_tags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,
isindex:1,link:1,meta:1,param:1};this.boolean_attrs={selected:1,checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1};this.preserve_space_tags={pre:1,textarea:1};this.noescape_tags={script:1,style:1};break;default:throw new Error('set_output_mode: unknown mode "'+b+'"');}};a.TemplateCompiler.prototype.compile_top=function(b,c){this.scope=new a.Scope(this,null,"[toplevel]");this.scope.toplevel=true;this.scope.toplevel_def=c;this.compile_node(b);
this.codestr=this._code.join("");this._markup=this._code=null;if(this.codestr=="")throw new Error("template compiled with no output");};a.TemplateCompiler.prototype.uniqueid=function(b){var c=this.next_unique_id[b];if(typeof c!=="number")c=1;this.next_unique_id[b]=c+1;return b+"_"+c};a.TemplateCompiler.prototype._ampRE=/\&/g;a.TemplateCompiler.prototype._ltRE=/\</g;a.TemplateCompiler.prototype._gtRE=/\>/g;a.TemplateCompiler.prototype.htmlencode=function(b){return b.replace(this._ampRE,"&amp;").replace(this._ltRE,
"&lt;").replace(this._gtRE,"&gt;")};a.TemplateCompiler.prototype.jsencode=function(b){return JSON.stringify([b]).replace(/^[^"]*/,"").replace(/[^"]*$/,"")};a.TemplateCompiler.prototype.flush_markup=function(b){if(this._markup.length==0)return-1;var c=this._markup.join("");this._markup=[];var d=this.strings.length;this.strings[d]=c;if(this.debug){b=c.replace(/\r?\n/gm,"\n                                                  // ");c="__m[__n++]=__ts["+d+"];";if(c.length<50)c+="                                                  ".substr(c.length);
this.emit(c,"// ",b,"\n")}else b||this.emit("__m[__n++]=__ts[",d,"];\n");return d};a.TemplateCompiler.prototype.emit=function(){this._markup.length&&this.flush_markup();for(var b=0;b<arguments.length;b++)for(var c=(""+arguments[b]).split("\n"),d=0;d<c.length;d++){if(d>0){this._code.push("\n");this.debug_locs.push(this.source_loc)}this._code.push(c[d])}};a.TemplateCompiler.prototype.emitln=function(){this.emit.apply(this,arguments);this.emit("\n")};a.TemplateCompiler.prototype.markup=function(){for(var b=
0;b<arguments.length;b++)this._markup.push(arguments[b])};a.TemplateCompiler.prototype.warn=function(b){this.markup('<span style="outline-style:solid;color:red;">',this.htmlencode(b),"</span>")};a.TemplateCompiler.prototype.compile_task=function(b,c){if(c.firstChild===null||c.firstChild.nodeType!=3||c.firstChild.nextSibling!==null)throw new Error("mjt.task="+b+" declaration may only contain text");var d=c.firstChild.nodeValue;if(d.match(/;\s*$/)){a.warn("mjt.task=",b,"definition should not end with a semicolon");
d=d.replace(/;\s*$/,"")}this.browser_dom&&d.match(/\/\/ /)&&a.warn('"//" comments in mjt.task=',b,"definition will fail on IE6");this.emitln("var ",b," = this.tasks && this.tasks.",b,";");this.emitln("if (!",b,") { ",b,' = this.mktask("',b,'", (\n',d,")); }");this.scope.has_tasks=true};a.TemplateCompiler.prototype.compile_text=function(b,c,d,e,f){var g=/[^A-Za-z0-9_.]/gm,h=/\}/gm,j=/\]/gm,l={has_subs:false,next_node_leading_ws:null};if(typeof c=="undefined")c=false;if(typeof d=="undefined")d=false;
if(typeof e=="undefined")e=false;if(typeof f=="undefined")f=false;var o,n,k=b.length,m=0,r=b.indexOf("$",m);if(r==-1){o=b.split("\n").length-1;if(d)b=b.replace(/^\s+/m,"");if(e)b=b.replace(/\s+$/m,"");if(c=/\n\s*$/.exec(b)){l.next_node_leading_ws=c[0];b=b.substr(0,c.index)}this.markup(this.htmlencode(b));this.source_loc+=o;return l}for(;r>=0;){n=b.substring(m,r);o=n.split("\n").length-1;if(m==0&&d)n=n.replace(/^\s+/m,"");this.markup(this.htmlencode(n));this.source_loc+=o;r++;if(r>=k){this.warn("premature end of $ substitution in "+
this.jsencode(b));return l}switch(b.charAt(r)){case "$":if(f){this.markup("$");break}r++;this.markup("$");break;case "(":this.markup("$");break;case "{":h.lastIndex=r+1;o=h.exec(b);if(o===null){this.warn("missing close after ${ in "+this.jsencode(b));return l}n=b.substring(r+1,h.lastIndex-1);r=h.lastIndex;if(/\{/.test(n))throw new Error('template compiler: "{" and "}" are forbidden inside "${...}"');c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",n,");"):this.emitln("__m[__n++]=(",n,");");
l.has_subs=true;this.source_loc+=n.split("\n").length-1;break;case "[":if(f){this.markup("$");break}if(c)throw new Error('template compiler: "$[...]" is illegal in an attribute');j.lastIndex=r+1;o=j.exec(b);if(o===null){this.warn("missing close after $[ in "+this.jsencode(b));return l}n=b.substring(r+1,j.lastIndex-1);r=j.lastIndex;if(/\[/.test(n))throw new Error('template compiler: "[" and "]" are forbidden inside "$[...]"');this.emitln("__m[__n++]=__pkg.runtime.ref(",this.jsencode(n),");");l.has_subs=
true;this.source_loc+=n.split("\n").length-1;break;default:if(f){this.markup("$");break}g.lastIndex=r;o=g.exec(b);if(o===null){n=b.substring(r);r=k}else if(o.index>r){n=b.substring(r,o.index);r=o.index}else{this.warn("unknown character following $ in "+this.jsencode(b));return l}c?this.emitln("__m[__n++]=__pkg.runtime.make_attr_safe(",n,");"):this.emitln("__m[__n++]=",n,";");l.has_subs=true}m=r;r=b.indexOf("$",m)}if(m>=0&&m<k){n=b.substring(m);o=n.split("\n").length-1;if(e)n=n.replace(/\s+$/m,"");
if(c=/\n\s*$/.exec(n)){l.next_node_leading_ws=c[0];n=n.substr(0,c.index)}this.markup(this.htmlencode(n));this.source_loc+=o}return l};a.TemplateCompiler.prototype.compile_onevent_attr=function(b,c){var d=this.uniqueid(b+"_cb");this.emitln("var ",d,' = __pkg.runtime.uniqueid("',b,'");');this.emitln("mjt._eventcb[",d,"] = function (event) {");this.emit(c);this.emitln("}");return"return mjt._eventcb.${"+d+"}.apply(this, [event])"};a.TemplateCompiler.prototype.get_attributes=function(b,c,d){for(var e=
this.mjtns_re.exec(b.nodeName),f=null,g=b.attributes,h=0;h<g.length;h++){var j=g[h];if(j.specified){var l=j.nodeName,o=this.mjtns_re.exec(l);if(o)d[o[1]]=j.nodeValue;else if(e&&l.indexOf(":")==-1){if(typeof d[l]!="undefined")throw new Error("template compiler: ambiguous template attribute: both "+l+" and "+j.nodeName+" are specified");d[l]=j.nodeValue}else if(l=="src")f=j.nodeValue;else{o={name:l};if(typeof j.nodeValue!="undefined")o.value=j.nodeValue;if(this.browser_dom){l.substr(0,2)=="on"&&a.warn(l,
'="..."',"will break on IE6, use","mjt."+l);if(this._ie_attribute_bs)if(l=="style")o.value=""+b.style.cssText;else if(l=="CHECKED")o.value="1";else if(j=b.getAttribute(l,2))o.value=j;if(typeof o.value=="number")o.value=""+o.value}c.push(o)}}}if(this.browser_dom&&this._ie_attribute_bs&&b.nodeName=="INPUT"){o={name:"value",value:b.value};c.push(o)}if(typeof d.src!="undefined")c.push({name:"src",value:d.src});else f!==null&&c.push({name:"src",value:f})};a.TemplateCompiler.prototype.compile_choose=function(b,
c){var d="init";if(c){this.emitln("switch (",c,") {");d="dispatch_init"}else a.log('choose="" is deprecated, use if...elif...else instead');for(var e=b.firstChild;e!=null;){var f=e.nextSibling,g=e.nodeType;if(g==3)e.nodeValue.match(/[^ \t\r\n]/)&&a.warn("only whitespace text is allowed in mjt.choose, found",'"'+e.nodeValue+'"');else if(g==1){g=d;var h={};this.get_attributes(e,[],h);var j=false;if(typeof h.when!="undefined")j=false;else if(typeof h.otherwise!="undefined")j=true;else{a.warn("all elements inside mjt.choose must have a mjt.when= or mjt.otherwise= attribute");
break}if(d=="init")if(j){this.emitln("{");g="closed"}else{this.emitln("if (",h.when,") {");g="open"}else if(d=="open")if(j){this.emitln("} else {");g="closed"}else{this.emitln("} else if (",h.when,") {");g="open"}else if(d.match(/^dispatch/)){d!="dispatch_init"&&this.emitln("break;");if(j)this.emitln("default:");else{this.emit("case ");this.emit(this.jsencode(h.when));this.emitln(":")}g="dispatch"}this.compile_node(e,{choose_state:"in_choose"});d=g}e=f}if(c=="")this.emitln("}");else{d!="dispatch_init"&&
this.emitln("break;");this.emitln("};")}};a.TemplateCompiler.prototype.compile_def=function(b){var c=b.match(/^([^(]+)\(([^)]*)\)$/);if(c){var d=c[1];c=c[2];this.debug&&this.emitln("// mjt.def=",b);this.emitln("var ",d," = function (",c,") {");this.scope=new a.Scope(this,this.scope,b)}else a.warn("bad mjt.def=",b,": must contain an argument list")};a.TemplateCompiler.prototype.complete_def=function(){this.scope=this.scope.parent;this.scope.toplevel&&this.output_mode=="text"?this.emitln("return __pkg.runtime.cleanup_noquote(__m);"):
this.emitln("return __m;");this.emitln("};")};a.TemplateCompiler.prototype.generate_open_tag=function(b,c,d,e){this.markup("<",b);for(var f={},g=0;g<c.length;g++){var h=c[g];if(typeof h.value=="function")a.warn("ignoring function-valued attr",b,h.name,h.value);else f[h.name]=h.value}if("id"in f)e=false;if(d){b=this.uniqueid("dattrs");g=this.uniqueid("sattrs");this.emitln("var ",b," = (",d,");");this.emitln("var ",g," = {};");for(g=0;g<c.length;g++){d=c[g].name;f=c[g].value;this.emit("if (!(",this.jsencode(d),
" in ",b,")) {");if(d in this.boolean_attrs)this.markup(" ",d);else{this.markup(" ",d,'="');this.compile_text(f,true);this.markup('"')}this.emitln(" }")}e&&this.emitln('if (this.subst_id && !("id" in ',b,")) ",b,".id=this.subst_id;");c=this.uniqueid("di");this.emitln("for (var ",c," in ",b,") {");this.emitln("__m[__n++]=' ' + "+c+";");this.emitln("__m[__n++]=__pkg.runtime.bless('=\"');");this.emitln("__m[__n++]=__pkg.runtime.htmlencode(''+"+b+"["+c+"]);");this.emitln("__m[__n++]=__pkg.runtime.bless('\"');");
this.emitln("}")}else{for(g=0;g<c.length;g++){h=c[g];this.markup(" ",h.name,'="');this.compile_text(h.value,true);this.markup('"')}e&&this.emitln("if (this.subst_id) { __m[__n++]=__pkg.runtime.bless(' id=\"' + this.subst_id + '\"'); }")}};a.TemplateCompiler.prototype.compile_node=function(b,c){if(typeof c=="undefined")c={};var d="none";if(typeof c.choose_state!="undefined")d=c.choose_state;if(typeof b.getUserData!="undefined")try{var e=b.getUserData("lineNumber");if(e!==null){if(typeof e=="string")e=
parseInt(e);this.source_loc=e}}catch(f){this.source_loc=null}e=null;switch(b.nodeType){case 1:this.compile_element(b,d,c.leading_ws);break;case 2:break;case 3:e=this.compile_text(b.nodeValue,false,c.trim_leading_ws,c.trim_trailing_ws).next_node_leading_ws;break;case 4:c.leading_ws&&this.markup(c.leading_ws);this.compile_text(b.nodeValue,false);break;case 5:c.leading_ws&&this.markup(c.leading_ws);this.markup("&"+b.nodeName+";");break;case 6:a.warn("template compiler: skipping dom node type",b.nodeType);
break;case 7:a.warn("template compiler: got <? ?>",b.nodeName,b.nodeValue);break;case 8:c.leading_ws&&this.markup(c.leading_ws);this.output_mode!="text"&&this.markup("<!--"+b.nodeValue+"--\>");break;case 9:a.warn("template compiler: skipping dom node type",b.nodeType);break;case 10:c.leading_ws&&this.markup(c.leading_ws);this.markup("<!DOCTYPE "+b.nodeName+' PUBLIC "'+b.publicId+'" "'+b.systemId+'">');a.warn("ignoring DOCTYPE",b.nodeName,b.nodeValue);break;case 11:a.warn("template compiler: skipping dom node type",
b.nodeType);break;case 12:a.warn("template compiler: skipping dom node type",b.nodeType);break;default:a.warn("template compiler: unknown dom node type",b.nodeType)}return e};a.TemplateCompiler.prototype.compile_element=function(b,c,d){var e=[],f=true,g=b.nodeName,h=g.toLowerCase(),j={},l=[];this.get_attributes(b,l,j);var o={};for(ai=0;ai<l.length;ai++){var n=l[ai];o[n.name]=n}if(this.scope.toplevel){if(typeof j.def!="undefined")throw new Error('template compiler: def="'+j.def+'" illegal at top element');
j.def=this.scope.toplevel_def}if(this.output_mode=="text")j.strip="1";var k=this.mjtns_re.exec(b.nodeName);if(k)switch(k[1]){case "script":j.script=j.script||"";break;case "none":a.warn("<mjt:none> is deprecated, use <mjt:block> instead");j.strip="1";break;case "block":j.strip="1";break;case "task":if(typeof j["var"]=="string")j.task=j["var"];else a.error("mjt:task requires var= or mjt:var= attribute");break;case "doc":this.scope.toplevel||a.error("mjt:doc is only legal as the toplevel tag");j.strip=
"1";this.document_content_type=typeof j.type!="undefined"?j.type:"text/html";if(typeof j["xml-pi"]!="undefined")if(j["xml-pi"]=="true"||j["xml-pi"]=="1")this.output_prefix='<?xml version="1.0" encoding="utf-8" ?>\n';else if(j["xml-pi"]=="false"||j["xml-pi"]=="0")this.output_prefix=null;if(this.document_content_type=="text/html")this.set_output_mode("html");else if(/^text\//.test(this.document_content_type))this.set_output_mode("text");else{/^application\/.*xml$/.test(this.document_content_type);this.set_output_mode("xml")}break;
default:a.error("ignoring unknown mjt tag",g);break}k=null;var m=false;if(typeof j.trim!="undefined")m=true;if(b.firstChild!==null)k=function(p){p=p.firstChild;var t={};if(m)t.trim_leading_ws=true;for(;p!=null;){var s=p.nextSibling;if(m&&s===null)t.trim_trailing_ws=true;t.leading_ws=this.compile_node(p,t);t.trim_leading_ws=false;t.trim_trailing_ws=false;p=s}return t.leading_ws};if(!(h=="script"&&this.browser_dom)){if(h in this.noescape_tags)k=function(p){p=p.firstChild;if(p!==null)if(p.nodeType!=
3||p.nextSibling)a.warn("<"+g+"> tag should contain only text");else if(p.nodeValue.match(new RegExp("</"+g)))a.warn("illegal content for HTML script tag, removed");else{this.emitln(" __m[__n++]=(function () {");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");p=this.compile_text(p.nodeValue,false,false,false,true);this.emitln("return __pkg.runtime.cleanup_noquote(__m, "+this.jsencode(h)+");");this.emitln("})();");return p.next_node_leading_ws}};if(typeof j.task!="undefined")this.compile_task(j.task,
b);else{if(typeof j.def!="undefined"){typeof l.id!="undefined"&&a.warn("mjt.def=",j.def,'must not have an id="..." attribute');this.compile_def(j.def,b);if(this.scope.parent.toplevel){this.emitln("var __pkg = this.tpackage;");this.emitln("var exports = this.exports;");this.emitln("var __ts=__pkg._template_fragments;");this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");this.output_prefix!=null&&this.markup(this.output_prefix)}else this.emitln("var __m=__pkg.runtime.new_markuplist(),__n=0;");
e.push(function(){var p=this.scope;if(p.has_tasks)if(!f||typeof j.strip!="undefined")a.error("can't strip toplevel tag of mjt.def=\""+j.def+'" tag because it contains tasks');this.complete_def();var t=j.def.replace(/\(.*/,"");this.scope.toplevel&&this.document_content_type!=null&&this.emitln(t,".doc_content_type = ",this.jsencode(this.document_content_type),";");this.scope.toplevel||this.emitln(t," = __pkg.runtime.tfunc_factory(",this.jsencode(j.def),", ",t,", ","__pkg",", ",p.has_tasks,", ",false,
");");this.scope.parent&&this.scope.parent.toplevel&&this.emitln("exports.",t," = ",t,";");typeof p.microdata!="undefined"&&this.emitln(t,".source_microdata = ",JSON.stringify(p.microdata.lastvalue),";")})}if(typeof j.when!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.when, in choice state",c);e.push(function(){this.flush_markup()})}if(typeof j.otherwise!="undefined"){this.flush_markup();c!="in_choose"&&a.warn("unexpected mjt.otherwise, in choice state ",c);e.push(function(){this.flush_markup()})}var r=
{meta:"content",audio:"src",embed:"src",iframe:"src",img:"src",source:"src",video:"src",a:"href",area:"href",link:"href",object:"data",time:"datetime"},q=this.scope.microdata;if(q&&typeof j.itemprop!="undefined"){"itemprop"in o||l.push({name:"itemprop",value:j.itemprop});if(q.item===null)throw new Error("got mjt.itemprop= without containing mjt.item=");if(typeof j["for"]!="undefined")throw new Error(g+' element has both acre:itemprop= and mjt.for="" attributes');c="itemvalue["+this.jsencode(j.itemprop)+
"]";j["for"]="itemindex,itemvalue in ((typeof "+c+' == "object" && '+c+" !== null && "+c+" instanceof Array) ? "+c+" : ["+c+"])";if(h in r){c=r[h];c in o||l.push({name:c,value:"$itemvalue"})}else if(b.firstChild===null)j.content="itemvalue";e.push(function(){var p=j.itemprop;if(h in r){var t=r[h];q.item[p]=t in l?l[t]:null}else q.item[p]=b.firstChild===null?null:q.lastvalue})}if(typeof j["for"]!="undefined"){var v=/^(\w+)(\s*,\s*(\w+))?\s+in\s+(.+)$/.exec(j["for"]);if(v){c=v[1];n=v[3];v=v[4];var u;
if(n){u=c;c=n}else{u=this.uniqueid(c+"_index");c=c}this.emitln("__pkg.runtime.foreach(this, (",v,"), function (",u,", ",c,") {");var A=this.uniqueid("once");this.emitln("var ",A," = 1;");this.emitln("while (",A,") {");e.push(function(){this.emitln(A,"--;");this.emitln("} /* while once */");this.emitln("return ",A," ? __pkg.runtime._break_token :  __pkg.runtime._continue_token;");this.emitln("}); /* foreach */")})}else if(j["for"].charAt(0)=="("){this.emitln("for ",j["for"]," {");e.push(function(){this.emitln("}")})}else a.warn("bad mjt.for= syntax")}if(typeof j["if"]!=
"undefined"){this.emitln("if (",j["if"],") {");e.push(function(){this.emitln("}")})}if(typeof j.elif!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and elif=""');this._markup=[];this.emitln("else if (",j.elif,") {");e.push(function(){this.emitln("}")})}if(typeof j["else"]!="undefined"){if(!/^\s*$/.exec(this._markup.join("")))throw new Error('only whitespace is permitted between if="" and else=""');this._markup=[];this.emitln("else {");
e.push(function(){this.emitln("}")})}if(typeof j.script!="undefined"){k=false;switch(j.script){case "":break;case "1":break;case "ondomready":k=true;break;default:a.warn("reserved mjtattrs.script= value:",j.script);break}k&&this.emitln("__pkg.runtime.ondomready(function () {");if(c=b.firstChild)if(c.nodeType!=3||c.nextSibling)a.warn("the mjt.script element can only contain javascript text, not HTML.  perhaps you need to quote '<', '>', or '&' (this is unlike a <script> tag!)");else{c=c?c.nodeValue:
"";c.match(/\/\/ /)&&this.browser_dom&&a.warn('"//" comments in mjt.script= definition will fail on IE6');c=c.split("\n");for(n=0;n<c.length;n++){this.emitln(c[n]);this.source_loc++}}k&&this.emitln("}, this);");f=false;k=null}if(typeof j.choose!="undefined"){this.flush_markup();k=function(p){this.compile_choose(p,j.choose)}}if(typeof j.replace!="undefined"){f=false;k=function(){this.emitln("__m[__n++]=(",j.replace,");")}}if(typeof j.content!="undefined")k=function(){this.emitln("__m[__n++]=(",j.content,
");")};for(var w in j)if(w.substr(0,2)=="on")if(this.browser_target){n={name:w,value:this.compile_onevent_attr(w,j[w])};l.push(n)}else a.warn("mjt:onevent= attributes only make sense if targeting a browser");this.debug&&this.browser_dom&&typeof j.def!="undefined"&&l.push({name:"mjt_template",value:j.def});if(q&&typeof j.item!="undefined"){"item"in o||l.push({name:"item",value:j.item});q.stack.push(q.item);if("id"in o){c=o.id.value;q.item=c in q.items?q.items[c]:(q.items[c]={})}else q.item={};if(j.item!=
"")q.item.__type=j.item;this.emitln("var item = itemvalue;");e.push(function(){q.lastvalue=q.item;q.item=q.stack.pop()})}if(q&&typeof j.itemfor!="undefined"){"itemfor"in o||l.push({name:"itemfor",value:j.itemfor});q.stack.push(q.item);if(typeof q.items[j.itemfor]=="undefined")q.items[j.itemfor]={};q.item=q.items[j.itemfor];e.push(function(){q.lastvalue=q.item;q.item=q.stack.pop()})}o=typeof j.strip!="undefined"?j.strip:null;w=null;if(o=="1")f=false;if(f){c=typeof j.attrs!="undefined"?j.attrs:null;
if(o!==null){w=this.uniqueid("strip");this.emitln("var ",w," = (",o,");");this.emitln("if (!",w,") {")}d&&typeof j.def==="undefined"&&this.markup(d);typeof j.def!="undefined"?this.generate_open_tag(g,l,c,true):this.generate_open_tag(g,l,c,false);k===null&&this.output_mode=="xml"?this.markup("/>"):this.markup(">");o!==null&&this.emitln("}")}if(k!==null)if(h in this.empty_tags)a.warn('tag "'+g+'" must be empty, content ignored');else var z=k.apply(this,[b]);if(f)if(!(k===null&&this.output_mode=="xml"))if(!(h in
this.empty_tags))if(w){this.emitln("if (!",w,") {");typeof z!=="undefined"&&this.markup(z);this.markup("</",g,">");this.emitln("}")}else{typeof z!=="undefined"&&this.markup(z);this.markup("</",g,">")}for(d=e.length-1;d>=0;d--)e[d].apply(this,[])}}}})(mjt);
(function(a){a.App=function(b){if(typeof b=="undefined")b={};this.state=null;this.yui_history_id="mjtapp";this.argschema={"mjt.server":{key:"mjt.server",statekey:"service_url",validator:a.validators.service_host},"mjt.debug":{key:"mjt.debug",statekey:"debug",validator:a.validators.flag}};for(var c in b)this.argschema[c]=b[c];this._onstatechange={};this.init()};a.App.prototype.init=function(){this.init_state();a.service_url=this.state.service_url;a.freebase.set_service_url(this.state.service_url);
a.debug=this.state.debug;a.Task.debug=this.state.debug;a.urlquery=this.state;return this};a.App.prototype.onstatechange=function(){this._onstatechange[a.uniqueid("statecb")]=a.vthunk(arguments);return this};a.App.prototype.refresh=function(){for(var b in this._onstatechange)this._onstatechange[b].apply(this,[]);return this};a.App.prototype._handle_onhistory=function(b){a.log("yui setting state",b,typeof this.state);if(b===null){b=YAHOO.util.History.getCurrentState(this.yui_history_id);a.log("yui history onLoadEvent:",
b)}else a.log("yui history state:",b);this.state=rison.decode_object(b);this.refresh()};a.App.prototype.init_state=function(){var b;if(typeof window!="undefined")b=window.location.search;if(typeof acre!="undefined")b=acre.environ.query_string;this.state=typeof b=="string"&&b.length>0&&b.charAt(0)=="?"?this.decode_uristate(b.substr(1)):this.decode_uristate("");if(typeof YAHOO==="undefined"||!YAHOO.util.History)return this;b=YAHOO.util.History;var c=b.getBookmarkedState(this.yui_history_id);c||(c=rison.encode_object(this.state));
a.log("yui history initial state",c);b.register(this.yui_history_id,c,a.vthunk("_handle_onhistory",this));b.onLoadEvent.subscribe(a.vthunk("_handle_onhistory",this,null));b.initialize("yui-history-iframe","yui-history-field");return this};a.App.prototype.mark_history=function(){if(this.yui_history_id!==null){var b=rison.encode_object(this.state);YAHOO.util.History.navigate(this.yui_history_id,b)}};a.Validator=function(){};a.Validator.prototype.encode=function(b){if(b!=this.default_value)return this.encodestr(b)};
a.Validator.prototype.decode=function(b){if(typeof b=="undefined")return this.default_value;return this.decodestr(b)};a.validators={};a.validators.flag=new a.Validator;a.validators.flag.default_value=false;a.validators.flag.encodestr=function(b){return b?"1":undefined};a.validators.flag.decodestr=function(b){return b=="1"?true:false};a.validators.service_host=new a.Validator;a.validators.service_host.default_value="http://www.freebase.com";a.validators.service_host.encodestr=function(b){b=b.replace(/^http:\/\//,
"");if(typeof window!="undefined"&&b==window.location.host)return".";return b};a.validators.service_host.decodestr=function(b){if(b.substr(0,4)=="http")url=b;else if(b=="."){if(typeof window!="undefined")url=window.location.protocol+"//"+window.location.host;if(typeof acre!="undefined")url=acre.environ.server_protocol+"//"+acre.environ.host}else url="http://"+b;return url};a.App.prototype.encode_uristate=function(b){var c={},d,e,f={};for(d in this.argschema){e=this.argschema[d];f[e.statekey]=e}for(d in this.state){e=
f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(this.state[d]);else c[d]=this.state[d]}for(d in b){e=f[d];if(typeof e!="undefined")c[e.key]=e.validator.encode(b[d]);else c[d]=b[d]}for(d in c)typeof c[d]=="undefined"&&delete c[d];return a.formencode(c)};a.App.prototype.decode_uristate=function(b){var c={},d=a.formdecode(b),e;for(e in d){b=this.argschema[e];if(typeof b!="undefined")c[b.statekey]=b.validator.decode(d[e]);else c[e]=d[e]}for(e in this.argschema){b=this.argschema[e];d=b.statekey;
if(!(d in c))c[d]=b.validator.default_value}return c};a.App.prototype.href=function(b,c){if(typeof b=="undefined"||b===null)b=location.protocol+"//"+location.host+location.pathname;var d=this.encode_uristate(c);return b+(d?"?"+d:"")}})(mjt);
typeof jQuery!="undefined"&&function(a){function b(d,e,f){var g="";if(typeof d==="string"){var h=c[d];if(typeof h==="object"){h=h[e];if(typeof h==="function")g=mjt.flatten_markup(h.apply(this,f));else console.warn("acre template '"+e+"' does not exist in package '"+d+"'")}else console.warn("acre template package '"+d+"' has not been registered")}else g=mjt.flatten_markup(d);return g}if(typeof a!="undefined"){var c={};a(window).bind("acre.template.register",function(d,e){var f=e.pkgid,g=e.source;if(typeof f===
"string"&&typeof g==="object"){if(g.def)g=(new mjt.TemplatePackage).init_from_js(g).toplevel();c[f]=g}});a.fn.mjt=function(d){var e=mjt.flatten_markup(d);return this.each(function(){this.innerHTML=e})};a.fn.acre=function(d,e,f){return this.each(function(){a(this).html(b(d,e,f))})};a.acre=function(d,e,f){return b(d,e,f)}}}(jQuery);
(function(a){function b(e,f){var g=this,h=e.add(g),j=a(window),l,o,n,k=a.tools.expose&&(f.mask||f.expose),m=Math.random().toString().slice(10);if(k){if(typeof k=="string")k={color:k};k.closeOnClick=k.closeOnEsc=false}var r=f.target||e.attr("rel");o=r?a(r):e;if(!o.length)throw"Could not find Overlay: "+r;e&&e.index(o)==-1&&e.click(function(q){g.load(q);return q.preventDefault()});a.extend(g,{load:function(q){if(g.isOpened())return g;var v=d[f.effect];if(!v)throw'Overlay: cannot find effect : "'+f.effect+
'"';f.oneInstance&&a.each(c,function(){this.close(q)});q=q||a.Event();q.type="onBeforeLoad";h.trigger(q);if(q.isDefaultPrevented())return g;n=true;k&&a(o).expose(k);var u=f.top,A=f.left,w=o.outerWidth({margin:true}),z=o.outerHeight({margin:true});if(typeof u=="string")u=u=="center"?Math.max((j.height()-z)/2,0):parseInt(u,10)/100*j.height();if(A=="center")A=Math.max((j.width()-w)/2,0);v[0].call(g,{top:u,left:A},function(){if(n){q.type="onLoad";h.trigger(q)}});k&&f.closeOnClick&&a.mask.getMask().one("click",
g.close);f.closeOnClick&&a(document).bind("click."+m,function(p){a(p.target).parents(o).length||g.close(p)});f.closeOnEsc&&a(document).bind("keydown."+m,function(p){p.keyCode==27&&g.close(p)});return g},close:function(q){if(!g.isOpened())return g;q=q||a.Event();q.type="onBeforeClose";h.trigger(q);if(!q.isDefaultPrevented()){n=false;d[f.effect][1].call(g,function(){q.type="onClose";h.trigger(q)});a(document).unbind("click."+m).unbind("keydown."+m);k&&a.mask.close();return g}},getOverlay:function(){return o},
getTrigger:function(){return e},getClosers:function(){return l},isOpened:function(){return n},getConf:function(){return f}});a.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(q,v){a.isFunction(f[v])&&a(g).bind(v,f[v]);g[v]=function(u){a(g).bind(v,u);return g}});l=o.find(f.close||".close");if(!l.length&&!f.close){l=a('<a class="close"></a>');o.prepend(l)}l.click(function(q){g.close(q)});f.load&&g.load()}a.tools=a.tools||{version:"@VERSION"};a.tools.overlay={addEffect:function(e,
f,g){d[e]=[f,g]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!a.browser.msie||a.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var c=[],d={};a.tools.overlay.addEffect("default",function(e,f){var g=this.getConf(),h=a(window);if(!g.fixed){e.top+=h.scrollTop();e.left+=h.scrollLeft()}e.position=g.fixed?"fixed":"absolute";this.getOverlay().css(e).fadeIn(g.speed,f)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,
e)});a.fn.overlay=function(e){var f=this.data("overlay");if(f)return f;if(a.isFunction(e))e={onBeforeLoad:e};e=a.extend(true,{},a.tools.overlay.conf,e);this.each(function(){f=new b(a(this),e);c.push(f);a(this).data("overlay",f)});return e.api?f:this}})(jQuery);
(function(a){a.factory("paneldrawer",{init:function(){var b=this,c=this.options,d=this.element;this.headers=a("."+c.css_panel_header,d);this.panel_content=a(d).find("."+c.css_panel_content);this.drawer_content=a(d).find("."+c.css_drawer_content);this.drawer_toggle=a(d).find("."+c.css_drawer_toggle);this.drawer_toggle.click(function(){return b.toggle()});d.css("overflow","hidden");this.drawer_height=this.options.drawer_height||this.drawer_content.outerHeight();this.headers_height=0;a("."+c.css_panel_header,
d).each(function(e,f){b.headers_height+=a(f).outerHeight()});this.toggle_state=this.options.toggle_state;this.options.init_height&&this.set_height(a(d).innerHeight())},set_height:function(b){this.total_height=b;this.finish_toggle(this.toggle_state);this.panel_content.height(this.total_height-this.headers_height-(this.toggle_state?this.drawer_height:0))},finish_toggle:function(b){if(this.toggle_state=b){this.drawer_content.height(this.drawer_height);this.drawer_toggle.removeClass("collapsed")}else{this.drawer_content.height(0);
this.drawer_toggle.addClass("collapsed")}this.options.init_height||this.element.css("height","initial");this.options.toggle_callback&&this.options.toggle_callback.call(this.drawer_toggle,this.toggle_state)},toggle:function(){var b=this,c=this.panel_content.height();this.element.height(this.total_height);if(this.toggle_state)if(this.options.animate)this.panel_content.animate({height:"+="+this.drawer_height},function(){b.finish_toggle(!b.toggle_state)});else{this.panel_content.height(c+this.drawer_height);
this.finish_toggle(!this.toggle_state)}else if(this.options.animate)this.panel_content.animate({height:"-="+this.drawer_height},function(){b.finish_toggle(!b.toggle_state)});else{this.panel_content.height(c-this.drawer_height);this.finish_toggle(!this.toggle_state)}return false}});a.extend(true,a.paneldrawer,{defaults:{css_panel_header:"panel-header",css_panel_content:"panel-content",css_drawer_header:"drawer-header",css_drawer_content:"drawer-content",css_drawer_toggle:"drawer-toggle",animate:true,
toggle_state:true,init_height:true}})})(jQuery);
"CueCard"in window||function(){window.CueCard={loaded:false,version:"trunk",loadingScriptsCount:0,error:null,helper:"http://www.freebase.com/cuecard/",apiProxy:{base:"http://www.freebase.com/cuecard/",read:"mqlread.sjs?",write:"mqlwrite.sjs?"},freebaseServiceUrl:"http://www.freebase.com/",params:{bundle:true,externals:true}};CueCard.findScript=function(b,c){for(var d=b.documentElement.getElementsByTagName("head"),e=0;e<d.length;e++)for(var f=d[e].firstChild;f!=null;){if(f.nodeType==1&&f.tagName.toLowerCase()==
"script"){var g=f.src;if(g.indexOf(c)>=0)return g}f=f.nextSibling}return null};CueCard.parseURLParameters=function(b,c,d){c=c||{};d=d||{};if(typeof b=="undefined")b=location.href;var e=b.indexOf("?");if(e<0)return c;b=(b+"#").slice(e+1,b.indexOf("#"));var f=b.split("&"),g;b={};var h=window.decodeURIComponent||unescape;for(e=0;g=f[e];e++){var j=g.indexOf("="),l=h(g.slice(0,j).replace(/\+/g," ")),o=b[l];if(typeof o=="undefined")o=[];else o instanceof Array||(o=[o]);b[l]=o.concat(h(g.slice(j+1).replace(/\+/g,
" ")))}for(e in b)if(b.hasOwnProperty(e)){f=d[e]||String;g=b[e];g instanceof Array||(g=[g]);c[e]=f===Boolean&&g[0]=="false"?false:f.apply(this,g)}return c};if(typeof CueCard_urlPrefix=="string")CueCard.urlPrefix=CueCard_urlPrefix;else{var a=CueCard.findScript(document,"cuecard-api.js");if(a==null){CueCard.error=new Error("Failed to derive URL prefix for CueCard API code files");return}CueCard.urlPrefix=a.substr(0,a.indexOf("cuecard-api.js"))}CueCard.parseURLParameters(a,CueCard.params,{bundle:Boolean,
externals:Boolean});CueCard.loaded=true}();
CueCard.createComposition=function(a){var b=new CueCard.QueryEditor(a.queryEditorElement,a.queryEditorOptions),c=null,d=null;if("outputPaneElement"in a){c=a.outputPaneOptions||{};c.queryEditor=b;c=new CueCard.OutputPane(a.outputPaneElement,c);b.setOutputPane(c)}if("controlPaneElement"in a){d=a.controlPaneOptions||{};d.queryEditor=b;if(c!=null)d.outputPane=c;d=new CueCard.ControlPane(a.controlPaneElement,d);b.setControlPane(d)}return{queryEditor:b,outputPane:c,controlPane:d}};
CueCard.showDialog=function(a){var b=Array.prototype.slice.call(arguments);b.shift();var c=$("<div id='dialog-"+a+"' class='modal'></div>").acre(fb.acre.current_script.app.path+"/cuecard/dialogs.mjt",a,b);$(document.body).append(c.hide());c.overlay({load:true,mask:{color:"#000",loadSpeed:200,opacity:0.5},close:".modal-buttons .button",closeOnClick:false,onClose:function(){c.remove()}})};CueCard.MqlSyntax={};
CueCard.MqlSyntax.KeywordSuggestions=[{label:"*",hint:"(keyword)",qualifiedProperty:"*",result:"*"},{label:"connect",hint:"(keyword)",qualifiedProperty:"connect",result:"connect"},{label:"create",hint:"(keyword)",qualifiedProperty:"create",result:"create"},{label:"estimate-count",hint:"(keyword)",qualifiedProperty:"estimate-count",result:"estimate-count"},{label:"limit",hint:"(keyword)",qualifiedProperty:"limit",result:"limit"},{label:"optional",hint:"(keyword)",qualifiedProperty:"optional",result:"optional"},
{label:"return",hint:"(keyword)",qualifiedProperty:"return",result:"return"},{label:"sort",hint:"(keyword)",qualifiedProperty:"sort",result:"sort"}];
CueCard.MqlSyntax.KeywordValueHints={"*":{choices:[{label:"null",hint:"return a single value",result:null},{label:"[]",hint:"return a list of values",result:[],offset:1},{label:"{}",hint:"return a single object",result:{},offset:1},{label:"[{}]",hint:"return a list of objects",result:[{}],offset:2}]},connect:{choices:[{label:"insert",hint:"attach a value or object to a non-unique property, or attach the first value or object to a unique property",result:"insert"},{label:"update",hint:"attach a value or object to a unique property replacing any value or object that was previously connected",
result:"update"},{label:"replace",hint:"update unique properties and performs an insert for non-unique properties",result:"replace"},{label:"delete",hint:"detach a value or object from any property",result:"delete"}]},create:{choices:[{label:"unless_exists",hint:"look for a matching object and create it if it doesn't exist",result:"unless_exists"},{label:"unless_connected",hint:"look for a matching object connected to the parent query, and create and connect it if it doesn't exist",result:"unless_connected"},
{label:"unconditional",hint:"create the specified object without looking for a match (dangerous; ues carefully)",result:"unconditional"}]},"estimate-count":{choices:[{label:"null",hint:"(keyword)",result:null}]},limit:{html:'Use a positive integer to limit how many results to return, or <span class="cuecard-code">0</span> for all available results.'},optional:{choices:[{label:"true",hint:"(keyword)",result:true},{label:"false",hint:"(keyword)",result:false},{label:"required",hint:"(keyword)",result:"required"},
{label:"forbidden",hint:"(keyword)",result:"forbidden"}]},"return":{choices:[{label:"count",hint:"(keyword)",result:"count"},{label:"estimate-count",hint:"(keyword)",result:"estimate-count"}]},sort:{html:'Use a property name in the same query node. Prefix it with <span class="cuecard-code">-</span> to sort in descending order. For more complex ordering, see <a href="">this documentation</a>.'}};
CueCard.MqlSyntax.UniqueTopicValueSuggestions=[{label:"null",hint:"returns a single topic ID",result:null},{label:"{}",hint:"returns a single topic object with a default set of properties",result:{},offset:1},{label:'{ "id" : null, "name" : null }',hint:"returns a single topic object with id and name",result:{id:null,name:null}}];
CueCard.MqlSyntax.TopicValueSuggestions=[{label:"[]",hint:"returns a list of topic IDs or topic names",result:[],offset:1},{label:"[{}]",hint:"returns a list of topic objects with a default set of properties",result:[{}],offset:2},{label:'[{ "id" : null, "name" : null, "optional" : true, "limit" : 10 }]',hint:"returns an optional, limited list of topic objects with id and name",result:[{id:null,name:null,optional:true,limit:10}]}];
CueCard.MqlSyntax.SingleValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "type" : null }',hint:"returns a value with type",result:{value:null,type:null}}];CueCard.MqlSyntax.UniqueStringLiteralValueSuggestions=[{label:"null",hint:"returns a single string",result:null},{label:'{ "value" : null, "lang" : null, "optional" : true }',hint:"returns a single string with more options",result:{value:null,lang:null,optional:true}}];
CueCard.MqlSyntax.StringLiteralValueSuggestions=[{label:"[]",hint:"returns a list of strings",result:null},{label:'[{ "value" : null, "lang" : null, "optional" : true }]',hint:"returns a list of strings with more options",result:[{value:null,lang:null,optional:true}]}];CueCard.MqlSyntax.UniqueLiteralValueSuggestions=[{label:"null",hint:"returns a single value",result:null},{label:'{ "value" : null, "optional" : true }',hint:"returns a single value with more options",result:{value:null,optional:true}}];
CueCard.MqlSyntax.LiteralValueSuggestions=[{label:"[]",hint:"returns a list of values",result:null},{label:'[{ "value" : null, "optional" : true }]',hint:"returns a list of values with more options",result:[{value:null,optional:true}]}];CueCard.SerializingContext=function(a){this._parent=a;this._root=a==null?this:a.getRoot();this._properties={}};
CueCard.SerializingContext.prototype={getProperty:function(a){return a in this._properties?this._properties[a]:this._parent!=null?this._parent.getProperty(a):null},setProperty:function(a,b){this._properties[a]=b},getRoot:function(){return this._root},getRootProperty:function(a){return this.getRoot().getProperty(a)},setRootProperty:function(a,b){return this.getRoot().setProperty(a,b)},create:function(){return new SerializingContext(this)}};
CueCard.IndentWriter=function(a){this._context=a;this._stream=a.getProperty("stream")};
CueCard.IndentWriter.prototype={appendLineBreak:function(){this._stream.append("\n")},appendIndent:function(){for(var a=this._context.getRootProperty("indentLevel"),b=this._context.getRootProperty("indentString"),c=0;c<a;c++)this._stream.append(b)},indent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")+1)},unindent:function(){this._context.setRootProperty("indentLevel",this._context.getRootProperty("indentLevel")-1)},append:function(a){this._stream.append(a)}};
(function(){function a(g){return/["\\\x00-\x1f]/.test(g)?g.replace(/([\x00-\x1f\\"])/g,function(h,j){var l=e[j];if(l)return l;l=j.charCodeAt();return"\\u00"+Math.floor(l/16).toString(16)+(l%16).toString(16)}):g}function b(g){return g!=null&&typeof g=="object"&&!(g instanceof Array)&&!("__identifier__"in g)}function c(g){for(var h in g)if(g.hasOwnProperty(h))return true;return false}function d(g){return g.length==0||g.length==1&&b(g[0])&&!c(g[0])}var e={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f",
"\r":"\\r",'"':'\\"',"'":"\\'","\\":"\\\\"},f=CueCard.jsonize=function(g,h){h=h?h:{};var j="",l="quoteAllFieldNames"in h?h.quoteAllFieldNames:true,o="variables"in h?h.variables:{},n="resolveVariables"in h?h.resolveVariables:false;if("context"in h)var k=new CueCard.SerializingContext(h.context);else{var m="indentCount"in h?h.indentCount:4,r="";for(k=0;k<m;k++)r+=" ";k=new CueCard.SerializingContext(null);k.setProperty("indentCount",m);k.setProperty("indentString",r);k.setProperty("indentLevel",0);
k.setProperty("stream",{append:function(q){j+=q}})}k.setProperty("omitWhitespace","omitWhitespace"in h?h.omitWhitespace:false);k.setProperty("maxFieldLength","maxFieldLength"in h?h.maxFieldLength:15);k.setProperty("breakLines","breakLines"in h?h.breakLines:true);k.setProperty("alignFieldValues","alignFieldValues"in h?h.alignFieldValues:true);k.setProperty("collapseSingleObjectArray","collapseSingleObjectArray"in h?h.collapseSingleObjectArray:true);k.setProperty("variables",o);k.setProperty("resolveVariables",
n);k.setProperty("encodeJavascriptString","encodeJavascriptString"in h?h.encodeJavascriptString:a);k.setRootProperty("fieldNameEncoder",{_m:{},encode:function(q){if(q in this._m)return this._m[q];else{var v=a(q);return this._m[q]=v=l||/\W/.test(v)?'"'+v+'"':v}}});k.setProperty("path",[]);k.setRootProperty("contextualize","contextualize"in h?h.contextualize:function(q){return q});o=new CueCard.IndentWriter(k);f.converters.anything(g,k,o);return j};f.converters={anything:function(g,h,j){if(g==null)f.converters["null"](g,
h,j);else if(g instanceof Array)f.converters.array(g,h,j);else g instanceof Object?f.converters.object(g,h,j):f.converters[typeof g](g,h,j)},array:function(g,h,j){var l=h.getProperty("omitWhitespace"),o=h.getProperty("breakLines");if(g.length==0)j.append("[]");else{if(g.length==1)if(b(g[0]))if(c(g[0])){if(h.getProperty("collapseSingleObjectArray")){j.append("[");var n=g[0];f.converters.object(n,h,j);j.append("]");return}}else{j.append("[{}]");return}j.append("[");if(o){j.appendLineBreak();j.indent()}else l||
j.append(" ");for(var k=g.length,m=0;m<k;m++){n=g[m];var r=f.converters[n==null?"null":typeof n];if(r){o&&j.appendIndent();r(n,h,j);m<k-1&&j.append(",");if(o)j.appendLineBreak();else l||j.append(" ")}}if(o){j.unindent();j.appendIndent()}j.append("]")}},"boolean":function(g,h,j){j.append(String(g))},"null":function(g,h,j){j.append("null")},undefined:function(g,h,j){j.append("undefined")},number:function(g,h,j){j.append(isFinite(g)?String(g):"null")},object:function(g,h,j){if(g instanceof Array)f.converters.array(g,
h,j);else if("__identifier__"in g){g=g.__identifier__;var l=h.getProperty("resolveVariables"),o=h.getProperty("variables");if(g in o)if(l){l=o[g];f.converters.anything(l,h,j)}else j.append(g);else f.converters.anything(g,h,j)}else{o=h.getRootProperty("contextualize");var n=h.getProperty("path"),k=h.getProperty("omitWhitespace"),m=h.getProperty("breakLines"),r=h.getProperty("alignFieldValues");j.append("{");if(m){j.appendLineBreak();j.indent()}else k||j.append(" ");var q=0,v=0,u=h.getRootProperty("fieldNameEncoder");
for(var A in g)if(g.hasOwnProperty(A)){l=g[A];q++;if(!b(l)&&(!(l!=null&&l instanceof Array)||d(l)))v=Math.max(v,u.encode(A).length)}v=Math.min(v,h.getProperty("maxFieldLength"));for(A in g)if(g.hasOwnProperty(A)){l=g[A];var w=f.converters[l==null?"null":typeof l],z=u.encode(A);m&&j.appendIndent();j.append(z);j.append(k?":":": ");if(!k&&m&&r&&!b(l)&&(!(l!=null&&l instanceof Array)||d(l)))for(z=z.length;z<v;z++)j.append(" ");n.unshift({field:A});w(l,o(h,n),j);n.shift();q--;q>0&&j.append(",");if(m)j.appendLineBreak();
else k||j.append(" ")}if(m){j.unindent();j.appendIndent()}j.append("}")}},string:function(g,h,j){j.append('"'+h.getProperty("encodeJavascriptString")(g)+'"')},"null":function(g,h,j){j.append("null")}}})();CueCard.QueryParser={};
CueCard.QueryParser.parseForContext=function(a,b,c,d){var e=new CueCard.QueryTokenizer(a,b),f=e.token(),g=[],h=CueCard.Token.Types,j=function(){f=g.length==0?e.next():g.shift()},l=function(s){if(s==0)return f;else{for(;s>g.length;)g.push(e.next());return g[s-1]}},o=function(){for(;f!=null&&(f.type==h.whitespace||f.type==h.unrecognized);)j()},n=function(s){return new CueCard.Token(CueCard.Token.Types.phantom,"",s.start,s.start)},k=function(){return f!=null?f:new CueCard.Token(CueCard.Token.Types.phantom,
"",e.index(),e.index())},m=function(){var s=new CueCard.QueryNode(CueCard.QueryNode.TYPE_MISSING);s.startToken=s.endToken=n(k());return s},r=function(s){s=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL);s.startToken=f;for(f!=null&&f.type==h.delimiter&&f.content=="{"&&j();f!=null;){o();if(f==null)break;var y=null,B=null,C=null;if(f.type==h.identifier){y=f.content;B=f;j();o()}else if(f.type==h.stringLiteral){y=f.content.replace(/^['"]/,"").replace(/['"]$/,"");B=f;j();o()}else B=n(f);if(f!=
null&&f.type==h.delimiter&&(f.content==":"||f.content==";")){j();o()}if(f!=null)C=u(false);if(y!=null||C!=null){y=new CueCard.QueryNodeLink(y!=null?y:"",B);y.value=C!=null?C:m();s.links.push(y)}o();if(f==null||f.type==h.delimiter&&(f.content=="}"||f.content=="]"))break;f.type==h.delimiter&&f.content==","&&j()}if(f!=null&&f.type==h.delimiter&&f.content=="}"){s.endToken=f;j()}if(s.endToken==null)s.endToken=k();return s},q=function(){var s=new CueCard.QueryNode(CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY);
s.startToken=f;s.elements=[];for(f!=null&&f.type==h.delimiter&&f.content=="["&&j();f!=null;){o();if(f==null||f.type==h.delimiter&&f.content=="]")break;s.elements.push(r());o();f!=null&&f.type==h.delimiter&&f.content==","&&j()}if(f!=null&&f.type==h.delimiter&&f.content=="]"){s.endToken=f;j()}if(s.endToken==null)s.endToken=k();return s},v=function(){for(var s=1,y;(y=l(s))!=null&&(y.type==h.whitespace||y.type==h.unrecognized);)s++;if(y!=null)if(y.type==h.delimiter&&y.content=="{")return q();else if(y.type==
h.identifier||y.type==h.stringLiteral){for(s++;(y=l(s))!=null&&(y.type==h.whitespace||y.type==h.unrecognized);)s++;if(y!=null&&y.type==h.delimiter&&y.content==":")return q()}s=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);s.startToken=f;s.isArray=true;s.value=[];for(f!=null&&f.type==h.delimiter&&f.content=="["&&j();f!=null;){o();if(f==null||f.type==h.delimiter&&f.content=="]")break;y=u(false);if(y==null)break;s.value.push(y);o();f!=null&&f.type==h.delimiter&&f.content==","&&j()}if(f!=null&&
f.type==h.delimiter&&f.content=="]"){s.endToken=f;j()}if(s.endToken==null)s.endToken=k();return s},u=function(s){o();if(f==null)s=m();else{if(f.type==h.delimiter)s=f.content=="["?v():f.content=="{"?r():m();else{if(s)s=q();else a:{s=new CueCard.QueryNode(CueCard.QueryNode.TYPE_TERMINAL);s.startToken=s.endToken=f;s.isArray=false;if(f.type==h.numberLiteral)s.value=parseFloat(f.content);else if(f.type==h.stringLiteral)s.value=f.content.replace(/^['"]/,"").replace(/['"]$/,"");else if(f.type==h.booleanLiteral)s.value=
f.content=="true"||f.content=="True";else if(f.type==h.nullLiteral)s.value=null;else if(f.type==h.delimiter){s=null;break a}else s.value=f.content;j();s=s}s=s}s=s}return s},A=function(s){return c<s.start.line||c==s.start.line&&d<=s.start.col},w=function(s){return c>s.start.line||c==s.start.line&&d>=s.start.col},z=function(s){return c<s.end.line||c==s.end.line&&d<=s.end.col};A=function(s){return c<s.start.line||c==s.start.line&&d<=s.start.col};var p=function(s){return s.startToken==s.endToken?w(s.startToken)&&
z(s.startToken):w(s.startToken)&&A(s.endToken)},t=function(s,y){if(s.type==CueCard.QueryNode.TYPE_TERMINAL)if(s.isArray){for(var B=0;B<s.value.length;B++){var C=s.value[B];if(A(C.startToken)){y.push({child:B,relative:"before",node:s});return}else if(p(C)){y.push({child:B,relative:"inside",node:s});t(C,y);return}}y.push({child:s.value.length,relative:"before",node:s})}else y.push({token:s.startToken,node:s,offset:d-s.startToken.start.col});else if(s.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){for(B=
0;B<s.elements.length;B++){C=s.elements[B];if(A(C.startToken)){y.push({child:B,relative:"before",node:s});return}else if(p(C)){y.push({child:B,relative:"inside",node:s});t(C,y);return}}y.push({child:s.elements.length,relative:"before",node:s})}else if(s.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(B=0;B<s.links.length;B++){C=s.links[B];if(A(C.token)){y.push({child:B,relative:"before",node:s});return}else if(z(C.token)){y.push({child:B,relative:"path",node:s,offset:d-C.token.start.col});return}else if(w(C.value.startToken)){if(z(C.value.endToken)){y.push({child:B,
relative:"inside",node:s});t(C.value,y);return}}else{y.push({child:B,relative:"space",node:s});return}}y.push({child:s.links.length,relative:"before",node:s})}else y.push({token:s.startToken,node:s})};o();a={model:u(true),context:[]};t(a.model,a.context);return a};CueCard.QueryTokenizer=function(a,b){this._text=a+" ";this._maxIndex=a.length;this._index=b;this._col=this._line=0;this.next()};CueCard.QueryTokenizer.prototype.token=function(){return this._token};
CueCard.QueryTokenizer.prototype.index=function(){return this._index};CueCard.QueryTokenizer._whitespaces=" \t\r\n";
CueCard.QueryTokenizer.prototype.next=function(){this._token=null;if(this._index<this._maxIndex){var a=this._text.charAt(this._index),b=this._text.charAt(this._index+1),c=this,d=function(){c._index++;c._col++},e=function(){return new CueCard.TokenPos(c._index,c._line,c._col)},f=function(){var n=e();d();return n},g=function(n,k,m){var r=e();c._pos=r;c._token=new CueCard.Token(n,m||c._text.substring(k.offset,r.offset),k,r)},h=function(){for(var n=e();c._index<c._maxIndex;){var k=c._text.charAt(c._index);
if(CueCard.QueryTokenizer._whitespaces.indexOf(k)<0)break;if(k=="\n"){c._line++;c._col=0}else c._col++;c._index++}g(CueCard.Token.Types.whitespace,n)},j=function(n){var k=e();a=="u"&&d();d();for(var m="";c._index<c._maxIndex;){a=c._text.charAt(c._index);if(a==n){d();break}else if(a=="\r"||a=="\n")break;if(a=="\\"){d();m+=c._text.charAt(c._index)}else m+=a;d()}g(CueCard.Token.Types.stringLiteral,k,m)},l=function(){var n=e();if(a=="+")d();else a=="-"&&d();for(;c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d();
if(c._index<c._maxIndex&&c._text.charAt(c._index)==".")for(d();c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d();if(c._index<c._maxIndex&&c._text.charAt(c._index)=="e"){d();a=c._text.charAt(c._index);if(a=="+"||a=="-")d();for(;c._index<c._maxIndex&&CueCard.QueryTokenizer._isDigit(c._text.charAt(c._index));)d()}g(CueCard.Token.Types.numberLiteral,n)},o=function(){for(var n=e();c._index<c._maxIndex&&CueCard.QueryTokenizer._identifierPrefix.indexOf(c._text.charAt(c._index))>=
0;)d();var k=false;if(c._index<c._maxIndex-2){var m=c._text.substr(c._index,2);if(m==">="||m=="<="||m=="~="){d();d();k=true}}if(!k&&c._index<c._maxIndex-1){m=c._text.substr(c._index,1);if(m==">"||m=="<")d()}k=e();m=c._text.substring(n.offset,k.offset);c._pos=k;c._token=m=="null"||m=="None"?new CueCard.Token(CueCard.Token.Types.nullLiteral,m,n,k):m=="true"||m=="True"||m=="false"||m=="False"?new CueCard.Token(CueCard.Token.Types.booleanLiteral,m,n,k):new CueCard.Token(CueCard.Token.Types.identifier,
m,n,k)};if(CueCard.QueryTokenizer._whitespaces.indexOf(a)>=0)h();else if("[{}],:".indexOf(a)>=0)g(CueCard.Token.Types.delimiter,f());else if(a=='"'||a=="'")j(a);else if(a=="u"&&(b=='"'||b=="'"))j(b);else if(a=="-"||a=="+"||CueCard.QueryTokenizer._isDigit(a))l();else if(a=="*")g(CueCard.Token.Types.identifier,f());else CueCard.QueryTokenizer._identifierPrefix.indexOf(a)>=0?o():g(CueCard.Token.Types.unrecognized,f())}return this._token};
CueCard.QueryTokenizer._isDigit=function(a){return"0123456789".indexOf(a)>=0};CueCard.QueryTokenizer._identifierPrefix="#!/_-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";CueCard.TokenPos=function(a,b,c){this.offset=a;this.line=b;this.col=c};CueCard.Token=function(a,b,c,d){this.type=a;this.content=b;this.start=c;this.end=d};CueCard.Token.Types={unrecognized:-1,phantom:0,whitespace:1,delimiter:2,nullLiteral:3,numberLiteral:4,stringLiteral:5,booleanLiteral:6,identifier:7};
CueCard.QueryNode=function(a){this.type=a;this.value=null;this.isArray=false;this.endToken=this.startToken=null;this.links=[]};CueCard.QueryNode.TYPE_MISSING=-1;CueCard.QueryNode.TYPE_TERMINAL=0;CueCard.QueryNode.TYPE_NONTERMINAL=1;CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY=2;CueCard.QueryNode.prototype.toQueryJson=function(a){a=a||{};if(!("qualifyAllProperties"in a))a.qualifyAllProperties=false;if(!("excludeChild"in a))a.excludeChild=-1;return this._toQueryJson(a)};
CueCard.QueryNode.prototype._toQueryJson=function(a){var b={qualifyAllProperties:a.qualifyAllProperties,excludeChild:-1};if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray){a=[];for(var c=0;c<this.value.length;c++){var d=this.value[c];a.push(d!=null?d._toQueryJson(b):null)}return a}else return this.startToken.type==CueCard.Token.Types.identifier?{__identifier__:this.value}:this.value;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){a=[];for(c=0;c<this.elements.length;c++)a.push(this.elements[c]._toQueryJson(b));
return a}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){d={};var e=false,f=0;for(c=0;c<this.links.length;c++)if(c!=a.excludeChild){var g=this.links[c];if(g.path.length>0){var h=g.getPath(a.qualifyAllProperties);if(h in d&&g.namespace.length==0)for(;h in d;){g.namespace="ns"+f++ +":";h=g.getPath(a.qualifyAllProperties)}var j=g.value!=null?g.value._toQueryJson(b):null;d[h]=j;if(g.getUnnamespacedQualifiedPath()=="/type/object/type"&&j!=null&&(!(j instanceof Array)||j.length>0))e=true}}if(!e&&
"expectedTypes"in a&&a.expectedTypes.length>0){b=[];for(c=0;c<a.expectedTypes.length;c++){e=a.expectedTypes[c];e!="/type/object"&&e!="/common/topic"&&b.push(e)}if(b.length==1)d.type=b[0];else if(b.length>1)d["type|="]=b}return d}else return null};CueCard.QueryNode.isMqlKeyword=function(a){switch(a){case "limit":case "sort":case "*":case "return":case "count":case "estimate-count":case "optional":case "create":case "connect":return true}return false};
CueCard.QueryNode.prototype.getDeclaredTypes=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/type"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredIDs=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/id"&&!d.reverse&&d.getValuesOfType(a,"string")}};
CueCard.QueryNode.prototype.getDeclaredGUIDs=function(a){var b=null;if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL)b=this.links;else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)b=this.elements[0].links;if(b!=null)for(var c=0;c<b.length;c++){var d=b[c];d.qualifiedProperty=="/type/object/guid"&&!d.reverse&&d.getValuesOfType(a,"string")}};CueCard.QueryNode.prototype.qualifyAllProperties=function(a){this._qualifyAllProperties([],{},a)};
CueCard.QueryNode.prototype._qualifyAllProperties=function(a,b,c){if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){for(var d=[],e=false,f=[],g=[],h=[],j=0;j<this.links.length;j++){var l=this.links[j];if(l.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||l.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY||l.value.type==CueCard.QueryNode.TYPE_MISSING)d.push(l);if(l.qualifiedProperty=="/type/object/type"&&!l.reverse)l.getValuesOfType(f,"string");else if(l.qualifiedProperty=="/type/object/id"&&!l.reverse)l.getValuesOfType(g,
"string");else if(l.qualifiedProperty=="/type/object/guid"&&!l.reverse)l.getValuesOfType(h,"string");else if(l.qualifiedProperty!=null&&l.qualifiedProperty.length>0){var o=l.qualifiedProperty.lastIndexOf("/");o>0&&f.push(l.qualifiedProperty.substr(0,o))}else CueCard.QueryNode.isMqlKeyword(l.property)||(e=true)}f=f.concat(a);l={};for(j=f.length-1;j>=0;j--)l[f[j]]=true;f=[];for(var n in l)f.push(n);if(!e&&d.length==0)c.onDone(b);else{var k=this;e=[];f.length>0&&e.push("t="+encodeURIComponent(f.join(",")));
g.length>0&&e.push("i="+encodeURIComponent(g.join(",")));h.length>0&&e.push("g="+encodeURIComponent(h.join(",")));f=CueCard.helper+"qualify-properties.ajax?"+e.join("&");$.ajax(f,{dataType:"json",success:function(r){r=r.result;var q=r.properties;r=r.qualifications;for(var v=0;v<k.links.length;v++){var u=k.links[v];if(u.qualifiedProperty.length==0&&!CueCard.QueryNode.isMqlKeyword(u.property))u.qualifiedProperty=r[u.property]||u.property}for(var A in q)b[A]=q[A];(function(){if(d.length==0)c.onDone(b);
else{var w=d.shift(),z=[];if(w.qualifiedProperty in q)for(var p=q[w.qualifiedProperty].expectedTypes,t=0;t<p.length;t++)z.push(p[t].id);z.push("/common/topic");z.push("/type/object");if(w.value.type==CueCard.QueryNode.TYPE_NONTERMINAL)w.value.expectedTypes=z;else if(w.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){p=w.value.elements;for(t=0;t<p.length;t++)p[t].expectedTypes=z}w.value._qualifyAllProperties(z,b,{onDone:arguments.callee,onError:c.onError})}})()},error:c.onError})}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){j=0;var m=this.elements;(function(){j<m.length?m[j++]._qualifyAllProperties(a,b,{onDone:arguments.callee,onError:c.onError}):c.onDone(b)})()}else c.onDone()};CueCard.QueryNode.prototype.getCursorFromContext=function(a){return this._getCursorFromContext(a,0)};
CueCard.QueryNode.prototype._getCursorFromContext=function(a,b){var c=a[b];if(this.type==CueCard.QueryNode.TYPE_MISSING){var d=this.startToken;return{line:d.start.line,col:d.start.col}}else if(this.type==CueCard.QueryNode.TYPE_TERMINAL)if(this.isArray)if(c.relative=="inside")if(c.child<this.value.length)return this.value[c.child]._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.child<this.value.length){c=this.value[c.child];d=c.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else{d=this.startToken;return{line:d.start.line,col:d.start.col+("offset"in c?c.offset:0)}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if(c.relative=="inside")if(c.child<this.elements.length)return this.elements[c.child]._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.child<this.elements.length){c=this.elements[c.child];d=c.startToken;return{line:d.start.line,
col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(c.relative=="inside")if(c.child<this.links.length)return this.links[c.child].value._getCursorFromContext(a,b+1);else{d=this.endToken;return{line:d.start.line,col:d.start.col}}else if(c.relative=="before")if(c.child<this.links.length){c=this.links[c.child].value;d=c.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.startToken;return{line:d.end.line,col:d.end.col}}else if(c.child<this.links.length)if(c.relative==
"path"){d=this.links[c.child].token;return{line:d.start.line,col:d.start.col+("offset"in c?c.offset:0)}}else{d=this.links[c.child].value.startToken;return{line:d.start.line,col:d.start.col}}else{d=this.endToken;return{line:d.end.line,col:d.end.col}}};CueCard.QueryNode.prototype.toInsideOutQueryJson=function(a,b){var c=this;this.qualifyAllProperties({onDone:function(){b.onDone(c._toInsideOutQueryJson(a,0,null,null))},onError:b.onError})};
CueCard.QueryNode.prototype._toInsideOutQueryJson=function(a,b,c,d){if(c!=null&&!(d instanceof Array))d=[d];if(b<a.length){var e=a[b];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in e&&e.relative=="inside"){var f=e.child;if(f<this.links.length){e=this.links[f];if(e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||e.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){var g=e.getInverseQualifiedPath();f=this.toQueryJson({excludeChild:f});if(c!=null)if(f instanceof Array)f[0][c]=d;else f[c]=
d;return e.value._toInsideOutQueryJson(a,b+1,g,f)}}}}else if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in e&&e.relative=="inside"){f=e.child;if(this.elements.length>1)throw new Error("Cannot turn a query inside out if a query node has siblings");else if(f==0){a=this.elements[f]._toInsideOutQueryJson(a,b+1,c,d);return a instanceof Array?a:[a]}else return null}}a=this.toQueryJson({expectedTypes:"expectedTypes"in this?this.expectedTypes:[]});if(c!=null)if(typeof a==Array)a[0][c]=
d;else a[c]=d;return a};CueCard.QueryNode.prototype.locateInnerMostNonTerminal=function(a,b){var c=this;this.qualifyAllProperties({onDone:function(){var d=c._locateInnerMostNonTerminal(a,0);b.onDone(d!=null?d:{node:c,property:null,reverse:false})},onError:b.onError})};
CueCard.QueryNode.prototype._locateInnerMostNonTerminal=function(a,b){if(b<a.length){var c=a[b];if(this.type==CueCard.QueryNode.TYPE_NONTERMINAL){if("child"in c&&c.relative=="inside"){c=c.child;if(c<this.links.length){var d=this.links[c];if(d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.value.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){c=d.value._locateInnerMostNonTerminal(a,b+1);if(c==null)c={node:d.value};if(!("property"in c)){c.property=d.qualifiedProperty;c.reverse=d.reverse}return c}}}}else if(this.type==
CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY)if("child"in c&&c.relative=="inside"){c=c.child;if(c<this.elements.length){d=this.elements[c];c=d._locateInnerMostNonTerminal(a,b+1);if(c==null)c={node:d};return c}}}return null};
CueCard.QueryNodeLink=function(a,b){this.path=a;this.token=b;this.reverse=false;this.suffix=this.qualifiedProperty=this.originalProperty=this.property=this.namespace="";this.value=null;if(a.length>0)if(a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}if(a.length>0){var c=a.indexOf(":");if(c>=0){this.namespace=a.substr(0,c+1);a=a.substr(c+1);if(a.length>0&&a.charAt(0)=="!"){this.reverse=true;a=a.substr(1)}}}if(a.length>=2){c=a.substr(a.length-2);if(c==">="||c=="<="||c=="~="){this.suffix=c;a=a.substr(0,
a.length-2)}}if(a.length>1&&this.suffix==""){c=a.substr(a.length-1);if(c=="<"||c==">"){this.suffix=c;a=a.substr(0,a.length-1)}}this.originalProperty=a;if(a.length>0)if(a.charAt(0)=="/"){this.qualifiedProperty=a;c=a.lastIndexOf("/");this.property=a.substr(c+1)}else this.property=a;if(this.qualifiedProperty=="")if(this.property=="type")this.qualifiedProperty="/type/object/type";else if(this.property=="id")this.qualifiedProperty="/type/object/id";else if(this.property=="guid")this.qualifiedProperty=
"/type/object/guid";else if(this.property=="name")this.qualifiedProperty="/type/object/name";else if(this.property=="lang")this.qualifiedProperty="/type/text/lang";else if(CueCard.QueryNode.isMqlKeyword(this.property))this.qualifiedProperty=this.property};CueCard.QueryNodeLink.prototype.getQualifiedPath=function(){return(this.reverse?"!":"")+this.namespace+this.qualifiedProperty+this.suffix};
CueCard.QueryNodeLink.prototype.getInverseQualifiedPath=function(){return(this.reverse?"":"!")+this.namespace+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getUnnamespacedQualifiedPath=function(){return(this.reverse?"!":"")+this.qualifiedProperty+this.suffix};CueCard.QueryNodeLink.prototype.getPath=function(a){return(this.reverse?"!":"")+this.namespace+(a&&this.qualifiedProperty.length>0?this.qualifiedProperty:this.originalProperty)+this.suffix};
CueCard.QueryNodeLink.prototype.getValuesOfType=function(a,b){var c=function(g){if(g.isArray){g=g.value;for(var h=0;h<g.length;h++){var j=g[h];j.type==CueCard.QueryNode.TYPE_TERMINAL&&j.value!=null&&typeof j.value==b&&a.push(j.value)}}else g.value!=null&&typeof g.value==b&&a.push(g.value)},d=this.value;if(d.type==CueCard.QueryNode.TYPE_TERMINAL)c(d);else if(d.type==CueCard.QueryNode.TYPE_NONTERMINAL||d.type==CueCard.QueryNode.TYPE_NONTERMINAL_ARRAY){d=d.type==CueCard.QueryNode.TYPE_NONTERMINAL?d.links:
d.elements[0].links;for(var e=0;e<d.length;e++){var f=d[e];f.qualifiedProperty=="/type/value/value"&&f.value.type==CueCard.QueryNode.TYPE_TERMINAL&&c(f.value)}}};CueCard.UI={};CueCard.UI.reportError=function(a){try{console.log(a)}catch(b){alert(a)}};CueCard.UI.createBlockingContinuations=function(a,b){return new CueCard.UI.Cont(a,b)};
CueCard.UI.Cont=function(a,b){var c=this;this._onDone=a;this._onError=b||CueCard.UI.reportError;this._progressUI=null;this._cleanedUp=this._canceled=false;this.cleanUp=function(){if(!c._cleanedUp){c._cleanedUp=true;if(c._progressUI!=null){c._progressUI.remove();c._progressUI=null}}};this.cancel=function(){if(!c._canceled){c._canceled=true;c.cleanUp()}};this.onError=function(){c.cleanUp();c._onError()};this.onDone=function(){var d=false;if(!c._canceled){d=[c];for(var e=0;e<arguments.length;e++)d.push(arguments[e]);
d=c._onDone.apply(null,d)}d||c.cleanUp()};window.setTimeout(function(){if(!c._cleanedUp)c._progressUI=$('<div class="cuecard-progress">Working...</div>').appendTo($(document.body))},300)};CueCard.UI.Cont.prototype.isCanceled=function(){return this._canceled};CueCard.UI.Cont.prototype.extend=function(a,b){this._onDone=a;this._onError=b||this._onError;return this};
CueCard.Popup=function(a,b,c,d,e){this._left=a;this._top=b;this._height=c;this._windows=d;this._handlers=e||{};this._pendingContinuations=[];this.elmt=$('<div class="cuecard-popup-container"></div>').css("top",this._top+this._height+"px").css("left",this._left+"px").appendTo("body");this._addEventHandlers()};CueCard.Popup.prototype.addPendingContinuation=function(a){this._pendingContinuations.push(a)};
CueCard.Popup.prototype.reposition=function(){var a=this.elmt.height(),b=this.elmt.width();this._top+this._height+a>=$(window).height()?this.elmt.css("top",this._top-a-5+"px"):this.elmt.css("top",this._top+this._height+"px");this._left+b>=$(window).width()?this.elmt.css("left",$(window).width()-b-25+"px"):this.elmt.css("left",this._left+"px")};CueCard.Popup.prototype.close=function(){this._remove();this._pendingContinuations=null};
CueCard.Popup.prototype.cancel=function(){if(this.elmt!=null){this._remove();this._cancelPendingContinuations();this._pendingContinuations=null}};CueCard.Popup.prototype._remove=function(){this._removeEventHandlers();this.elmt.remove();this.elmt=null};CueCard.Popup.prototype._cancelPendingContinuations=function(){for(var a=0;a<this._pendingContinuations.length;a++)try{this._pendingContinuations[a].cancel()}catch(b){}this._pendingContinuations=[]};
CueCard.Popup.prototype._addEventHandlers=function(){var a=this;this._handleKeyDown=function(e){return a._onKeyDown(e)};this._handleMouseDown=function(e){return a._onMouseDown(e)};for(var b=0;b<this._windows.length;b++){var c=this._windows[b];try{$(c.document).keydown(this._handleKeyDown).mousedown(this._handleMouseDown)}catch(d){alert("Unable to install keyup handler on codemirror window")}}};
CueCard.Popup.prototype._removeEventHandlers=function(){for(var a=0;a<this._windows.length;a++){var b=this._windows[a];try{$(b.document).unbind("keydown",this._handleKeyDown).unbind("mousedown",this._handleMouseDown)}catch(c){alert("Unable to install keyup handler on codemirror window")}}};CueCard.Popup.prototype._onKeyDown=function(a){if(a.keyCode==27){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("key")}};
CueCard.Popup.prototype._onMouseDown=function(a){if(this.mouseEventOutsidePopup(a)){this.cancel();"onCancel"in this._handlers&&this._handlers.onCancel("mouse")}};CueCard.Popup.prototype.mouseEventOutsidePopup=function(a){if(a.currentTarget!=this.elmt[0].ownerDocument)return true;else{var b=this.elmt.offset();if(a.pageX<b.left||a.pageX>b.left+this.elmt.width()||a.pageY<b.top||a.pageY>b.top+this.elmt.height())return true}return false};
CueCard.TypeBasedTopicSuggestor=function(a,b,c,d,e){this._popup=a;this._defaultSuggestions=b;this._expectedTypes=c;this._desiredProperty=d;this._onCommit=e;this._popup.elmt.addClass("cuecard-popup-container-wide")};
CueCard.TypeBasedTopicSuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();if(a.length==0){for(var c=[],d=0;d<this._defaultSuggestions.length;d++)c.push(this._defaultSuggestions[d]);b(c)}else{var e=this;c=CueCard.UI.createBlockingContinuations(function(f,g){for(var h=g.result,j=[],l=0;l<h.length;l++){var o=h[l];o.imageURL=null;if("/common/topic/image"in o&&o["/common/topic/image"]!=null&&o["/common/topic/image"].length>0)o.imageURL=CueCard.freebaseServiceUrl+"api/trans/image_thumb"+
o["/common/topic/image"][0].id+"?mode=fillcrop&maxwidth=40&maxheight=40";j.push({result:o[e._desiredProperty],elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}"><table cellpadding="0" cellspacing="0"><tr valign="top"><td valign="top">'+(o.imageURL==null?'<div class="cuecard-suggestion-thumbnail-empty"> </div>':'<img src="'+o.imageURL+'" />')+'</td><td valign="top">'+o.name+'<div class="cuecard-suggestion-id">'+o[e._desiredProperty]+"</div></td></tr></table></a>")})}b(j)});this._popup.addPendingContinuation(c);
d=CueCard.helper+"suggest-values-of-types?t="+encodeURIComponent(this._expectedTypes.join(","))+"&q="+encodeURIComponent(a);$.ajax(d,{dataType:"json",success:c.onDone,error:c.onError})}};CueCard.TypeBasedTopicSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.StaticChoicesSuggestor=function(a,b){this._defaultSuggestions=a;this._onCommit=b};
CueCard.StaticChoicesSuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();for(var c=[],d=0;d<this._defaultSuggestions.length;d++){var e=this._defaultSuggestions[d];if(a.length==0||e.label.toLowerCase().indexOf(a)>=0)c.push(e)}b(c)};CueCard.StaticChoicesSuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.PropertySuggestor=function(a,b,c,d){this._popup=a;this._defaultSuggestions=b;this._entries=c;this._onCommit=d};
CueCard.PropertySuggestor.prototype.getSuggestions=function(a,b){a=a.toLowerCase();for(var c=[],d={},e=0;e<this._entries.length;e++){var f=this._entries[e];if(a.length==0)c.push(f);else if(f.label.toLowerCase().indexOf(a)>=0)c.push(f);else for(var g=0;g<f.expectedTypes.length;g++){var h=f.expectedTypes[g];if(h.name.toLowerCase().indexOf(a)>=0){c.push({label:f.label,hint:f.hint+" &rarr; type "+h.id,qualifiedProperty:f.qualifiedProperty,result:f.result,offset:f.offset,extent:f.extent});d[f.qualifiedProperty]=
true;break}}}for(e=0;e<this._defaultSuggestions.length;e++){f=this._defaultSuggestions[e];if(a.length==0||f.label.toLowerCase().indexOf(a)>=0)c.push(f)}if(a.length<3&&c.length>3)b(c);else{e=CueCard.UI.createBlockingContinuations(function(j,l){for(var o=l.result,n=0;n<o.length;n++){var k=o[n];if(!(k.id in d)&&"/type/property/schema"in k&&k["/type/property/schema"]!=null&&k["/type/property/schema"].length>0&&"key"in k&&k.key!=null&&k.key.length>0){var m="/type/property/expected_type"in k&&k["/type/property/expected_type"]!=
null?k["/type/property/expected_type"]:[],r={label:k.key[0],hint:"of type "+k["/type/property/schema"][0].id,qualifiedProperty:k.id,expectedTypes:m};CueCard.QueryEditor.setPropertySuggestionSuffix(m.length>0?m[0]:"",r,r["/type/property/unique"],'"'+k.id+'" : ');c.push(r)}}b(c)});this._popup.addPendingContinuation(e);f=CueCard.helper+"suggest-arbitrary-properties.ajax?q="+encodeURIComponent(a);$.ajax(f,{dataType:"json",success:e.onDone,error:e.onError})}};
CueCard.PropertySuggestor.prototype.commit=function(a){this._onCommit(a)};CueCard.TypeSuggestor=function(){};CueCard.TypeSuggestor.prototype.getSuggestions=function(){};
CueCard.SuggestionController=function(a,b,c,d){this._popup=a;this._suggestor=c;this._lastText=d;this._selectedIndex=-1;this._suggestions=[];this._input=$('<input value="'+d+'" />');this._suggestionContainer=$('<div class="cuecard-suggestion-container"></div>');$(b).append($('<div class="cuecard-suggestion-input-container"></div>').append(this._input)).append(this._suggestionContainer);var e=this;this._onKeyUp=function(f){if(!f.shiftKey&&!f.metaKey&&!f.ctrlKey){if(f.keyCode==36||f.keyCode==38||f.keyCode==
40)return e._cancelEvent(f);f=e._input[0].value;if(f!=e._lastText){e._lastText=f;e._updateSuggestions()}}};this._onKeyDown=function(f){for(;!f.shiftKey&&!f.metaKey&&!f.ctrlKey;){if(f.keyCode==13||f.keyCode==9)e._commitSelectedSuggestion();else if(f.keyCode==36)e._suggestions.length>0&&e._selectSuggestion(0,true);else if(f.keyCode==38)e._selectedIndex>0&&e._selectSuggestion(e._selectedIndex-1,true);else if(f.keyCode==40)e._selectedIndex<e._suggestions.length-1&&e._selectSuggestion(e._selectedIndex+
1,true);else break;return e._cancelEvent(f)}if("onKeyDown"in e._suggestor)return e._suggestor.onKeyDown(f,e._input[0].value)};this._input.keyup(this._onKeyUp).keydown(this._onKeyDown);a=this._input[0];if(a.setSelectionRange){a.focus();a.setSelectionRange(d.length,d.length)}else if(a.createTextRange){a=a.createTextRange();a.collapse(true);a.moveEnd("character",d.length);a.moveStart("character",d.length);a.select()}this._input[0].focus();this._updateSuggestions()};
CueCard.SuggestionController.prototype._updateSuggestions=function(){this._suggestionContainer.empty();this._suggestionContainer.html('<div class="cuecard-suggestion-progress">Please wait...</div>');this._selectedIndex=-1;this._suggestions.length=0;var a=this;this._suggestor.getSuggestions(this._lastText,function(b){a._renderSuggestions(b,a._lastText)})};
CueCard.SuggestionController.prototype._renderSuggestions=function(a){var b=this._suggestionContainer;b.empty();var c=this,d=function(f,g){("elmt"in f?f.elmt:$('<a class="cuecard-suggestion-entry" href="javascript:{}">'+f.label+("hint"in f?' <span class="cuecard-suggestion-hint">'+f.hint+"</span>":"")+"</a>")).mouseover(function(){c._selectSuggestion(g,false)}).click(function(){c._commitSelectedSuggestion()}).appendTo(b)};this._suggestions=a;for(var e=0;e<a.length;e++)d(a[e],e);this._suggestions.length>
0?this._selectSuggestion(0,false):$('<div class="cuecard-suggestion-noEntryMessage">No suggestion available.<br/>Press Enter to keep what you have typed,<br/>ESC to discard it.</div>').appendTo(b);this._popup.reposition()};
CueCard.SuggestionController.prototype._selectSuggestion=function(a,b){this._selectedIndex>=0&&this._getSuggestion(this._selectedIndex).removeClass("cuecard-suggestion-selected");this._selectedIndex=a;this._getSuggestion(this._selectedIndex).addClass("cuecard-suggestion-selected");b&&this._getSuggestion(this._selectedIndex)[0].scrollIntoView(false)};
CueCard.SuggestionController.prototype._commitSelectedSuggestion=function(){this._selectedIndex>=0?this._suggestor.commit(this._suggestions[this._selectedIndex]):this._suggestor.commit(this._input[0].value)};CueCard.SuggestionController.prototype._getSuggestion=function(a){return $(this._suggestionContainer.children()[a])};CueCard.SuggestionController.prototype._cancelEvent=function(a){a.returnValue=false;a.cancelBubble=true;"preventDefault"in a&&a.preventDefault();return false};
CueCard.QueryEditor=function(a,b){this._container=a;this._options=b;this._controlPane=this._outputPane=null;this._assistKeyComboDetected=this._warnWrites=false;this._popup=null;var c=this,d="[{\n  \n}]",e=1,f=2;if("content"in b){d=b.content;f=e=0}d={basefiles:[],parserConfig:{json:true},height:"100%",autoMatchParens:true,textWrapping:false,highlightActiveLine:true,readOnly:"readOnly"in b?b.readOnly:false,content:d,passDelay:100,undoDelay:250,initCallback:function(){c._editor.setParser("JSParser");
c._onReady();try{var g=c._editor.nthLine(e+1);c._editor.selectLines(g,f,g,f)}catch(h){}"onReady"in b&&b.onReady();b.focusOnReady&&c.focus()}};if("onChange"in b)d.onChange=b.onChange;b.codeMirror&&$.extend(d,b.codeMirror);this._overflowInput=$("<input></input>").css("position","absolute").css("left","-500px").css("top","0px").appendTo(document.body);$(this._container).acre(fb.acre.current_script.app.path+"/cuecard/query-editor.mjt","query_editor",[this,d])};
CueCard.QueryEditor.nativeTypes={"/type/int":true,"/type/float":true,"/type/boolean":true,"/type/rawstring":true,"/type/uri":true,"/type/datetime":true,"/type/bytestring":true,"/type/value":true,"/type/text":true,"/type/enumeration":true};
CueCard.QueryEditor.prototype.dispose=function(){this._cancelPopup();$(this._editor._top_element).remove();this._overflowInput.remove();this._controlTopContainer.remove();this._controlBottomContainer.remove();this._iframeContainer.remove();this._iframeContainer=this._controlBottomContainer=this._controlTopContainer=this._overflowInput=this._editor=null};CueCard.QueryEditor.prototype.layout=function(a){a&&this._controlPane._paneldrawer&&this._controlPane._paneldrawer.set_height(a)};
CueCard.QueryEditor.prototype._addCodemirror=function(a,b){this._editor=new CodeMirror(function(c){a.append(c)},b)};CueCard.QueryEditor.prototype.setOutputPane=function(a){this._outputPane=a};CueCard.QueryEditor.prototype.getOutputPane=function(){return this._outputPane};CueCard.QueryEditor.prototype.setControlPane=function(a){this._controlPane=a};CueCard.QueryEditor.prototype.getControlPane=function(){return this._controlPane};CueCard.QueryEditor.prototype.focus=function(){this._editor.focus();return this};
CueCard.QueryEditor.prototype.content=function(a){if(a==undefined)return this._editor.getCode();else{if(this._editor.getCode()!=a){var b=this._editor.editor;b.history.push(null,null,this._editor.win.fixSpaces(a.replace(/\t/g,"  ").replace(/\u00a0/g," ")).replace(/\r\n?/g,"\n").split("\n"));b.addDirtyNode();b.scheduleHighlight();b.history.onChange&&b.history.onChange()}return this}};
CueCard.QueryEditor.prototype.getUnresolvedQuery=function(){var a=this.getQueryModelAndContext().model.toQueryJson();return CueCard.jsonize(a,this.getJsonizingSettings({breakLines:false,omitWhitespace:true,variables:this._getVariables(),resolveVariables:false}))};CueCard.QueryEditor.prototype.getResolvedQueryEnvelope=function(a){return this._getResolvedQueryEnvelope(false,a)};
CueCard.QueryEditor.prototype.getJsonizingSettings=function(a){if(this._controlPane)return this._controlPane.getJsonizingSettings(a);else{a=a||{};if(!("indentCount"in a))a.indentCount=2;return a}};CueCard.QueryEditor.prototype._getVariables=function(){return this._controlPane?this._controlPane.getVariables():{}};CueCard.QueryEditor.prototype._getQueryEnvelope=function(){return this._controlPane?this._controlPane.getQueryEnvelope():{}};
CueCard.QueryEditor.prototype._getResolvedQueryEnvelope=function(a,b){b=b||{};var c=this.getQueryModelAndContext(),d=c.model.toQueryJson();b.isWriteQuery=this._isWriteQuery(d);var e=this._getQueryEnvelope(),f=this._getVariables();if(a){this.content(CueCard.jsonize(d,this.getJsonizingSettings({variables:f,resolveVariables:false})));try{var g=this.getQueryModelAndContext().model.getCursorFromContext(c.context);this._editor.selectLines(this._editor.nthLine(g.line+1),g.col)}catch(h){}}e.query=d;return CueCard.jsonize(e,
this.getJsonizingSettings({breakLines:false,variables:f,resolveVariables:true}))};CueCard.QueryEditor.prototype._isWriteQuery=function(a){var b=function(c){if(c!=null)if(c instanceof Array){if(c.length>0&&typeof c[0]=="object")for(var d=0;d<c.length;d++)if(b(c[d]))return true}else if(typeof c=="object")for(d in c)if(d=="connect"||d=="create"||b(c[d]))return true;return false};return b(a)};
CueCard.QueryEditor.prototype._confirmWriteQuery=function(a){return a.isWriteQuery&&!this._warnWrites&&CueCard.apiProxy.base.indexOf("sandbox")<0};CueCard.QueryEditor.prototype.getMqlReadURL=function(){var a={},b=this.getResolvedQueryEnvelope(a);a=CueCard.freebaseServiceUrl+"api/service/"+(a.isWriteQuery?"mqlwrite":"mqlread");if("service"in this._options&&this._options.service!=null)a=this._options.service;return a+"?query="+encodeURIComponent(b)};
CueCard.QueryEditor.prototype.run=function(a){if(this._outputPane!=null){var b={},c=this._getResolvedQueryEnvelope(a||this._controlPane&&this._controlPane.getSetting("cleanup"),b);if(this._confirmWriteQuery(b))if(window.confirm("Your query will write data into Freebase.\nAre you sure you want to do that?"))this._warnWrites=true;else return;var d=CueCard.apiProxy.base+CueCard.apiProxy[b.isWriteQuery?"write":"read"],e=this,f=function(h){if(h.code==401||h.status&&h.status.indexOf("401")==0){console.log("unauthorized");
e._outputPane.setStatus("Query editor is not authorized to write on your behalf.");e._options.onUnauthorizedMqlWrite()}else{var j={};if(e._controlPane!=null&&e._controlPane.getSetting("multilineErrorMessages")&&("messages"in h||"message"in h))j.encodeJavascriptString=function(l){return l};e._outputPane.setJSONContent(h,e.getJsonizingSettings(j),c)}},g=function(h){alert(h)};this._outputPane.setStatus("Querying...");if(b.isWriteQuery)$(".cuecard-queryEditor-write-form").load(CueCard.apiProxy.base+"mqlwrite_begin.mjt",
function(){var h=$("form :input[name='ACRE_CSRF_TOKEN']",this).val();$.ajax(d,{type:"POST",data:{query:c,ACRE_CSRF_TOKEN:h},success:f,error:g,dataType:"json"})});else{c=this._outputPane.prepareQuery(c);$.ajax(d,{type:c.length>1024?"POST":"GET",data:{query:c},success:f,error:g,dataType:"json"})}}"onRun"in this._options&&this._options.onRun()};
CueCard.QueryEditor.prototype.getQueryModelAndContext=function(){var a=this._editor.cursorPosition(false),b=this._editor.lineNumber(a.line)-1;a=a.character;return CueCard.QueryParser.parseForContext(this._editor.getCode(),0,b,a)};
CueCard.QueryEditor.prototype._onReady=function(){var a=this;try{$(this._editor.win.document).keyup(function(c){return a._onEditorKeyUp(c)}).keydown(function(c){return a._onEditorKeyDown(c)}).mousedown(function(c){return a._onEditorMouseDown(c)})}catch(b){alert("Unable to install keyup handler on codemirror window")}if("cleanUp"in this._options&&this._options.cleanUp){this._editor.getCode();this._onCleanUp()}};CueCard.QueryEditor.prototype._onRun=function(a){this.run(a)};
CueCard.QueryEditor.prototype._onCleanUp=function(){var a=this.getQueryModelAndContext().model.toQueryJson(),b=this._getVariables();this.content(CueCard.jsonize(a,this.getJsonizingSettings({variables:b,resolveVariables:false})))};CueCard.QueryEditor.prototype._onEditorMouseDown=function(){};
CueCard.QueryEditor.prototype._onEditorKeyDown=function(a){if(a.keyCode==9||a.keyCode==32&&(a.ctrlKey||a.metaKey||a.altKey)){this._assistKeyComboDetected=true;a.preventDefault();return false}else{this._assistKeyComboDetected=false;if((a.metaKey||a.ctrlKey)&&a.keyCode==13)this._onRun(a.shiftKey)}};CueCard.QueryEditor.prototype._onEditorKeyUp=function(a){if(this._assistKeyComboDetected){this._assistKeyComboDetected=false;this.startAssistAtCursor();a.preventDefault();return false}};
CueCard.QueryEditor.prototype.startAssistAtCursor=function(){var a=this._editor.cursorPosition(false),b=this._editor.lineNumber(a.line)-1,c=a.character;this._editor.lineContent(a.line);var d=this._editor.win.document.body.firstChild;d=a.line||d;for(var e=d.nextSibling,f=c;f>0&&e!=null&&e.tagName.toLowerCase()!="br"&&e.firstChild!=null&&e.firstChild.nodeValue.length>=f;){f-=e.firstChild.nodeValue.length;d=e;e=e.nextSibling}a=$(e).offset();if(e==null||e.tagName.toLowerCase()=="br"){if(e!=null)if($.browser.msie&&
d!=null&&d.tagName.toLowerCase()!="br"){e=d.offsetWidth;d=d.offsetHeight}else{e=d.offsetLeft+d.offsetWidth;d=d.offsetTop+d.offsetHeight}else{a=$(d).offset();var g=d.firstChild?d.firstChild.nodeValue.length:0;e=a.left+(g==0?0:f*d.offsetWidth/g);d=d.offsetHeight}this._startAssist(b,c,{left:e,top:a.top,height:d})}else{g=e.firstChild?e.firstChild.nodeValue.length:0;this._startAssist(b,c,{left:a.left+(g==0?0:f*e.offsetWidth/g),top:a.top,height:e.offsetHeight})}};
CueCard.QueryEditor.prototype._startAssist=function(a,b,c){this._cancelPopup();if(c!=null){var d=$(this._iframeContainer).offset();d.left-=this._editor.win.document.body.scrollLeft+document.body.scrollLeft;d.top-=this._editor.win.document.body.scrollTop+document.body.scrollTop;var e=this;this._popup=new CueCard.Popup(Math.round(d.left+c.left),Math.round(d.top+c.top),Math.round(c.height),[window,this._editor.win],{onCancel:function(h){h=="key"&&e.focus()}});this._popup.elmt.html('<div class="cuecard-popup-message">Please wait...</div>');
c=this.getQueryModelAndContext();if(c.context.length>0){d=c.context[c.context.length-1];if("relative"in d)if(d.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)if(d.relative=="path"||d.relative=="before"){this._startSuggestProperties(a,b,c,d);return}else{if(d.relative=="space"){var f=d.node.links[d.child];this._startSuggestValues(a,b,c,d,f);return}}else{if(d.node.type==CueCard.QueryNode.TYPE_TERMINAL){f=null;if(c.context.length>1){var g=c.context[c.context.length-2];f=g.node.links[g.child]}this._startSuggestValues(a,
b,c,d,f);return}}else{f=null;if(c.context.length>1){g=c.context[c.context.length-2];if(g.node.type==CueCard.QueryNode.TYPE_NONTERMINAL)f=g.node.links[g.child];else if(c.context.length>2){g=c.context[c.context.length-3];f=g.node.links[g.child]}}this._startSuggestValues(a,b,c,d,f);return}}}this._popup.elmt.html('<div class="cuecard-popup-message">Sorry, we don\'t know how to assist you here. Send us a link to this exact query using the links at the upper right corner and we will investigate. Thank you!</div>')};
CueCard.QueryEditor.prototype._cancelPopup=function(){if(this._popup!=null){this._popup.cancel();this._popup=null}};
CueCard.QueryEditor.prototype._startSuggestProperties=function(a,b,c,d){var e=this;d=d.relative=="path"?d.node.links[d.child].token:null;this._startBufferInput();this._prepareQueryForSuggestions(c,a,b,d,function(f,g,h){var j=function(l,o){e._suggestProperties(c,o.result,g+e._stopBufferInput(),h)};c.model.locateInnerMostNonTerminal(c.context,f.extend(function(l,o){var n=[],k=[],m=[];o.node.getDeclaredTypes(n);o.node.getDeclaredIDs(k);o.node.getDeclaredGUIDs(m);var r=[];n.length>0&&r.push("t="+encodeURIComponent(n.join(",")));
k.length>0&&r.push("i="+encodeURIComponent(k.join(",")));m.length>0&&r.push("g="+encodeURIComponent(m.join(",")));if(o.property!=null){r.push("p="+encodeURIComponent(o.property));r.push("r="+o.reverse)}n=CueCard.helper+"suggest-properties.ajax?"+r.join("&");$.ajax(n,{dataType:"json",success:l.extend(j).onDone,error:f.onError});return true}));return true})};CueCard.QueryEditor.prototype._startBufferInput=function(){this._overflowInput[0].value="";this._overflowInput[0].focus()};
CueCard.QueryEditor.prototype._stopBufferInput=function(){return this._overflowInput[0].value};
CueCard.QueryEditor.prototype._suggestProperties=function(a,b,c,d){this._popup.elmt.empty();this._popup.elmt.html("<div></div>");a=[];for(var e in b.properties){var f=b.properties[e],g=e.lastIndexOf("/"),h=e.substr(g+1);g=e.substr(0,g);var j=f.explicit;if("parentProperty"in f){j='"'+f.parentProperty+'" : [{ "'+h+'" : ';var l=f.unique?"null":"[]";a.push({label:h,hint:"of type "+g+" (through "+f.parentProperty+")",qualifiedProperty:e,result:j+l+" }]",offset:j.length,extent:l.length,expectedTypes:f.expectedTypes})}else{g=
{label:h,hint:"of type "+g,qualifiedProperty:e,expectedTypes:f.expectedTypes};CueCard.QueryEditor.setPropertySuggestionSuffix(f.expectedTypes.length>0?f.expectedTypes[0].id:"",g,f.unique,'"'+(j?h:e)+'" : ');a.push(g)}}b=new CueCard.PropertySuggestor(this._popup,CueCard.MqlSyntax.KeywordSuggestions,a,d);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,b,c)};
CueCard.QueryEditor.setPropertySuggestionSuffix=function(a,b,c,d){var e=null;if(a=="/common/image"||a=="/common/document"){e='{ "id" : null, "optional" : true, "limit" : 3 }';c||(e="["+e+"]")}else if(a=="/measurement_unit/dated_integer"){e='{ "number" : null, "date" : null }';if(c)e="["+e+"]"}else if(a=="/measurement_unit/dated_money_value"){e='{ "amount" : null, "valid_date" : null, "currency" : null }';if(c)e="["+e+"]"}else e=a.indexOf("/type/")==0?c?"null":"[]":c?"{}":"[{}]";b.result=d+e;b.offset=
d.length;b.extent=e.length};
CueCard.QueryEditor.prototype._startSuggestValues=function(a,b,c,d,e){var f=this,g="token"in d?d.token:null;this._startBufferInput();this._prepareQueryForSuggestions(c,a,b,g,function(h,j,l,o){j+=f._stopBufferInput();if(e!=null&&!e.reverse&&CueCard.QueryNode.isMqlKeyword(e.path))f._suggestValuesForKeyword(a,b,c,d,e.path,j,l);else{var n=function(){f._popup.elmt.empty();f._popup.elmt.html('<div></div><div class="cuecard-suggestion-hint-message">Keep typing to search for topics of types fitting this point in the query.</div>')},k=
e.qualifiedProperty,m=e.reverse;if(!m&&(k=="/type/object/id"||k=="/type/object/guid"||k=="/type/object/name")){c.model.locateInnerMostNonTerminal(c.context,h.extend(function(v,u){n();var A=[];u.node.getDeclaredTypes(A);if("property"in u&&u.property!=null){var w=u.property;if(m)A.push(w.substr(0,w.lastIndexOf("/")));else if(w in o){w=o[w].expectedTypes;for(var z=0;z<w.length;z++)A.push(w[z].id)}}A=new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax.SingleValueSuggestions,A,e.property,l);
new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,A,j)}));return true}else{n();var r=false;if(m)h=[k.substr(0,k.lastIndexOf("/"))];else if(k=="/type/object/type")h=["/type/type"];else if(k in o){r=o[k].unique;h=[];k=o[k].expectedTypes;for(var q=0;q<k.length;q++)h.push(k[q].id)}else h=k=="/type/text/lang"?["/type/lang"]:[];k=h.length==1?h[0]:null;h=k!==null&&k in CueCard.QueryEditor.nativeTypes?new CueCard.StaticChoicesSuggestor(CueCard.MqlSyntax[k=="/type/text"?r?"UniqueStringLiteralValueSuggestions":
"StringLiteralValueSuggestions":r?"UniqueLiteralValueSuggestions":"LiteralValueSuggestions"],l):new CueCard.TypeBasedTopicSuggestor(f._popup,CueCard.MqlSyntax[r?"UniqueTopicValueSuggestions":"TopicValueSuggestions"],h,"id",l);new CueCard.SuggestionController(f._popup,f._popup.elmt[0].firstChild,h,j)}}})};
CueCard.QueryEditor.prototype._suggestValuesForKeyword=function(a,b,c,d,e,f,g){this._popup.elmt.empty();a=CueCard.MqlSyntax.KeywordValueHints[e];if("html"in a){this._popup.elmt.html('<div class="cuecard-suggestion-hint-message">'+a.html+"</div>");this.focus()}else{this._popup.elmt.html("<div></div>");g=new CueCard.StaticChoicesSuggestor(a.choices,g);new CueCard.SuggestionController(this._popup,this._popup.elmt[0].firstChild,g,f)}};
CueCard.QueryEditor.prototype._prepareQueryForSuggestions=function(a,b,c,d,e){var f=this,g="",h,j=function(m,r,q,v,u){q=v===undefined||typeof q!=="string"?CueCard.jsonize(q,{breakLines:false}):q;r=r+(typeof v=="number"?v:q.length);u=r+(typeof u=="number"?u:0);f._editor.editor.replaceSelection(q);m=f._editor.nthLine(m+1);f._editor.selectLines(m,r,m,u)};if(d!=null){b=0;var l=d.start.col;if(/^['"]/.test(d.content))b=1;g=d.content.substring(b,c-l).replace(/['"]$/,"");h=function(m,r,q){var v=f._editor.nthLine(d.start.line+
1);f._editor.selectLines(v,d.start.col,v,d.end.col);j(d.start.line,d.start.col,m,r,q)}}else{c=this._editor.cursorPosition(true);var o=this._editor.lineNumber(c.line)-1,n=c.character;h=function(m,r,q){var v=f._editor.nthLine(o+1);f._editor.selectLines(v,n,v,n);j(o,n,m,r,q)}}var k=function(m){f._popup.close();typeof m=="string"?h(m):h(m.result,m.offset,m.extent)};c=CueCard.UI.createBlockingContinuations(function(m,r){return e(m,g,k,r||{})});this._popup.addPendingContinuation(c);a.model.qualifyAllProperties(c)};
CueCard.OutputPane=function(a,b){this._elmt=$(a);this._options=b||{};this._TABS=[{name:"List",key:"list"},{name:"JSON",key:"json"}];this._options.hideHelp||this._TABS.push({name:"Help",key:"help"});this._jsonResult=null;this._lastJsonOutputMode=$.localstore("cc_op_mode")||this._TABS[0].key;this._constructUI()};CueCard.OutputPane.prototype.dispose=function(){};
CueCard.OutputPane.prototype.layout=function(a){this._container.height(a);a=this._container.innerHeight()-this._tabsContainer.outerHeight();this._contentContainer.height(a);$(".cuecard-outputPane-tabBody",this._contentContainer).height(a-2)};
CueCard.OutputPane.prototype._constructUI=function(){var a=this,b=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.current_script.app.path+"/cuecard/output-pane.mjt","tabs",[b,this]);var c;c=this._options.initial_tab?a.getTabIndex(this._options.initial_tab):a.getTabIndex("help");var d=$("#"+b+" > .cuecard-outputPane-tabs > .tab-nav");d.tabs("#"+b+" > .tabbed-content > .cuecard-outputPane-tabBody",{initialIndex:c,onBeforeClick:function(e,f){var g=a._TABS[f].key;if(g!=="help"){a._lastJsonOutputMode=
g;$.localstore("cc_op_mode",g,false)}}});this._tabs=d.data("tabs");this._list=this._getTab("list").find("div");this._json=this._getTab("json").find("div");this._help=this._getTab("help").find("div");b=document.createElement("iframe");this._json.append(b);this._json_content=$(this._setupIframe(b));b=document.createElement("iframe");this._list.append(b);this._list_content=$(this._setupIframe(b));this._options.stylesheet&&this._list_content.append('<link rel="stylesheet" href="'+this._options.stylesheet+
'"/>');this._list_content.append('<div id="list-content"></div>');this._list_content=$("#list-content",this._list_content);this.setStatus("Run a query to see results here...")};CueCard.OutputPane.prototype._getTab=function(a){return $("#"+this._idPrefix+"-"+a)};CueCard.OutputPane.prototype.prepareQuery=function(a){return a};CueCard.OutputPane.prototype.getTabIndex=function(a){for(var b=0;b<this._TABS.length;b++)if(this._TABS[b].key===a)return b;return 0};
CueCard.OutputPane.prototype.setJSONContent=function(a,b,c){this._jsonResult=a;if(a.result){this._setIFrameText(CueCard.jsonize(a,b||{indentCount:2}));c=JSON.parse(c);this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/output-pane.mjt","list",[a,c])}else if(a.message){delete a.response;this._setIFrameText(CueCard.jsonize(a,b||{indentCount:2}));this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/output-pane.mjt","list_error",[a.message])}else if(a.messages){a=typeof a.messages[0]==
"string"?a.messages[0]:a.messages[0].message;this._setIFrameText(a);this._list_content.acre(fb.acre.current_script.app.path+"/cuecard/output-pane.mjt","list_error",[a])}this._tabs.click(this.getTabIndex(this._lastJsonOutputMode))};CueCard.OutputPane.prototype.setStatus=function(a){this._jsonResult=null;this._setIFrameText(a);this._list_content.html(a)};CueCard.OutputPane.prototype.getJson=function(){return this._jsonResult};
CueCard.OutputPane.prototype._setIFrameText=function(a){a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var b=[],c=/\"m?id\"\s*\:\s*\"([^\"]*)\"/gi;a.split(/[\n\r\f]/).forEach(function(d){b.push(d.replace(c,function(e,f){return e.replace(f,"<a target='_blank' class='cuecard-outputPane-dataLink' href='"+f+"'>"+f+"</a>")}))});a="<pre style='white-space:pre-wrap;'>"+b.join("\n")+"</pre>";this._json_content.html(a)};
CueCard.OutputPane.prototype._setupIframe=function(a){var b=this,c=a.contentWindow||a.contentDocument;c.__cc_runPage=function(d){b._options.queryEditor._controlPane._runPage(d)};c=c.document.body;$(".cuecard-outputPane-dataLink",c).live("mouseover",function(){var d=$(this).attr("href"),e=$(a).offset(),f=$(this).position(),g=e.top+f.top+$(this).height();e=e.left+f.left;var h=$("<div id='cuecard-outputPane-topic-popup'></div>").css({position:"absolute","z-index":1E3,width:"30em",top:g,left:e}).appendTo("body");
$.get(fb.h.legacy_fb_url("/private/flyout",d),function(j){h.html(j.html)},"jsonp")}).live("mouseout",function(){$("#cuecard-outputPane-topic-popup").remove()});return c};CueCard.ControlPane=function(a,b){this._elmt=$(a);this._options=b||{};this._constructUI()};CueCard.ControlPane.prototype.dispose=function(){};
CueCard.ControlPane.prototype._constructUI=function(){var a=this._idPrefix="t"+Math.floor(1E6*Math.random());this._elmt.acre(fb.acre.current_script.app.path+"/cuecard/control-pane.mjt","tabs",[a,this]);$("#"+a+" > .section-tabset").tabs("#"+a+" > .tabbed-content > .cuecard-controlPane-tabBody",{initialIndex:0});if(this._options.paneldrawer)this._paneldrawer=this._options.paneldrawer.element.paneldrawer(this._options.paneldrawer).data("$.paneldrawer")};CueCard.ControlPane.prototype.layout=function(){};
CueCard.ControlPane.prototype._getDefaults=function(){var a=this._options,b=a.env||{},c={};c.extended=a.extended||b.extended;c.extended=c.extended===1?true:false;c.as_of_time=a.as_of_time||b.as_of_time||null;c.use_permission_of=a.use_permission_of||b.use_permission_of||null;c.show_costs=a.costs||false;delete b.extended;delete b.as_of_time;delete b.use_permission_of;delete b.show_costs;return c};CueCard.ControlPane.prototype._getTab=function(a){return $("#"+this._idPrefix+"-"+a)};
CueCard.ControlPane.prototype._redangle=function(){var a=this,b=this._options.queryEditor.getQueryModelAndContext();b.model.toInsideOutQueryJson(b.context,CueCard.UI.createBlockingContinuations(function(c,d){a._setOutputJSON(d)}))};CueCard.ControlPane.prototype._qualify=function(){var a=this,b=this._options.queryEditor.getQueryModelAndContext().model;b.qualifyAllProperties(CueCard.UI.createBlockingContinuations(function(){a._setOutputJSON(b.toQueryJson({qualifyAllProperties:true}))}))};
CueCard.ControlPane.prototype._generateCode=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson();a=CueCard.CodeGeneration.generate(a,CueCard.CodeGeneration.serializers["acre-template"],{variables:this.getVariables()});CueCard.showDialog("acre_template",a)};
CueCard.ControlPane.prototype._oneLiner=function(){var a=this._options.queryEditor.getQueryModelAndContext().model.toQueryJson(),b=this.getJsonizingSettings({variables:this.getVariables(),resolveVariables:false});b.breakLines=false;this._options.queryEditor.content(CueCard.jsonize(a,b))};
CueCard.ControlPane.prototype._setOutputJSON=function(a){switch(this._getTab("tools").find("input[name='tools-result']:checked").val()){case "replace":this._options.queryEditor.content(CueCard.jsonize(a,this.getJsonizingSettings()));break;case "output":this._options.outputPane.setJSONContent(a,this.getJsonizingSettings());break}};
CueCard.ControlPane.prototype._runPage=function(a){var b=this._getTab("envelope").find("input[name='page']"),c=b.val();c=parseInt(c)||1;c+=a;if(c<1)b.val("1");else{b.val(c);this._options.queryEditor!=null&&this._options.queryEditor.run()}};
CueCard.ControlPane.prototype._runCursor=function(a){if(this._options.outputPane!=null){var b=this._options.outputPane.getJson();if(b!==undefined&&b!==null&&"cursor"in b){this._getTab("envelope").find("input[name='cursor']").val(b.cursor);this._getTab("envelope").find("input[name='cursor-opt'][value='custom']").attr("checked","checked");this._options.queryEditor!=null&&a&&this._options.queryEditor.run()}}};
CueCard.ControlPane.prototype.getQueryEnvelopeSetting=function(a){switch(a){case "extended":return this._getTab("envelope").find("input[name='extended']").attr("checked")?1:0;case "as_of_time":a=this._getTab("envelope").find("input[name='as_of_time']").val();if(a.length>0)return a;break}return null};
CueCard.ControlPane.prototype.getQueryEnvelope=function(a,b,c){a=a||{};if(this.getSetting("extended")==1)a.extended=1;if(this.getSetting("costs"))a.show_costs=true;var d=this._getTab("envelope").find("input[name='as_of_time']").val();if(d.length>0)a.as_of_time=d;d=this._getTab("envelope").find("input[name='use_permission_of']").val();if(d.length>0)a.use_permission_of=d;var e=this._getTab("envelope").find("select");d=function(g){return e[g].options[e[g].selectedIndex].value};if(!c){c=d(0);if(c.length>
0)a.lang=c}c=d(1);if(c.length>0)a.escape=c=="false"?false:c;c=d(2);if(c.length>0)a.uniqueness_failure=c;if(!b){b=this._getTab("envelope").find("input[name='page']").val();if(b.length>0)try{a.page=parseInt(b)}catch(f){}switch(this._getTab("envelope").find("input[name='cursor-opt']:checked").val()){case "true":a.cursor=true;break;case "custom":a.cursor=this._getTab("envelope").find("input[name='cursor']").val();break}}this.getCustomEnvelope(a);return a};
CueCard.ControlPane.prototype.getCustomEnvelope=function(a){a=a||{};for(var b=this._getTab("envelope").find("table.cuecard-controlPane-customEnvelope")[0],c=1;c<b.rows.length;c++){var d=b.rows[c],e=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;if(e.length>0){try{d=JSON.parse(d)}catch(f){}a[e]=d}}return a};
CueCard.ControlPane.prototype.getSetting=function(a){var b=this._getTab("tools").find("input");switch(a){case "cleanup":a=b[0].checked;$.localstore("cc_cp_clean",a?"1":"0",false);return a;case "alignJSONPropertyValues":a=b[1].checked;$.localstore("cc_cp_align",a?"1":"0",false);return a;case "liveQuery":a=b[2].checked;$.localstore("cc_cp_live",a?"1":"0",false);return a;case "multilineErrorMessages":a=b[3].checked;$.localstore("cc_cp_multi",a?"1":"0",false);return a;case "extended":a=this._getTab("envelope").find("input[name='extended']").attr("checked")?
1:0;$.localstore("cc_cp_extended",a,false);return a;case "costs":a=this._getTab("envelope").find("input[name='costs']").attr("checked")?1:0;$.localstore("cc_cp_costs",a,false);return a}return false};CueCard.ControlPane.prototype.getJsonizingSettings=function(a){a=a||{};a.indentCount=2;a.alignFieldValues=this.getSetting("alignJSONPropertyValues");return a};
CueCard.ControlPane.prototype.getVariables=function(){for(var a={},b=this._getTab("variables").find("table")[0],c=1;c<b.rows.length;c++){var d=b.rows[c],e=d.cells[0].firstChild.value;d=d.cells[1].firstChild.value;try{d=JSON.parse(d)}catch(f){}a[e]=d}return a};CueCard.CodeGeneration={serializers:{}};
CueCard.CodeGeneration.generate=function(a,b,c){var d="",e={_variables:{},createVariable:function(o){if(o in this._variables)return o+this._variables[o]++;else{this._variables[o]=1;return o}}},f=e.createVariable("q"),g=e.createVariable("o"),h=new CueCard.SerializingContext(null);h.setProperty("indentString","indentString"in c?c.indentString:"  ");h.setProperty("indentLevel","indentLevel"in c?c.indentLevel:0);h.setProperty("stream",{append:function(o){d+=o}});b.prepareRootContext(h,c);var j=new CueCard.IndentWriter(h),
l=b.generateQueryCall(h,j,e,a,c.variables,f,g);h.setProperty("start",function(){return l});h.setProperty("stop",function(){});CueCard.CodeGeneration._processNode(a,b,h,j,e);return d};
CueCard.CodeGeneration._deriveElementName=function(a,b){if(a==null){var c=b.getProperty("path");if(c!=null)if(c.charAt(0)=="!"){c=c.substr(Math.max(c.indexOf(":")+1,1)).split("/");return c[Math.max(0,c.length-2)]}else{c=c.substr(c.indexOf(":")+1).split("/");return c[c.length-1]}}else{c=a.split("/");return c[c.length-1]}return"entry"};CueCard.CodeGeneration._isImagePath=function(a){if(a.charAt(0)=="!")return false;a=a.substr(a.indexOf(":")+1);return a=="/common/topic/image"||a=="image"};
CueCard.CodeGeneration._isImageNode=function(a){if(a==null||typeof a!="object")return false;if(a instanceof Array)if(a.length==1&&typeof a[0]=="object")a=a[0];else return false;for(var b in a)if(b!="id"&&b!="guid"&&!CueCard.QueryNode.isMqlKeyword(b))return false;return true};
CueCard.CodeGeneration._processNode=function(a,b,c,d,e){if(a==null){var f=c.getProperty("start")(true,false);b.outputSimpleFieldValue(f,c,d);c.getProperty("stop")(true,false)}else if(typeof a=="object")if(a instanceof Array)if(a.length==0){f=CueCard.CodeGeneration._deriveElementName(null,c);var g=e.createVariable(f),h=e.createVariable(f.charAt(0));f=c.getProperty("start")(false,false);b.openNodeArray(c,d,e,f,g,h,"values");b.outputSimpleFieldValue(g,c,d);b.closeNodeArray(c,d,e,f,g,h,"values");c.getProperty("stop")(false,
false)}else{if(!(a.length>1||typeof a[0]!="object"||"__identifier__"in a)){g=new CueCard.SerializingContext(c);g.setProperty("in-array",true);arguments.callee(a[0],b,g,d,e)}}else if(a.optional!="forbidden"){g=null;f=0;for(h in a)if(a.hasOwnProperty(h)&&h!="*"&&!CueCard.QueryNode.isMqlKeyword(h)){f++;var j=a[h];if(h.charAt(0)!="!"){var l=h.substr(h.indexOf(":")+1);if(l=="type"||l=="/type/object/type")if(j!=null&&typeof j=="string")g=j}}CueCard.CodeGeneration._processTypedObjectNode(a,g,f,b,c,d,e)}};
CueCard.CodeGeneration._processTypedObjectNode=function(a,b,c,d,e,f,g){function h(){var u=CueCard.CodeGeneration._deriveElementName(b,e);l=g.createVariable(u);if(e.getProperty("in-array"))o=g.createVariable(u.charAt(0))}var j=null,l=null,o=null,n,k,m="optional"in a&&a.optional===true;if(e.getProperty("in-array")){var r=c>0&&!("*"in a);n=function(){if(j==null){j=e.getProperty("start")(false,m);h();d.openNodeArray(e,f,g,j,l,o,r?"fields":"object")}return l};k=function(){if(j!=null){d.closeNodeArray(e,
f,g,j,l,o,r?"fields":"object");e.getProperty("stop")(false,m)}}}else{n=function(){if(j==null){j=e.getProperty("start")(false,m);h();d.openNode(e,f,g,j,l)}return l};k=function(){if(j!=null){d.closeNode(e,f,g,j,l);e.getProperty("stop")(false,m)}}}if(c==0||"*"in a)d.generateEmptyObjectNode(e,f,g,n());else{for(var q in a)if(a.hasOwnProperty(q)&&q!="*"&&!CueCard.QueryNode.isMqlKeyword(q)){c=a[q];if(CueCard.CodeGeneration._isImagePath(q)&&CueCard.CodeGeneration._isImageNode(c))d.generateImageField(e,f,
g,q,c,n);else{var v=d.createFieldContext(e,f,g,q,n);v.setProperty("path",q);CueCard.CodeGeneration._processNode(c,d,v,f,g)}}if("*"in a){c=a["*"];v=d.openWildcardField(e,f,g,n,c);CueCard.CodeGeneration._processNode(c,d,v,f,g);d.closeWildcardField(e,f,g,n,c)}}k()};
CueCard.CodeGeneration.serializers["acre-template"]={prepareRootContext:function(){},generateQueryCall:function(a,b,c,d,e,f,g){b.appendIndent();b.append("<acre:script>");b.appendLineBreak();b.indent();b.appendIndent();b.append("var "+f+" = ");CueCard.jsonize(d,{context:a,variables:e,resolveVariables:false});b.append(";");b.appendLineBreak();b.appendIndent();b.appendLineBreak();b.appendIndent();b.append("var "+g+" = acre.freebase.mqlread("+f+");");b.appendLineBreak();b.unindent();b.appendIndent();
b.append("</acre:script>");b.appendLineBreak();return g+".result"},outputSimpleFieldValue:function(a,b,c){c.append("${"+a+"}")},openNodeArray:function(a,b,c,d,e,f,g){b.appendLineBreak();b.appendIndent();b.append('<ul acre:if="'+d+'.length != 0">');b.appendLineBreak();b.indent();b.appendIndent();b.append('<li acre:for="'+f+", "+e+" in "+d+'">');g=="fields"&&b.append("<table>");if(g=="fields"||g=="object"){b.appendLineBreak();b.indent()}},closeNodeArray:function(a,b,c,d,e,f,g){if(g=="fields"||g=="object"){b.unindent();
b.appendIndent()}g=="fields"&&b.append("</table>");b.append("</li>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</ul>");b.appendLineBreak();b.appendIndent();b.append('<div acre:else=""><ins>[no element]</ins></div>');b.appendLineBreak();b.appendLineBreak()},openNode:function(a,b,c,d,e){b.appendIndent();b.append("<acre:script>var "+e+" = "+d+";</acre:script>");b.appendLineBreak();b.appendIndent();b.append("<table>");b.appendLineBreak();b.indent()},closeNode:function(a,b){b.unindent();
b.appendIndent();b.append("</table>");b.appendLineBreak()},createFieldContext:function(a,b,c,d,e){a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",function(f,g){var h=e();b.appendIndent();b.append("<tr><th>"+d+":</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append("<td"+(g?" acre:if=\"'"+d+"' in "+h+" && "+h+"['"+d+"'] != null\"":"")+">");if(!f){b.appendLineBreak();b.indent()}return h+"['"+d+"']"});a.setProperty("stop",function(f,g){if(!f){b.unindent();
b.appendIndent()}b.append("</td>");b.appendLineBreak();if(g){b.appendIndent();b.append('<td acre:else=""><ins>[no value]</ins></td>');b.appendLineBreak()}b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()});return a},generateImageField:function(a,b,c,d,e,f){f=f();a=f+"['"+d+"']";b.appendIndent();b.append("<tr><th>"+d+":</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append("<td acre:if=\"'"+d+"' in "+f+" && "+a+' != null">');b.appendLineBreak();b.indent();d=e instanceof
Array;b.appendIndent();if(d){e=e[0];d=c.createVariable("image");c=c.createVariable("i");b.append('<img acre:for="'+c+", "+d+" in "+a+'" src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+d+".guid.substr(1)}":"${"+d+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>')}else b.append('<img src="${acre.environ.freebase_service_url}/api/trans/image_thumb'+("guid"in e?"/guid/${"+a+".guid.substr(1)}":"${"+a+".id}")+'?mode=fillcrop&amp;maxwidth=100&amp;maxheight=100" /></td>');
b.appendLineBreak();b.unindent();b.appendIndent();b.append('<td acre:else=""><ins>[no image]</ins></td>');b.appendLineBreak();b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()},openWildcardField:function(a,b,c,d){d=d();var e=c.createVariable("field"),f=c.createVariable("value");b.appendIndent();b.append('<tr acre:for="'+e+", "+f+" in "+d+'"><td>${'+e+"}:</td>");b.appendLineBreak();b.indent();a=new CueCard.SerializingContext(a);a.setProperty("in-array",false);a.setProperty("start",
function(g){b.appendIndent();b.append("<td>");if(!g){b.appendLineBreak();b.indent()}return f});a.setProperty("stop",function(g){if(!g){b.unindent();b.appendIndent()}b.append("</td>");b.appendLineBreak()});return a},closeWildcardField:function(a,b){b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak()},generateEmptyObjectNode:function(a,b,c,d){a=c.createVariable("field");c=c.createVariable("value");b.appendIndent();b.append("<table>");b.appendLineBreak();b.indent();b.appendIndent();b.append('<tr acre:for="'+
a+", "+c+" in "+d+'"><th>${'+a+"}:</th>");b.appendLineBreak();b.indent();b.appendIndent();b.append('<td acre:if="'+c+' instanceof Array">${'+c+".join(', ')}</td>");b.appendLineBreak();b.appendIndent();b.append('<td acre:else="">${'+c+"}</td>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</tr>");b.appendLineBreak();b.unindent();b.appendIndent();b.append("</table>");b.appendLineBreak()}};
CueCard.ExampleTechniques=["all","basic","sorting","text search","range constraint","date query","multiple constraints on same property","limiting number of results","geographic location","compound value type (CVT)","schema inspection","attribution","adding data"];
CueCard.Examples=[{name:"Vietnamese restaurants in Palo Alto, California",query:[{id:null,name:null,type:"/dining/restaurant",cuisine:"Vietnamese","/business/business_location/address":[{state_province_region:"California",citytown:"Palo Alto"}]}],techniques:["basic","geographic location"]},{name:"Properties of /music/artist",query:[{type:"/type/property",schema:{id:"/music/artist"},id:null,name:null}],techniques:["schema inspection"]},{name:"All types created by the user jamie",query:[{creator:"/user/jamie",
name:null,id:null,type:"/type/type"}],techniques:["attribution"]},{name:"Cloud classifications sorted by name",query:[{clouds:[],name:null,id:null,sort:"name",type:"/meteorology/cloud_classification"}],techniques:["basic","sorting"]},{name:"U.S. states containing cities whose names start with 'Blue' or 'Red'",query:[{"a:contains":[{name:null,id:null,"name~=":"^Red",type:"/location/citytown"}],"b:contains":[{name:null,id:null,"name~=":"^Blue",type:"/location/citytown"}],"b:type":"/location/us_state",
name:null,id:null,type:"/location/location"}],techniques:["text search","multiple constraints on same property"]},{name:"2 of The Police's albums and their tracks",query:[{type:"/music/album",id:null,limit:2,name:null,releases:{track:[],limit:1},artist:{name:"The Police",type:"/music/artist"}}],techniques:["basic","limiting number of results"]},{name:"25 Songs with the word 'love' in their titles, with release date, album and artist",query:[{releases:{album:{artist:[],name:null,limit:1},release_date:null,
limit:1},limit:25,name:null,"name~=":"Love*",type:"/music/track"}],techniques:["text search","limiting number of results","date query"]},{name:"Films starring both Joe Pesci and Robert de Niro, showing their full cast",query:[{"a:starring":[{actor:"Joe Pesci"}],"b:starring":[{actor:"Robert de Niro"}],name:null,id:null,starring:[{actor:null}],type:"/film/film"}],techniques:["multiple constraints on same property","compound value type (CVT)"]},{name:"32 actors born in the 1960s, with two films of each actor",
query:[{"/people/person/date_of_birth":null,"/people/person/date_of_birth<":"1970","/people/person/date_of_birth>=":"1960",film:[{film:null,id:null,limit:2}],limit:35,name:null,id:null,type:"/film/actor"}],techniques:["multiple constraints on same property","date query","limiting number of results","range constraint"]},{name:"Directors who have directed both Parker Posey and any actor named Robert (in possibly different films)",query:[{"parker_film:film":[{name:null,id:null,starring:[{actor:"Parker Posey"}]}],
"robert_film:film":[{name:null,id:null,starring:[{actor:null,"actor~=":"Robert*"}]}],name:null,id:null,type:"/film/director"}],techniques:["multiple constraints on same property","text search","compound value type (CVT)"]},{name:"Music artists with albums containing a track called 'One Tree Hill'",query:[{album:[{name:null,id:null,releases:[{track:[{name:"One Tree Hill"}]}]}],name:null,id:null,type:"/music/artist"}],techniques:["compound value type (CVT)","basic"]},{name:"Everything about 'Jimi Hendrix'",
query:{"*":null,name:"Jimi Hendrix",type:"/music/artist"},techniques:["basic"]},{name:"Kevin Bacon's films, with cast, producers, music, etc.",query:[{type:"/film/film","only:starring":{actor:{name:"Kevin Bacon"}},name:null,imdb_id:[],music:[],produced_by:[],starring:[{actor:[]}]}],techniques:["basic","compound value type (CVT)"]},{name:"When 'Star Wars Episode IV' was added to the database, and by whom",query:[{creator:null,id:"/wikipedia/en/Star_Wars_Episode_IV",name:null,timestamp:null,type:"/film/film"}],
techniques:["attribution"]},{name:"Tracks on Synchronicity longer than 300 seconds",query:[{type:"/music/track",length:null,"length>":300,name:null,releases:[{album:{artist:"The Police",name:"Synchronicity"}}]}],techniques:["range constraint"]},{name:"Properties of a particular type (/government/politician)",query:[{type:"/type/property",schema:{id:"/government/politician"},id:null,name:null}],techniques:["schema inspection"]},{name:"Properties of a particular property (/type/object/name)",query:{"*":null,
id:"/type/object/name",type:"/type/property"},techniques:["schema inspection"]},{name:"Types in a particular domain (/music)",query:[{type:"/type/type",domain:{id:"/music"},name:null}],techniques:["schema inspection"]},{name:"Creating a new topic given a name and a type",query:{create:"unless_exists",name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,guid:null},techniques:["adding data"]},{name:"Setting a basic unique property to a topic",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",
id:null,basic_property:{value:42,connect:"update"}},techniques:["adding data"]},{name:"Connecting one topic to another",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",id:null,connect:"insert"}},techniques:["adding data"]},{name:"Deleting a link between two topics",query:{name:"Test Object 1",type:"/base/mqlexamples/testobject",id:null,link_to_topic:{name:"Test Object 2",type:"/base/mqlexamples/testobject",
id:null,connect:"delete"}},techniques:["adding data"]}];CueCard.ExampleTechniqueMap={all:[]};for(var i=0;i<CueCard.Examples.length;i++){var example=CueCard.Examples[i];CueCard.ExampleTechniqueMap.all.push(i);for(var x=0;x<example.techniques.length;x++){var technique=example.techniques[x];if(technique in CueCard.ExampleTechniqueMap)CueCard.ExampleTechniqueMap[technique].push(i);else CueCard.ExampleTechniqueMap[technique]=[i]}}
CueCard.Languages=[{name:"Afrikaans",id:"/lang/af"},{name:"Akkadian",id:"/lang/kk"},{name:"Albanian",id:"/lang/sq"},{name:"Amharic",id:"/lang/am"},{name:"Arabic",id:"/lang/ar"},{name:"Armenian",id:"/lang/hy"},{name:"Artificial",id:"/lang/art"},{name:"Asturian",id:"/lang/ast"},{name:"Australian languages",id:"/lang/aus"},{name:"Azerbaijani",id:"/lang/az"},{name:"Balinese",id:"/lang/ban"},{name:"Bambara",id:"/lang/bm"},{name:"Bantu",id:"/lang/bnt"},{name:"Basque",id:"/lang/eu"},{name:"Batak",id:"/lang/btk"},
{name:"Belarusian",id:"/lang/be"},{name:"Bengali",id:"/lang/bn"},{name:"Bhojpuri",id:"/lang/bho"},{name:"Bosnian",id:"/lang/bs"},{name:"Breton",id:"/lang/br"},{name:"Bulgarian",id:"/lang/bg"},{name:"Buriat",id:"/lang/bua"},{name:"Catalan",id:"/lang/ca"},{name:"Cebuano",id:"/lang/ceb"},{name:"Cherokee",id:"/lang/chr"},{name:"Chichewa",id:"/lang/ny"},{name:"Chinese",id:"/lang/zh"},{name:"Cornish",id:"/lang/kw"},{name:"Corsican",id:"/lang/co"},{name:"Cree",id:"/lang/cr"},{name:"Creoles",id:"/lang/cpf"},
{name:"Croatian",id:"/lang/hr"},{name:"Czech",id:"/lang/cs"},{name:"Danish",id:"/lang/da"},{name:"Duala",id:"/lang/dua"},{name:"Dutch",id:"/lang/nl"},{name:"English",id:"/lang/en"},{name:"Esperanto",id:"/lang/eo"},{name:"Estonian",id:"/lang/et"},{name:"Faroese",id:"/lang/fo"},{name:"Filipino",id:"/lang/fil"},{name:"Finnish",id:"/lang/fi"},{name:"French",id:"/lang/fr"},{name:"Frisian",id:"/lang/fy"},{name:"Friulian",id:"/lang/fur"},{name:"Fulah",id:"/lang/ff"},{name:"Ga",id:"/lang/gaa"},{name:"Gaelic",
id:"/lang/gd"},{name:"Gallegan",id:"/lang/gl"},{name:"Georgian",id:"/lang/ka"},{name:"German",id:"/lang/de"},{name:"Germanic",id:"/lang/gem"},{name:"Greek",id:"/lang/el"},{name:"Guarani",id:"/lang/gn"},{name:"Haitian",id:"/lang/ht"},{name:"Hausa",id:"/lang/ha"},{name:"Hawaiian",id:"/lang/haw"},{name:"Hebrew",id:"/lang/he"},{name:"Hindi",id:"/lang/hi"},{name:"Hungarian",id:"/lang/hu"},{name:"Icelandic",id:"/lang/is"},{name:"Indonesian",id:"/lang/id"},{name:"Inuktitut",id:"/lang/ku"},{name:"Inuktitut",
id:"/lang/iu"},{name:"Irish",id:"/lang/ga"},{name:"Italian",id:"/lang/it"},{name:"Japanese",id:"/lang/ja"},{name:"Judeo-Arabic",id:"/lang/jrb"},{name:"Kalaallisut",id:"/lang/kl"},{name:"Khmer",id:"/lang/km"},{name:"Kinyarwanda",id:"/lang/rw"},{name:"Klingon",id:"/lang/tlh"},{name:"Kongo",id:"/lang/kg"},{name:"Korean",id:"/lang/ko"},{name:"Ladino",id:"/lang/lad"},{name:"Latin",id:"/lang/la"},{name:"Latvian",id:"/lang/lv"},{name:"Limburgan",id:"/lang/li"},{name:"Lingala",id:"/lang/ln"},{name:"Lithuanian",
id:"/lang/lt"},{name:"Low German",id:"/lang/nds"},{name:"Luxembourgish",id:"/lang/lb"},{name:"Macedonian",id:"/lang/mk"},{name:"Malagasy",id:"/lang/mg"},{name:"Malay",id:"/lang/ms"},{name:"Malayalam",id:"/lang/ml"},{name:"Maltese",id:"/lang/mt"},{name:"Mandingo",id:"/lang/man"},{name:"Manx",id:"/lang/gv"},{name:"Maori",id:"/lang/mi"},{name:"Marathi",id:"/lang/mr"},{name:"Mohawk",id:"/lang/moh"},{name:"Moldavian",id:"/lang/mo"},{name:"Mongolian",id:"/lang/mn"},{name:"Nahuatl",id:"/lang/nah"},{name:"Navajo",
id:"/lang/nv"},{name:"Neapolitan",id:"/lang/nap"},{name:"Nepali",id:"/lang/ne"},{name:"Norse,",id:"/lang/non"},{name:"Northern Sami",id:"/lang/se"},{name:"Norwegian",id:"/lang/no"},{name:"Norwegian Nynorsk",id:"/lang/nn"},{name:"Occitan",id:"/lang/oc"},{name:"Panjabi",id:"/lang/pa"},{name:"Papiamento",id:"/lang/pap"},{name:"Persian",id:"/lang/fa"},{name:"Polish",id:"/lang/pl"},{name:"Portuguese",id:"/lang/pt"},{name:"Pushto",id:"/lang/ps"},{name:"Quechua",id:"/lang/qu"},{name:"Raeto-Romance",id:"/lang/rm"},
{name:"Romanian",id:"/lang/ro"},{name:"Romany",id:"/lang/rom"},{name:"Russian",id:"/lang/ru"},{name:"Sakha",id:"/lang/sah"},{name:"Sanskrit",id:"/lang/sa"},{name:"Sardinian",id:"/lang/sc"},{name:"Scots",id:"/lang/sco"},{name:"Serbian",id:"/lang/sr"},{name:"Shona",id:"/lang/sn"},{name:"Sicilian",id:"/lang/scn"},{name:"Slovak",id:"/lang/sk"},{name:"Slovenian",id:"/lang/sl"},{name:"Songhai",id:"/lang/son"},{name:"Spanish",id:"/lang/es"},{name:"Sundanese",id:"/lang/su"},{name:"Swahili",id:"/lang/sw"},
{name:"Swedish",id:"/lang/sv"},{name:"Syriac",id:"/lang/syr"},{name:"Tagalog",id:"/lang/tl"},{name:"Tahitian",id:"/lang/ty"},{name:"Tajik",id:"/lang/tg"},{name:"Tamashek",id:"/lang/tmh"},{name:"Tamil",id:"/lang/ta"},{name:"Telugu",id:"/lang/te"},{name:"Thai",id:"/lang/th"},{name:"Tibetan",id:"/lang/bo"},{name:"Tonga",id:"/lang/to"},{name:"Turkish",id:"/lang/tr"},{name:"Turkmen",id:"/lang/tk"},{name:"Tuvinian",id:"/lang/tyv"},{name:"Ukrainian",id:"/lang/uk"},{name:"Urdu",id:"/lang/ur"},{name:"Uzbek",
id:"/lang/uz"},{name:"Vietnamese",id:"/lang/vi"},{name:"Welsh",id:"/lang/cy"},{name:"Wolof",id:"/lang/wo"},{name:"Xhosa",id:"/lang/xh"},{name:"Yiddish",id:"/lang/yi"},{name:"Yoruba",id:"/lang/yo"},{name:"Zulu",id:"/lang/zu"}];
CueCard.XMetawebCosts={tu:{meaning:"time/user",subsystem:"graphd"},ts:{meaning:"time/system",subsystem:"graphd"},tr:{meaning:"time/real",subsystem:"graphd"},te:{meaning:"time/overall",subsystem:"graphd"},pr:{meaning:"page reclaims",subsystem:"graphd"},pf:{meaning:"page faults",subsystem:"graphd"},dw:{meaning:"primitive data writes",subsystem:"graphd"},dr:{meaning:"primitive data reads",subsystem:"graphd"},"in":{meaning:"index size reads",subsystem:"graphd"},ir:{meaning:"index element reads",subsystem:"graphd"},
iw:{meaning:"index element write",subsystem:"graphd"},va:{meaning:"value allocation",subsystem:"graphd"},dt:{meaning:"total time spent in the session",subsystem:"client/me"},mr:{meaning:"number of mql requests (independent of caches)",subsystem:"client/me"},ch:{meaning:"cache/hit (memcache, not Squid)",subsystem:"client/me",important:true},cm:{meaning:"cache/miss (memcache, not Squid)",subsystem:"client/me"},cr:{meaning:"cache/read (memcache, not Squid)",subsystem:"client/me"},cs:{meaning:"cache skip (browser shift+reload skips memcache)",
subsystem:"client/me"},lh:{meaning:"lojson-cache/hit",subsystem:"client/me"},lm:{meaning:"lojson-cache/miss",subsystem:"client/me"},lr:{meaning:"lojson-cache/read",subsystem:"client/me"},nreqs:{meaning:"graph requests",subsystem:"client/me",important:true},tf:{meaning:"time/formatted",subsystem:"client/me"},tg:{meaning:"time/graph",subsystem:"client/me",important:true},rt:{meaning:"relevance/time",subsystem:"client/me"},cc:{meaning:"cpu time (utime + stime)",subsystem:"client/me"},mcu:{meaning:"mql user time",
subsystem:"client/me"},mcs:{meaning:"mql system time",subsystem:"client/me"},tm:{meaning:"mql real time",subsystem:"client/me",important:true},utime:{meaning:"time in user mode (float)",subsystem:"client/me"},stime:{meaning:"time in system mode (float)",subsystem:"client/me"},maxrss:{meaning:"maximum resident set size",subsystem:"client/me"},ixrss:{meaning:"shared memory size",subsystem:"client/me"},idrss:{meaning:"unshared memory size",subsystem:"client/me"},isrss:{meaning:"unshared stack size",
subsystem:"client/me"},minflt:{meaning:"page faults not requiring I/O",subsystem:"client/me"},majflt:{meaning:"page faults requiring I/O",subsystem:"client/me"},nswap:{meaning:"number of swap outs",subsystem:"client/me"},inblock:{meaning:"block input operations",subsystem:"client/me"},oublock:{meaning:"block output operations",subsystem:"client/me"},msgsnd:{meaning:"messages sent",subsystem:"client/me"},msgrcv:{meaning:"messages received",subsystem:"client/me"},nsignals:{meaning:"signals received",
subsystem:"client/me"},nvcsw:{meaning:"voluntary context switches",subsystem:"client/me"},nivcsw:{meaning:"involuntary context switches",subsystem:"client/me"},br:{meaning:"number of blob requests",subsystem:"client/me"},bctn:{meaning:"cdb thumbnail time - from blobclient POV",subsystem:"client/me"},rt:{meaning:"relevance/time (FIX: same name, different semantics?)",subsystem:"gix"},pt:{meaning:"postgres time",subsystem:"gix"},qt:{meaning:"actual postgres query time",subsystem:"gix"},ct:{meaning:"postgres connect time",
subsystem:"gix"},mt:{meaning:"MQL time",subsystem:"gix"},tt:{meaning:"total time",subsystem:"other"},mt:{meaning:"total MQL time: mql_output + mql_filter",subsystem:"other"},mft:{meaning:"MQL filter time (total time, ie. not per invocation)",subsystem:"other"},mfc:{meaning:"number of mql_filter invocations",subsystem:"other"},sh:{meaning:"squid/hit",subsystem:"cache"},st:{meaning:"squid/total time",subsystem:"cache"},so:{meaning:"squid/origin server time",subsystem:"cache"}};
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];f=function(g){var h=b.runtime.new_markuplist(),j=0;h[j++]=d[1];h[j++]=g;h[j++]=d[2];return h};f=b.runtime.tfunc_factory("acre_template(t)",f,b,undefined,false);c.acre_template=f;f.source_microdata=null;return e};
a.source_microdata=null;return a}(),info:{file:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/dialogs.mjt",stringtable:["",'\n  <div class="modal-inner">\n    <h1 class="modal-title">\n      <span>Generated Acre Template</span>\n    </h1>\n    <div class="modal-content">\n      <textarea id="template-code" wrap="off">','</textarea>\n    </div>\n  </div>\n  <div class="modal-buttons">\n    <button class="button button-cancel">OK</button>\n  </div>'],debug_locs:[1,1,1,1,1,1,6,6,6,6,12,
12,12,12,12,12,12,12,18,18,18,18,18,18,18,18,18,18,18,18,18,18],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];f=function(g,h){var j=b.runtime.new_markuplist(),l=0;j[l++]=d[1];var o=b.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g.startAssistAtCursor()};j[l++]=d[2];j[l++]=b.runtime.make_attr_safe(o,false);
j[l++]=d[3];o=b.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._onCleanUp()};j[l++]=d[4];j[l++]=b.runtime.make_attr_safe(o,false);j[l++]=d[5];o=b.runtime.uniqueid("onclick");mjt._eventcb[o]=function(){g._onRun(false)};j[l++]=d[6];j[l++]=b.runtime.make_attr_safe(o,false);j[l++]=d[7];b.runtime.ondomready(function(){var n=$(g._container);g._container=n.find(".cuecard-queryEditor");g._iframeContainer=n.find(".cuecard-queryEditor-content");g._controlBottomContainer=n.find(".cuecard-queryEditor-controls-bottom");
g._addCodemirror(g._iframeContainer,h);g.layout()},this);j[l++]=d[8];return j};f=b.runtime.tfunc_factory("query_editor(queryEditor, codeMirrorOptions)",f,b,undefined,false);c.query_editor=f;f.source_microdata=null;return e};a.source_microdata=null;return a}(),info:{file:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/query-editor.mjt",stringtable:["",'\n\n  <div class="cuecard-queryEditor">\n    <div class="cuecard-queryEditor-content panel-content"></div>\n    <div class="cuecard-queryEditor-controls-bottom panel-header">\n      <div class="cuecard-queryEditor-controls-options drawer-toggle">\n        <a class="icon-link" href="javascript:void(0)">\n          <span>Query Options</span>\n        </a>\n      </div>',
'\n      <button class="button cuecard-queryEditor-queryAssist" title="Tab" onclick="return mjt._eventcb.','.apply(this, [event])">\n        Query\u00a0assist\n      </button>','\n      <button class="button cuecard-queryEditor-cleanUp" onclick="return mjt._eventcb.','.apply(this, [event])">\n        Tidy\n      </button>','\n      <button class="button button-primary cuecard-queryEditor-run" title="Ctrl-Enter" onclick="return mjt._eventcb.','.apply(this, [event])">\n        Run\n      </button>\n    </div>\n    <div class="cuecard-queryEditor-write-form" style="display:none"></div>\n  </div>',
""],debug_locs:[1,1,1,1,1,1,7,7,7,7,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,22,22,22,22,22,22,22,22,22,26,26,26,26,26,26,26,26,26,33,33,33,33,33,33,33,33,34,35,36,37,38,39,40,41,42,44,44,44,44,44,44,44,44,44],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];var g=function(n,k){var m=b.runtime.new_markuplist(),r=0;m[r++]=d[1];var q=[{name:"Tools",template:h,key:"tools"},{name:"Query Envelope",template:l,key:"envelope"},{name:"Variables",template:j,key:"variables"},
{name:"Settings",template:o,key:"settings"}];m[r++]=d[2];m[r++]=b.runtime.make_attr_safe(n,false);m[r++]=d[3];b.runtime.foreach(this,q,function(v,u){for(var A=1;A;){m[r++]=d[4];m[r++]=b.runtime.make_attr_safe(n,false);m[r++]=d[5];m[r++]=b.runtime.make_attr_safe(u.key,false);m[r++]=d[6];m[r++]=u.name;m[r++]=d[7];A--}return A?b.runtime._break_token:b.runtime._continue_token});m[r++]=d[8];b.runtime.foreach(this,q,function(v,u){for(var A=1;A;){m[r++]=d[9];m[r++]=b.runtime.make_attr_safe(n,false);m[r++]=
d[10];m[r++]=b.runtime.make_attr_safe(u.key,false);m[r++]=d[11];m[r++]=u.template(k);m[r++]=d[12];A--}return A?b.runtime._break_token:b.runtime._continue_token});m[r++]=d[13];b.runtime.ondomready(function(){k.layout=function(){var v=this._elmt,u=v.find(".section-tabs").innerHeight()-v.find(".section-tabset").outerHeight();v.find(".cuecard-controlPane-tabBody").css("height",u)};k.layout()},this);m[r++]=d[14];return m};g=b.runtime.tfunc_factory("tabs(id, controlPane)",g,b,undefined,false);c.tabs=g;
g.source_microdata=null;e[f++]=d[15];var h=function(n){var k=b.runtime.new_markuplist(),m=0;k[m++]=d[16];var r=[{label:"Expand properties",command:"_qualify",hint:'E.g., "id" becomes "/type/object/id"'},{label:"Invert query",command:"_redangle",hint:"Make innermost cursour-containing node the outermost node"},{label:"Remove linebreaks",command:"_oneLiner",hint:"Reformat query to a single line"},{label:"Create Template",command:"_generateCode",hint:"Create an Acre template that displays the result of this query"}];
k[m++]=d[17];var q=function(v){var u=b.runtime.new_markuplist(),A=0;b.runtime.foreach(this,v,function(w,z){for(var p=1;p;){u[A++]=d[18];if(this.subst_id)u[A++]=b.runtime.bless(' id="'+this.subst_id+'"');u[A++]=d[19];var t=b.runtime.uniqueid("onclick");mjt._eventcb[t]=function(){n[z.command]()};u[A++]=d[20];u[A++]=b.runtime.make_attr_safe(z.label,false);u[A++]=d[21];u[A++]=b.runtime.make_attr_safe(t,false);u[A++]=d[22];u[A++]=z.hint;u[A++]=d[23];p--}return p?b.runtime._break_token:b.runtime._continue_token});
return u};q=b.runtime.tfunc_factory("button(buttons)",q,b,undefined,false);q.source_microdata=null;k[m++]=d[24];k[m++]=q(r.slice(0,3));k[m++]=d[25];k[m++]=q(r.slice(3));k[m++]=d[26];return k};h=b.runtime.tfunc_factory("tools(controlPane)",h,b,undefined,false);c.tools=h;h.source_microdata=null;e[f++]=d[27];var j=function(n){var k=b.runtime.new_markuplist(),m=0;k[m++]=d[28];var r=function(){var q=b.runtime.new_markuplist(),v=0;q[v++]=d[29];if(this.subst_id)q[v++]=b.runtime.bless(' id="'+this.subst_id+
'"');q[v++]=d[30];var u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){$(this).closest(".cuecard-controlPane-variables-row").remove()};q[v++]=d[31];q[v++]=b.runtime.make_attr_safe(u,false);q[v++]=d[32];u=b.runtime.uniqueid("onclick");mjt._eventcb[u]=function(){n._getTab("variables").find(".cuecard-controlPane-variables").append($.acre(r()))};q[v++]=d[33];q[v++]=b.runtime.make_attr_safe(u,false);q[v++]=d[34];return q};r=b.runtime.tfunc_factory("add_row()",r,b,undefined,false);r.source_microdata=
null;k[m++]=d[35];k[m++]=r();k[m++]=d[36];return k};j=b.runtime.tfunc_factory("variables(controlPane)",j,b,undefined,false);c.variables=j;j.source_microdata=null;e[f++]=d[37];var l=function(n){var k=b.runtime.new_markuplist(),m=0;k[m++]=d[38];var r=n._getDefaults();k[m++]=d[39];b.runtime.foreach(this,[{name:"Extended",hint:"Enable MQL extensions"},{name:"As_of_time",hint:"Resolve the query based on data in Freebase as of the given time in ISO8601 format, e.g., 2009-02-28, 2009-03-13T22:16:40"},{name:"page",
hint:'Page number starting from 1 if there is a "limit" property in the top level query node.'},{name:"cursor",hint:""},{name:"Language",hint:"Return text values in the given language (specified with the language's Freebase ID)"},{name:"Escape",hint:""},{name:"uniqueness_failure",hint:""},{name:"use_permission_of",hint:'Specify the id of an object (typically a user, domain or type) whose permission you want to copy (<a href="http://freebaseapps.com/docs/mql/ch06.html#id2972357" target="_blank">more details</a>).'},
{name:"Show Costs",hint:"Inlcude backend costs of executing the query."}],function(A,w){for(var z=1;z;){k[m++]=d[40];k[m++]=w.name;k[m++]=d[41];switch(w.name){case "Show Costs":k[m++]=d[42];var p=r.show_costs?{checked:""}:{};"class"in p||(k[m++]=d[43]);"name"in p||(k[m++]=d[44]);"type"in p||(k[m++]=d[45]);for(var t in p){k[m++]=" "+t;k[m++]=b.runtime.bless('="');k[m++]=b.runtime.htmlencode(""+p[t]);k[m++]=b.runtime.bless('"')}k[m++]=d[46];break;case "Extended":k[m++]=d[47];p=r.extended?{checked:""}:
{};"class"in p||(k[m++]=d[48]);"name"in p||(k[m++]=d[49]);"type"in p||(k[m++]=d[50]);for(var s in p){k[m++]=" "+s;k[m++]=b.runtime.bless('="');k[m++]=b.runtime.htmlencode(""+p[s]);k[m++]=b.runtime.bless('"')}k[m++]=d[51];break;case "As_of_time":k[m++]=d[52];k[m++]=b.runtime.make_attr_safe(r.as_of_time||"",false);k[m++]=d[53];break;case "use_permission_of":k[m++]=d[54];k[m++]=b.runtime.make_attr_safe(r.use_permission_of||"",false);k[m++]=d[55];break;case "page":k[m++]=d[56];p=b.runtime.uniqueid("onclick");
mjt._eventcb[p]=function(){n._runPage(-1)};k[m++]=d[57];k[m++]=b.runtime.make_attr_safe(p,false);k[m++]=d[58];p=b.runtime.uniqueid("onclick");mjt._eventcb[p]=function(){n._runPage(1)};k[m++]=d[59];k[m++]=b.runtime.make_attr_safe(p,false);k[m++]=d[60];break;case "cursor":k[m++]=d[61];p=b.runtime.uniqueid("onchange");mjt._eventcb[p]=function(){n._getTab("envelope").find("input[name='cursor'][value='custom']").attr("checked","checked")};k[m++]=d[62];k[m++]=b.runtime.make_attr_safe(p,false);k[m++]=d[63];
p=b.runtime.uniqueid("onclick");mjt._eventcb[p]=function(){n._runCursor(false)};k[m++]=d[64];k[m++]=b.runtime.make_attr_safe(p,false);k[m++]=d[65];p=b.runtime.uniqueid("onclick");mjt._eventcb[p]=function(){n._runCursor(true)};k[m++]=d[66];k[m++]=b.runtime.make_attr_safe(p,false);k[m++]=d[67];break;case "Language":k[m++]=d[68];b.runtime.foreach(this,CueCard.Languages,function(y,B){for(var C=1;C;){k[m++]=d[69];var D=fb.lang===B.id?{selected:"selected"}:{};if(!("value"in D)){k[m++]=d[70];k[m++]=b.runtime.make_attr_safe(B.id,
false);k[m++]=d[71]}for(var E in D){k[m++]=" "+E;k[m++]=b.runtime.bless('="');k[m++]=b.runtime.htmlencode(""+D[E]);k[m++]=b.runtime.bless('"')}k[m++]=d[72];k[m++]=B.name;k[m++]=d[73];k[m++]=B.id;k[m++]=d[74];C--}return C?b.runtime._break_token:b.runtime._continue_token});k[m++]=d[75];break;case "Escape":k[m++]=d[76];break;case "uniqueness_failure":k[m++]=d[77];break}k[m++]=d[78];if(w.hint.length>0){k[m++]=d[79];k[m++]=mjt.bless(w.hint);k[m++]=d[80]}k[m++]=d[81];z--}return z?b.runtime._break_token:
b.runtime._continue_token});k[m++]=d[82];var q="env"in n._options?n._options.env:{},v=false;k[m++]=d[83];var u=function(A,w,z){var p=b.runtime.new_markuplist(),t=0;p[t++]=d[84];if(this.subst_id)p[t++]=b.runtime.bless(' id="'+this.subst_id+'"');p[t++]=d[85];p[t++]=b.runtime.make_attr_safe(w||"",false);p[t++]=d[86];p[t++]=b.runtime.make_attr_safe(z||"",false);p[t++]=d[87];w=b.runtime.uniqueid("onclick");mjt._eventcb[w]=function(){$(this).closest(".cuecard-controlPane-customEnvelope-row").remove()};
p[t++]=d[88];p[t++]=b.runtime.make_attr_safe(w,false);p[t++]=d[89];w=b.runtime.uniqueid("onclick");mjt._eventcb[w]=function(){n._getTab("envelope").find("table.cuecard-controlPane-customEnvelope").append($.acre(u()))};p[t++]=d[90];p[t++]=b.runtime.make_attr_safe(w,false);p[t++]=d[91];A||b.runtime.ondomready(function(){},this);p[t++]=d[92];return p};u=b.runtime.tfunc_factory("add_row(dontFocus, name, value)",u,b,undefined,false);u.source_microdata=null;k[m++]=d[93];b.runtime.foreach(this,q,function(A,
w){for(var z=1;z;){k[m++]=d[94];v=true;k[m++]=d[95];k[m++]=u(true,A,JSON.stringify(w));k[m++]=d[96];z--}return z?b.runtime._break_token:b.runtime._continue_token});k[m++]=d[97];if(!v){k[m++]=d[98];k[m++]=u(true);k[m++]=d[99]}k[m++]=d[100];return k};l=b.runtime.tfunc_factory("envelope(controlPane)",l,b,undefined,false);c.envelope=l;l.source_microdata=null;e[f++]=d[101];var o=function(){var n=b.runtime.new_markuplist(),k=0;n[k++]=d[102];var m=$.localstore("cc_cp_clean")=="1"?{checked:""}:{};"type"in
m||(n[k++]=d[103]);for(var r in m){n[k++]=" "+r;n[k++]=b.runtime.bless('="');n[k++]=b.runtime.htmlencode(""+m[r]);n[k++]=b.runtime.bless('"')}n[k++]=d[104];m=$.localstore("cc_cp_align")=="1"?{checked:""}:{};"type"in m||(n[k++]=d[105]);for(var q in m){n[k++]=" "+q;n[k++]=b.runtime.bless('="');n[k++]=b.runtime.htmlencode(""+m[q]);n[k++]=b.runtime.bless('"')}n[k++]=d[106];q=$.localstore("cc_cp_multi")=="1"?{checked:""}:{};"type"in q||(n[k++]=d[107]);for(var v in q){n[k++]=" "+v;n[k++]=b.runtime.bless('="');
n[k++]=b.runtime.htmlencode(""+q[v]);n[k++]=b.runtime.bless('"')}n[k++]=d[108];return n};o=b.runtime.tfunc_factory("settings(controlPane)",o,b,undefined,false);c.settings=o;o.source_microdata=null;e[f++]=d[109];return e};a.source_microdata=null;return a}(),info:{file:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/control-pane.mjt",stringtable:["","",'\n\n  <div class="cuecard-controlPane section-tabs">\n    <div id="','">\n      <ul class="section-tabset clear">','\n        <li class="section-tab tab">\n          <a href="#',
"-",'"><span>',"</span></a>\n        </li>",'\n      </ul>\n      <div class="tabbed-content">','\n        <div class="cuecard-controlPane-tabBody" id="',"-",'">\n          ',"\n        </div>","\n      </div>\n    </div>\n  </div>","","","","",'<div class="cuecard-controlPane-powerTool"',">",'\n    <input class="button" type="submit" value="','" onclick="return mjt._eventcb.','.apply(this, [event])">\n    <span class="cuecard-controlPane-powerTool-hint">',"</span>\n  </div>",'\n  \n\n  <div class="cuecard-controlPane-section">\n    <p><em>Transform query</em>, outputting to:\n      <input checked="true" name="tools-result" type="radio" value="replace">query pane\n      <input name="tools-result" type="radio" value="output">results pane</p>\n    ',
'\n  </div>\n\n  <div class="cuecard-controlPane-section">\n    <p><em>Acre Templates</em></p>\n    ',"\n  </div>","",'\n  <table class="cuecard-controlPane-variables">\n    <tr>\n      <th><h3 class="module-section-title">Name</h3></th>\n      <th><h3 class="module-section-title">Value</h3></th>\n      <th></th>\n    </tr>','<tr class="query-options-row"','>\n      <td><input class="text-input variables-input"></td>\n      <td><input class="text-input variables-input"></td>\n      <td>','\n        <input class="button small-button" type="submit" value="-" onclick="return mjt._eventcb.',
'.apply(this, [event])">','\n\t\t<input class="button small-button" type="submit" value="+" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>\n    </tr>',"\n    ","\n  </table>\n  <div>\n   \n  </div>","","",'\n  \n  <div class="cuecard-controlPane-explanation">\n    <p>The query envelope contains directives to the query engine, specifying how to execute the query or how to return the results.</p>\n  </div>\n  <div class="cuecard-controlPane-configurations">','\n    <div class="query-options-row">\n      <p><em>',
"</em></p>","<input",' class="query-options-input"',' name="costs"',' type="checkbox"',">","<input",' class="query-options-input"',' name="extended"',' type="checkbox"',">",'<input class="query-options-textbox text-input" name="as_of_time" value="','">','<input class="query-options-textbox text-input" name="use_permission_of" value="','">','<div class="cuecard-controlPane-configurations-page">\n            <input class="query-options-textbox text-input" name="page" type="text">','\n            <input class="button" type="submit" value="Previous" onclick="return mjt._eventcb.',
'.apply(this, [event])">','\n            <input class="button" type="submit" value="Next" onclick="return mjt._eventcb.','.apply(this, [event])">\n          </div>','\n            <div class="query-options-row">\n              <input checked="" class="control-pane-radio" id="cursor-unspecified" name="cursor-opt" type="radio" value="">\n              <label class="control-pane-label" for="cursor-unspecified">unspecified (return all results, possibly time-out)</label>\n            </div>\n            <div class="query-options-row"> \n              <input class="control-pane-radio" id="cursor-true" name="cursor-opt" type="radio" value="true">\n              <label class="control-pane-label" for="cursor-true">true (start pagination with page size equal "limit" option in query)</label>\n            </div>\n            <div class="query-options-row">\n              <input class="control-pane-radio" id="cursor-continue" name="cursor-opt" type="radio" value="custom">\n              <label class="control-pane-label" for="cursor-continue">continue from cursor: </label>\n              <div class="cuecard-controlPane-configurations-cursor">',
'\n                <input class="query-options-textbox text-input" name="cursor" type="text" onchange="return mjt._eventcb.','.apply(this, [event])">\n                <div class="query-options-row">','\n                  <input class="button" type="submit" value="Paste from Last Result" onclick="return mjt._eventcb.','.apply(this, [event])"> ','\n                  <input class="button" type="submit" value="Paste &amp; Run" onclick="return mjt._eventcb.','.apply(this, [event])">\n                </div>\n              </div>\n            </div>',
'<select class="cuecard-controlPane-configurations-languages">\n            <option value="">--</option>',"\n            <option",' value="','"',">\n              "," (",")\n            </option>","\n          </select>",'<select>\n            <option value="">--</option>\n            <option value="html">html</option>\n            <option value="false">false</option>\n          </select>','<select>\n            <option value="">--</option>\n            <option value="soft">soft</option>\n          </select>',
"\n        <!-- bless is OK because hints only come from ENV declared statically above --\>",'\n        <div class="cuecard-controlPane-hint">',"</div>","\n    </div>","\n  </div>",'\n\n  <p><em>Custom Envelope</em></p>\n  <table class="cuecard-controlPane-customEnvelope">\n    <tr>\n      <th><h3 class="module-section-title">Name</h3></th>\n      <th><h3 class="module-section-title">Value</h3></th>\n      <th></th>\n    </tr>','<tr class="cuecard-controlPane-customEnvelope-row"','>\n      <td><input class="query-options-textbox text-input variables-input" value="',
'"></td>\n      <td><input class="query-options-textbox text-input variables-input" value="','"></td>\n      <td>','\n        <input class="button small-button" type="submit" value="-" onclick="return mjt._eventcb.','.apply(this, [event])">','\n        <input class="button small-button" type="submit" value="+" onclick="return mjt._eventcb.','.apply(this, [event])">\n      </td>',"\n    </tr>","","","\n      ","","","\n      ","","\n  </table>","",'\n  <div class="cuecard-controlPane-section">\n    <div class="cuecard-controlPane-setting">\n     <input',
' type="checkbox"','>\n     <label class="control-pane-label">Always tidy running query</label>\n    </div>\n    <div class="cuecard-controlPane-setting">\n      <input',' type="checkbox"','>\n      <label class="control-pane-label">Align JSON values with spaces</label>\n    </div>\n    <div class="cuecard-controlPane-setting" style="display: none;">\n      <input type="checkbox">\n      <label class="control-pane-label">Try running query as you edit</label>\n    </div>\n    <div class="cuecard-controlPane-setting">\n      <input',
' type="checkbox"','>\n      <label class="control-pane-label">Show multi-line errors on multiple lines</label>\n    </div>\n  </div>',""],debug_locs:[1,1,1,1,1,1,7,7,7,7,9,9,10,11,12,13,14,15,16,19,19,19,19,19,21,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,26,26,26,26,26,26,26,26,26,26,26,27,27,27,28,28,28,28,28,28,33,33,33,33,33,33,34,35,36,37,38,39,40,41,42,42,42,42,42,42,44,44,44,44,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,71,71,71,71,71,71,71,71,71,
72,72,72,72,72,72,72,72,72,73,73,73,74,74,74,74,74,74,74,74,74,74,81,81,81,81,81,81,81,81,81,86,86,86,86,86,86,86,90,90,90,90,90,90,90,93,93,93,93,100,100,100,100,100,100,100,100,100,100,100,100,105,105,105,105,105,105,105,105,105,105,107,107,107,107,107,107,107,109,109,109,109,109,109,109,110,110,110,115,115,115,115,115,115,115,115,115,115,118,118,118,118,120,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,140,140,140,140,140,140,140,140,140,141,141,141,141,142,142,142,144,144,144,144,
144,144,144,144,144,144,144,144,144,144,144,144,144,144,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,146,148,148,148,148,148,150,150,150,150,150,154,154,154,154,154,154,154,154,155,155,155,155,155,155,155,156,156,156,156,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,171,173,173,173,173,173,173,173,173,174,174,174,174,174,174,174,178,178,178,178,178,178,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,183,184,184,184,184,184,185,
185,185,185,185,185,186,186,186,186,192,192,192,192,192,192,192,197,197,197,197,197,197,201,201,201,201,201,201,201,201,202,202,202,202,202,202,205,205,205,206,207,208,217,217,217,217,217,217,217,217,217,217,217,217,217,217,218,218,218,219,219,219,222,222,222,222,222,222,222,222,224,224,224,224,224,224,224,226,226,226,226,226,227,228,229,229,230,230,230,230,230,230,230,230,230,230,231,231,233,233,233,234,234,234,234,234,234,234,235,235,235,236,236,240,240,240,240,240,240,240,242,242,242,242,245,245,
245,245,245,245,245,245,245,245,245,245,245,245,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,257,257,257,257,257,257,257,257,257,257,257,257,257,257,257,257,257,257,257,261,261,261,261,261,261,261,261,261,263,263,263,263],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
(function(){jQuery&&jQuery(window).trigger("acre.template.register",{pkgid:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",source:{def:function(){var a=function(){var b=this.tpackage,c=this.exports,d=b._template_fragments,e=b.runtime.new_markuplist(),f=0;e[f++]=d[0];var g=this.exports,h;e[f++]=d[1];var j=function(l,o){var n=b.runtime.new_markuplist(),k=0;n[k++]=d[2];h=o;n[k++]=d[3];n[k++]=b.runtime.make_attr_safe(l,false);n[k++]=d[4];b.runtime.foreach(this,h._TABS,function(m,
r){for(var q=1;q;){n[k++]=d[5];n[k++]=b.runtime.make_attr_safe(l,false);n[k++]=d[6];n[k++]=b.runtime.make_attr_safe(r.key,false);n[k++]=d[7];n[k++]=r.name;n[k++]=d[8];q--}return q?b.runtime._break_token:b.runtime._continue_token});n[k++]=d[9];b.runtime.foreach(this,h._TABS,function(m,r){for(var q=1;q;){n[k++]=d[10];n[k++]=b.runtime.make_attr_safe(l,false);n[k++]=d[11];n[k++]=b.runtime.make_attr_safe(r.key,false);n[k++]=d[12];n[k++]=b.runtime.make_attr_safe(r.key,false);n[k++]=d[13];n[k++]=g[r.key]();
n[k++]=d[14];q--}return q?b.runtime._break_token:b.runtime._continue_token});n[k++]=d[15];b.runtime.ondomready(function(){var m=$(h._elmt);h._container=m.find(".cuecard-outputPane");h._tabsContainer=m.find(".cuecard-outputPane-tabs");h._contentContainer=m.find(".cuecard-outputPane-content")},this);n[k++]=d[16];return n};j=b.runtime.tfunc_factory("tabs(id, oP)",j,b,undefined,false);c.tabs=j;j.source_microdata=null;e[f++]=d[17];j=function(l,o){var n=b.runtime.new_markuplist(),k=0;n[k++]=d[18];if(l&&
l.result){n[k++]=d[19];var m=function(w,z){function p(y,B){for(var C in y){var D=y[C],E=B[C];D=jQuery.isArray(D)?D[0]:D;E=jQuery.isArray(E)?E[0]:E;if(E===undefined)return false;if(jQuery.isPlainObject(D)&&jQuery.isPlainObject(E))if(!p(D,E))return false}return true}var t=jQuery.extend(true,{},r);z=jQuery.isArray(z)?z[0]:z;for(var s=0;s<w.length;s++){t=t[w[s]];if(t===undefined)return false}return jQuery.isPlainObject(t)?p(z,t):true},r=function(w){function z(p){if(jQuery.isPlainObject(p)){var t=false;
for(var s in p){t=true;var y=z(p[s]);if(y===undefined)delete p[s];else p[s]=y}return t?p:undefined}else return jQuery.isArray(p)?p.length?z(p[0]):undefined:p===null?undefined:p}return z(w)}(o.query||{});n[k++]=d[20];var q=function(w,z){var p=b.runtime.new_markuplist(),t=0;p[t++]=d[21];if(this.subst_id)p[t++]=b.runtime.bless(' id="'+this.subst_id+'"');p[t++]=d[22];b.runtime.foreach(this,w,function(s,y){for(var B=1;B;){if(!m(z.concat(s),y)){p[t++]=d[23];p[t++]=s.split(":")[0].replace(/_/g," ");p[t++]=
d[24];p[t++]=v(y,z.concat(s));p[t++]=d[25]}B--}return B?b.runtime._break_token:b.runtime._continue_token});p[t++]=d[26];return p};q=b.runtime.tfunc_factory("thead(r, path)",q,b,undefined,false);q.source_microdata=null;n[k++]=d[27];var v=function(w,z){var p=b.runtime.new_markuplist(),t=0;p[t++]=d[28];if(jQuery.isArray(w))w=w[0];p[t++]=d[29];if(jQuery.isPlainObject(w)){p[t++]=d[30];b.runtime.foreach(this,w,function(s,y){for(var B=1;B;){if(!m(z.concat(s),y)){p[t++]=d[31];p[t++]=s.split(":")[0].replace(/_/g,
" ");p[t++]=d[32];p[t++]=v(y,z.concat(s));p[t++]=d[33]}B--}return B?b.runtime._break_token:b.runtime._continue_token});p[t++]=d[34]}p[t++]=d[35];return p};v=b.runtime.tfunc_factory("thead_value(v, path)",v,b,undefined,false);v.source_microdata=null;n[k++]=d[36];var u=function(w,z){var p=b.runtime.new_markuplist(),t=0;p[t++]=d[37];if(jQuery.isPlainObject(w)){p[t++]=d[38];b.runtime.foreach(this,w,function(s,y){for(var B=1;B;){if(!m(z.concat(s),y)){p[t++]=d[39];p[t++]=A(y,z.concat(s));p[t++]=d[40]}B--}return B?
b.runtime._break_token:b.runtime._continue_token});p[t++]=d[41]}else{p[t++]=d[42];p[t++]=A(val,z);p[t++]=d[43]}p[t++]=d[44];return p};u=b.runtime.tfunc_factory("row(r, path)",u,b,undefined,false);u.source_microdata=null;n[k++]=d[45];var A=function(w,z){var p=b.runtime.new_markuplist(),t=0;p[t++]=d[46];switch(typeof w){case "string":p[t++]=d[47];if(/^\//.test(w)){p[t++]=d[48];p[t++]=b.runtime.make_attr_safe(w,true);p[t++]=d[49];p[t++]=w;p[t++]=d[50]}else{p[t++]=d[51];p[t++]=w}p[t++]=d[52];break;case "number":p[t++]=
d[53];p[t++]=w;break;case "boolean":p[t++]=d[54];p[t++]=w?"true":"false";break;case "object":p[t++]=d[55];if(jQuery.isArray(w)){p[t++]=d[56];b.runtime.foreach(this,w,function(s,y){for(var B=1;B;){p[t++]=d[57];p[t++]=A(y,z);p[t++]=d[58];B--}return B?b.runtime._break_token:b.runtime._continue_token});p[t++]=d[59]}else if(jQuery.isPlainObject(w)){p[t++]=d[60];b.runtime.foreach(this,w,function(s,y){for(var B=1;B;){if(!m(z.concat(s),y)){p[t++]=d[61];p[t++]=A(y,z.concat(s));p[t++]=d[62]}B--}return B?b.runtime._break_token:
b.runtime._continue_token});p[t++]=d[63]}p[t++]=d[64];break}p[t++]=d[65];return p};A=b.runtime.tfunc_factory("value(a, path)",A,b,undefined,false);A.source_microdata=null;n[k++]=d[66];if(jQuery.isArray(l.result)){n[k++]=d[67];n[k++]=q(l.result[0],[]);n[k++]=d[68];b.runtime.foreach(this,l.result,function(w,z){for(var p=1;p;){n[k++]=d[69];n[k++]=u(z,[]);n[k++]=d[70];p--}return p?b.runtime._break_token:b.runtime._continue_token});n[k++]=d[71];if(l.cursor)n[k++]=d[72];n[k++]=d[73];if(l.result.length==
(o.query.limit||100))n[k++]=d[74];n[k++]=d[75]}else{n[k++]=d[76];if(typeof l.result==="object"){n[k++]=d[77];n[k++]=q(l.result,[])}n[k++]=d[78];n[k++]=u(l.result,[]);n[k++]=d[79]}n[k++]=d[80]}n[k++]=d[81];return n};j=b.runtime.tfunc_factory("list(o, q)",j,b,undefined,false);c.list=j;j.source_microdata=null;e[f++]=d[82];j=function(l){var o=b.runtime.new_markuplist(),n=0;o[n++]=d[83];if(h._options.stylesheet){o[n++]=d[84];o[n++]=b.runtime.make_attr_safe(h._options.stylesheet,true);o[n++]=d[85]}o[n++]=
d[86];o[n++]=l;o[n++]=d[87];return o};j=b.runtime.tfunc_factory("list_error(message)",j,b,undefined,false);c.list_error=j;j.source_microdata=null;e[f++]=d[88];j=function(){var l=b.runtime.new_markuplist(),o=0;l[o++]=d[89];return l};j=b.runtime.tfunc_factory("json()",j,b,undefined,false);c.json=j;j.source_microdata=null;e[f++]=d[90];j=function(){var l=b.runtime.new_markuplist(),o=0;l[o++]=d[91];b.runtime.foreach(this,CueCard.ExampleTechniques,function(k,m){for(var r=1;r;){l[o++]=d[92];var q=m==="all"?
{checked:"checked"}:{};if(!("data-technique"in q)){l[o++]=d[93];l[o++]=b.runtime.make_attr_safe(m,false);l[o++]=d[94]}for(var v in q){l[o++]=" "+v;l[o++]=b.runtime.bless('="');l[o++]=b.runtime.htmlencode(""+q[v]);l[o++]=b.runtime.bless('"')}l[o++]=d[95];l[o++]=m;l[o++]=d[96];l[o++]=CueCard.ExampleTechniqueMap[m].length;l[o++]=d[97];r--}return r?b.runtime._break_token:b.runtime._continue_token});l[o++]=d[98];var n=function(k){var m=b.runtime.new_markuplist(),r=0;m[r++]=d[99];b.runtime.foreach(this,
CueCard.Examples,function(q,v){for(var u=1;u;){if(k!=="all"?v.techniques.indexOf(k)!==-1:true){m[r++]=d[100];m[r++]=b.runtime.make_attr_safe(q,false);m[r++]=d[101];m[r++]=b.runtime.make_attr_safe(q,false);m[r++]=d[102];m[r++]=v.name;m[r++]=d[103]}u--}return u?b.runtime._break_token:b.runtime._continue_token});m[r++]=d[104];return m};n=b.runtime.tfunc_factory("list_examples(technique)",n,b,undefined,false);n.source_microdata=null;l[o++]=d[105];b.runtime.ondomready(function(){selectTechnique=function(k){k=
k||"all";$(".cuecard-examples-list").acre(n(k));return false};selectExample=function(k){$(".cuecard-examples-example").removeClass("cuecard-examples-example-selected");$("#cuecard-example-"+k).addClass("cuecard-examples-example-selected");h._options.queryEditor.content(CueCard.jsonize(CueCard.Examples[k].query,{indentCount:2}));h._options.queryEditor.run(false);return false};selectTechnique();$(".cuecard-examples-technique").change(function(){var k=$("option:selected",this).attr("data-technique");
selectTechnique(k)})},this);l[o++]=d[106];return l};j=b.runtime.tfunc_factory("help()",j,b,undefined,false);c.help=j;j.source_microdata=null;e[f++]=d[107];return e};a.source_microdata=null;return a}(),info:{file:"//13a.lib.www.tags.svn.freebase-site.googlecode.dev/cuecard/output-pane.mjt",stringtable:["","","",'\n  \n  <div class="cuecard-outputPane" id="','">\n    <div class="cuecard-outputPane-tabs">\n      <ul class="tab-nav clear">','\n        <li class="tab">\n          <a href="#',"-",'"><span>',
"</span></a>\n        </li>",'\n      </ul>\n    </div>\n    <div class="cuecard-outputPane-content tabbed-content module-section">','\n      <div class="cuecard-outputPane-tabBody" id="',"-",'">\n        <div class="cuecard-outputPane-','">\n          ',"\n        </div>\n      </div>","\n    </div>\n  </div>","","","",'\n  <table class="data-table">',"","<thead",">\n      <tr>","\n        <th>\n          "," ","\n        </th>","\n      </tr>\n    </thead>","","","","\n      <ul>","\n        <li>\n          ",
" ","\n        </li>","\n      </ul>","","","","","\n        <td>\n          ","\n        </td>","","\n      <td>","</td>","","","","",'\n          <a class="cuecard-outputPane-dataLink" href="','">',"</a>","","","","","",'\n          <ul class="data-list">',"\n            <li>\n              ","\n            </li>","\n          </ul>",'\n          <ul class="data-list">',"\n            <li>\n              ","\n            </li>","\n          </ul>","","","","\n      ","\n      <tbody>","\n        <tr>",
"</tr>","\n      </tbody>\n      <tfooter>\n        <tr>\n          <td>",'\n            <button onclick="__cc_runPage(-1)">Previous</button>',"",'\n            <button onclick="__cc_runPage(1)">Next</button>',"\n          </td>\n        </tr>\n      </tfooter>","","","\n      <tbody>\n        <tr>","</tr>\n      </tbody>","\n  </table>","","","",'\n  <link href="','" rel="stylesheet">','\n  <div class="cuecard-outputPane-list-error">',"</div>","","","",'\n  <div class="cuecard-outputPane-helpContent">\n    <ul>\n      <li><a href="http://www.freebase.com/docs/data" target="_blank">MQL Tutorial</a></li>\n      <li><a href="http://www.freebase.com/docs/mql" target="_blank">MQL\u00a0Reference</a></li>\n    </ul>\n\n    <div class="modal-inner">\n      <h1 class="modal-title">\n        <span>Examples</span>\n      </h1>\n      Techniques:\n      <select class="cuecard-examples-technique">',
"\n        <option",' data-technique="','"',">\n          "," (",")\n        </option>","\n      </select>","",'\n        <a class="cuecard-examples-example" href="javascript:selectExample(\'','\')" id="cuecard-example-','">\n          ',"\n        </a>","",'\n      \n      <div class="cuecard-examples-list"></div>\n    </div>',"\n  </div>",""],debug_locs:[1,1,1,1,1,1,6,6,7,8,9,11,11,11,11,13,13,14,15,17,17,17,17,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,26,26,26,26,26,26,26,26,
26,26,26,26,27,27,27,28,28,28,30,30,30,30,30,30,30,34,34,34,34,34,35,36,37,38,39,40,41,41,41,41,41,41,43,43,43,43,44,44,45,45,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,98,98,98,98,98,98,100,100,100,100,100,100,101,101,101,101,101,101,102,102,102,102,102,102,102,104,104,104,104,104,104,104,106,106,106,106,107,107,108,108,109,109,109,109,109,109,110,110,110,110,110,110,111,111,111,111,111,
111,111,112,112,112,113,113,113,113,113,115,115,115,115,116,116,117,117,117,117,117,118,118,118,118,119,119,119,119,119,119,119,120,120,121,121,121,121,121,121,122,122,122,122,122,124,124,124,124,125,125,125,127,127,127,127,127,127,127,127,127,128,128,128,128,129,129,129,130,130,130,130,131,131,131,131,133,133,134,134,134,134,134,135,135,135,135,136,136,136,136,136,136,137,137,137,138,139,139,139,139,139,139,140,140,140,140,141,141,141,141,141,141,141,142,142,142,143,143,143,144,144,144,144,144,147,
147,148,148,148,150,150,150,150,150,150,150,150,150,150,150,150,150,155,155,155,155,155,155,155,155,155,156,156,156,156,156,160,160,160,160,160,161,162,162,162,162,162,164,164,164,164,166,166,166,167,167,167,168,168,168,168,168,168,171,171,171,171,172,172,172,172,172,172,172,173,173,173,174,174,174,174,174,174,177,177,177,177,178,178,178,178,178,178,181,181,181,181,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,195,196,196,196,196,
196,197,197,197,197,197,197,200,200,200,200,200,203,203,203,203,203,203,203,203,203,203,204,204,204,205,205,205,205,205,205,205,206,206,206,206,206,210,210,210,210,210,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,234,234,234,234,234,234,234,235,235,235,235],output_mode:"html"}}})})(window.freebase.acre,window.freebase.h);
