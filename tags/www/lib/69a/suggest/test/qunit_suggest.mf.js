
/*
 * Copyright 2012, Google Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Additional Licenses for Third Party components can be found here:
 * http://wiki.freebase.com/wiki/Freebase_Site_License
 *
 */
(function(b,g){if(!("console"in window)){var d=window.console={};d.log=d.warn=d.error=d.debug=function(){}}b(function(){var a=b("<div>");b(document.body).append(a);var c=setTimeout(function(){if(b.cleanData){var f=b.cleanData;b.cleanData=function(h){for(var i=0,k;(k=h[i])!=null;i++)b(k).triggerHandler("remove");f(h)}}else{var j=b.fn.remove;b.fn.remove=function(h,i){return this.each(function(){if(!i)if(!h||b.filter(h,[this]).length)b("*",this).add([this]).each(function(){b(this).triggerHandler("remove")});
return j.call(b(this),h,i)})}}},1);a.bind("remove",function(){clearTimeout(c)});a.remove()});b.suggest=function(a,c){b.fn[a]=function(f){this.length||console.warn("Suggest: invoked on empty element set");return this.each(function(){if(this.nodeName)if(this.nodeName.toUpperCase()==="INPUT")this.type&&this.type.toUpperCase()!=="TEXT"&&console.warn("Suggest: unsupported INPUT type: "+this.type);else console.warn("Suggest: unsupported DOM element: "+this.nodeName);var j=b.data(this,a);j&&j._destroy();
b.data(this,a,new b.suggest[a](this,f))._init()})};b.suggest[a]=function(f,j){var h=this,i=this.options=b.extend(true,{},b.suggest.defaults,b.suggest[a].defaults,j),k=i.css_prefix=i.css_prefix||"",n=i.css;this.name=a;b.each(n,function(l){n[l]=k+n[l]});i.ac_param={};b.each(["key","filter","spell","exact","lang","scoring","prefixed","stemmed","format","mql_output"],function(l,p){var r=i[p];r===null||r===""||(i.ac_param[p]=r)});this._status={START:"",LOADING:"",SELECT:"",ERROR:""};if(i.status&&i.status instanceof
Array&&i.status.length>=3){this._status.START=i.status[0]||"";this._status.LOADING=i.status[1]||"";this._status.SELECT=i.status[2]||"";if(i.status.length===4)this._status.ERROR=i.status[3]||""}var o=this.status=b('<div style="display:none;">').addClass(n.status),m=this.list=b("<ul>").addClass(n.list),q=this.pane=b('<div style="display:none;" class="fbs-reset">').addClass(n.pane);q.append(o).append(m);if(i.parent)b(i.parent).append(q);else{q.css("position","absolute");i.zIndex&&q.css("z-index",i.zIndex);
b(document.body).append(q)}q.bind("mousedown",function(l){h.input.data("dont_hide",true);l.stopPropagation()}).bind("mouseup",function(l){h.input.data("dont_hide")&&h.input.focus();h.input.removeData("dont_hide");l.stopPropagation()}).bind("click",function(l){l.stopPropagation();if(l=h.get_selected()){h.onselect(l,true);h.hide_all()}});m.hover(function(l){h.hoverover_list(l)},function(l){h.hoverout_list(l)});this.input=b(f).attr("autocomplete","off").unbind(".suggest").bind("remove.suggest",function(){h._destroy()}).bind("keydown.suggest",
function(l){h.keydown(l)}).bind("keypress.suggest",function(l){h.keypress(l)}).bind("keyup.suggest",function(l){h.keyup(l)}).bind("blur.suggest",function(l){h.blur(l)}).bind("textchange.suggest",function(){h.textchange()}).bind("focus.suggest",function(l){h.focus(l)}).bind(b.browser.msie?"paste.suggest":"input.suggest",function(){clearTimeout(h.paste_timeout);h.paste_timeout=setTimeout(function(){h.textchange()},0)});this.onresize=function(){h.invalidate_position();if(q.is(":visible")){h.position();
if(i.flyout&&h.flyoutpane&&h.flyoutpane.is(":visible")){var l=h.get_selected();l&&h.flyout_position(l)}}};b(window).bind("resize.suggest",this.onresize).bind("scroll.suggest",this.onresize)};b.suggest[a].prototype=b.extend({},b.suggest.prototype,c)};b.suggest.prototype={_init:function(){},_destroy:function(){this.pane.remove();this.list.remove();this.input.unbind(".suggest");b(window).unbind("resize.suggest",this.onresize).unbind("scroll.suggest",this.onresize);this.input.removeData("data.suggest")},
invalidate_position:function(){self._position=null},status_start:function(){this.hide_all();this.status.siblings().hide();if(this._status.START){this.status.text(this._status.START).show();if(!this.pane.is(":visible")){this.position();this.pane_show()}}this._status.LOADING&&this.status.removeClass("loading")},status_loading:function(){this.status.siblings().show();if(this._status.LOADING){this.status.addClass("loading").text(this._status.LOADING).show();if(!this.pane.is(":visible")){this.position();
this.pane_show()}}else this.status.hide()},status_select:function(){this.status.siblings().show();this._status.SELECT?this.status.text(this._status.SELECT).show():this.status.hide();this._status.LOADING&&this.status.removeClass("loading")},status_error:function(){this.status.siblings().show();this._status.ERROR?this.status.text(this._status.ERROR).show():this.status.hide();this._status.LOADING&&this.status.removeClass("loading")},focus:function(a){this.input.val()===""?this.status_start():this.focus_hook(a)},
focus_hook:function(){if(!this.input.data("data.suggest")&&!this.pane.is(":visible")&&b("."+this.options.css.item,this.list).length){this.position();this.pane_show()}},keydown:function(a){var c=a.keyCode;if(c===9)this.tab(a);else if(c===38||c===40)a.shiftKey||a.preventDefault()},keypress:function(a){var c=a.keyCode;if(c===38||c===40)a.shiftKey||a.preventDefault();else c===13&&this.enter(a)},keyup:function(a){var c=a.keyCode;if(c===38){a.preventDefault();this.up(a)}else if(c===40){a.preventDefault();
this.down(a)}else if(a.ctrlKey&&c===77)b(".fbs-more-link",this.pane).click();else if(b.suggest.is_char(a)){clearTimeout(this.keypress.timeout);var f=this;this.keypress.timeout=setTimeout(function(){f.textchange()},0)}else c===27&&this.escape(a);return true},blur:function(){if(!this.input.data("dont_hide")){this.input.data("data.suggest");this.hide_all()}},tab:function(a){if(!(a.shiftKey||a.metaKey||a.ctrlKey)){a=this.options;a=this.pane.is(":visible")&&b("."+a.css.item,this.list).length;var c=this.get_selected();
if(a&&c){this.onselect(c);this.hide_all()}}},enter:function(a){var c=this.options;if(this.pane.is(":visible"))if(a.shiftKey){this.shift_enter(a);a.preventDefault()}else if(b("."+c.css.item,this.list).length)if(c=this.get_selected()){this.onselect(c);this.hide_all();a.preventDefault()}else{this.input.data("data.suggest");if(b("."+this.options.css.item+":visible",this.list).length){this.updown(false);a.preventDefault()}}},shift_enter:function(){},escape:function(){this.hide_all()},up:function(a){this.updown(true,
a.ctrlKey||a.shiftKey)},down:function(a){this.updown(false,null,a.ctrlKey||a.shiftKey)},updown:function(a,c,f){var j=this.options.css,h=this.list;if(this.pane.is(":visible")){var i=b("."+j.item+":visible",h);if(i.length){h=b(i[0]);i=b(i[i.length-1]);var k=this.get_selected()||[];clearTimeout(this.ignore_mouseover.timeout);this._ignore_mouseover=false;if(a)if(c)this._goto(h);else if(k.length)if(k[0]==h[0]){h.removeClass(j.selected);this.input.val(this.input.data("original.suggest"));this.hoverout_list()}else this._goto(k.prevAll("."+
j.item+":visible:first"));else this._goto(i);else if(f)this._goto(i);else if(k.length)if(k[0]==i[0]){i.removeClass(j.selected);this.input.val(this.input.data("original.suggest"));this.hoverout_list()}else this._goto(k.nextAll("."+j.item+":visible:first"));else this._goto(h)}}else a||this.textchange()},_goto:function(a){a.trigger("mouseover.suggest");var c=a.data("data.suggest");this.input.val(c?c.name:this.input.data("original.suggest"));this.scroll_to(a)},scroll_to:function(a){var c=this.list,f=
c.scrollTop(),j=f+c.innerHeight(),h=a.outerHeight();a=a.prevAll().length*h;h=a+h;if(a<f){this.ignore_mouseover();c.scrollTop(a)}else if(h>j){this.ignore_mouseover();c.scrollTop(f+h-j)}},textchange:function(){this.input.removeData("data.suggest");this.input.trigger("fb-textchange",this);var a=this.input.val();if(a==="")this.status_start();else{this.status_loading();this.request(a)}},request:function(){},response:function(a){if(a){"cost"in a&&this.trackEvent(this.name,"response","cost",a.cost);if(this.check_response(a)){var c=
[];if(b.isArray(a))c=a;else if("result"in a)c=a.result;var f=b.map(arguments,function(n){return n});this.response_hook.apply(this,f);var j=null,h=this,i=this.options;b.each(c,function(n,o){if(!o.id&&o.mid)o.id=o.mid;var m=h.create_item(o,a).bind("mouseover.suggest",function(q){h.mouseover_item(q)});m.data("data.suggest",o);h.list.append(m);if(n===0)j=m});this.input.data("original.suggest",this.input.val());if(b("."+i.css.item,this.list).length===0&&i.nomatch){c=b('<li class="fbs-nomatch">');if(typeof i.nomatch===
"string")c.text(i.nomatch);else{i.nomatch.title&&c.append(b('<em class="fbs-nomatch-text">').text(i.nomatch.title));i.nomatch.heading&&c.append(b("<h3>").text(i.nomatch.heading));if((i=i.nomatch.tips)&&i.length){var k=b('<ul class="fbs-search-tips">');b.each(i,function(n,o){k.append(b("<li>").text(o))});c.append(k)}}c.bind("click.suggest",function(n){n.stopPropagation()});this.list.append(c)}f.push(j);this.show_hook.apply(this,f);this.position();this.pane_show()}}},pane_show:function(){var a=false;
if(b("> li",this.list).length)a=true;a||this.pane.children(":not(."+this.options.css.list+")").each(function(){if(b(this).css("display")!="none"){a=true;return false}});if(a)if(this.options.animate){var c=this;this.pane.slideDown("fast",function(){c.input.trigger("fb-pane-show",c)})}else{this.pane.show();this.input.trigger("fb-pane-show",this)}else{this.pane.hide();this.input.trigger("fb-pane-hide",this)}},create_item:function(a){var c=this.options.css,f=b("<li>").addClass(c.item);a=b("<label>").text(a.name);
f.append(b("<div>").addClass(c.item_name).append(a));return f},mouseover_item:function(a){if(!this._ignore_mouseover){a=a.target;if(a.nodeName.toLowerCase()!=="li")a=b(a).parents("li:first");var c=b(a),f=this.options.css;b("."+f.item,this.list).each(function(){this!==c[0]&&b(this).removeClass(f.selected)});if(!c.hasClass(f.selected)){c.addClass(f.selected);this.mouseover_item_hook(c)}}},mouseover_item_hook:function(){},hoverover_list:function(){},hoverout_list:function(){},check_response:function(){return true},
response_hook:function(){this.list.empty()},show_hook:function(){this.status_select()},position:function(){var a=this.pane,c=this.options;if(!c.parent){if(!self._position){var f=this.input,j=f.offset(),h=f.outerWidth(true),i=f.outerHeight(true);j.top+=i;var k=a.outerWidth(),n=a.outerHeight(),o=j.top+n/2,m=b(window).scrollLeft();f=b(window).scrollTop();var q=b(window).width(),l=b(window).height()+f,p=true;if("left"==c.align)p=true;else if("right"==c.align)p=false;else if(j.left>m+q/2)p=false;if(!p){p=
j.left-(k-h);if(p>m)j.left=p}if(o>l){c=j.top-i-n;if(c>f)j.top=c}this._position=j}a.css({top:this._position.top,left:this._position.left})}},ignore_mouseover:function(){this._ignore_mouseover=true;var a=this;this.ignore_mouseover.timeout=setTimeout(function(){a.ignore_mouseover_reset()},1E3)},ignore_mouseover_reset:function(){this._ignore_mouseover=false},get_selected:function(){var a=null,c=this.options.css.selected;b("li",this.list).each(function(){var f=b(this);if(f.hasClass(c)&&f.is(":visible")){a=
f;return false}});return a},onselect:function(a){var c=a.data("data.suggest");if(c){this.input.val(c.name).data("data.suggest",c).trigger("fb-select",c);this.trackEvent(this.name,"fb-select","index",a.prevAll().length)}},trackEvent:function(a,c,f,j){this.input.trigger("fb-track-event",{category:a,action:c,label:f,value:j})},hide_all:function(){this.pane.hide();this.input.trigger("fb-pane-hide",this)}};b.extend(b.suggest,{defaults:{status:["Start typing to get suggestions...","Searching...","Select an item from the list:",
"Sorry, something went wrong. Please try again later"],soft:false,nomatch:"no matches",css:{pane:"fbs-pane",list:"fbs-list",item:"fbs-item",item_name:"fbs-item-name",selected:"fbs-selected",status:"fbs-status"},css_prefix:null,parent:null,animate:false,zIndex:null},use_jsonp:function(a){if(!a)return false;var c=window.location.href;c=c.substr(0,c.length-window.location.pathname.length);if(c===a)return false;return true},strongify:function(a,c){var f,j=a.toLowerCase().indexOf(c.toLowerCase());if(j>=
0){var h=c.length;f=document.createTextNode(a.substring(0,j));var i=b("<strong>").text(a.substring(j,j+h));j=document.createTextNode(a.substring(j+h));f=b("<div>").append(f).append(i).append(j)}else f=b("<div>").text(a);return f},keyCode:{CAPS_LOCK:20,CONTROL:17,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ENTER:108,PAGE_DOWN:34,PAGE_UP:33,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,OPTION:18,APPLE:224},is_char:function(a){if(a.type==="keypress")if((a.metaKey||a.ctrlKey)&&a.charCode===
118)return true;else{if("isChar"in a)return a.isChar}else{var c=b.suggest.keyCode.not_char;if(!c){c={};b.each(b.suggest.keyCode,function(f,j){c[""+j]=1});b.suggest.keyCode.not_char=c}return!(""+a.keyCode in c)}},parse_input:function(a){var c=[];a=b.trim(a);if(a==="")return["",c];var f=a.search(/[\S]+\:[\S]/);if(f===-1)return[a,c];var j=b.trim(a.substring(0,f));a=a.substring(f);f=/(\S+\:"[^\"]+\"|\S+\:\S+)/g;for(var h=f.exec(a);h;){c.push(h[0]);h=f.exec(a)}return[j,c]},mqlkey_fast:/^[_A-Za-z0-9][A-Za-z0-9_-]*$/,
mqlkey_slow:/^(?:[A-Za-z0-9]|\$[A-F0-9]{4})(?:[A-Za-z0-9_-]|\$[A-F0-9]{4})*$/,check_mql_key:function(a){if(b.suggest.mqlkey_fast.test(a))return true;else if(b.suggest.mqlkey_slow.test(a))return true;return false},check_mql_id:function(a){if(a.indexOf("/")===0){a=a.split("/");a.shift();if(!(a.length==1&&a[0]===""))for(var c=0,f=a.length;c<f;c++)if(!b.suggest.check_mql_key(a[c]))return false;return true}else return false}});var e={_destroy:b.suggest.prototype._destroy,show_hook:b.suggest.prototype.show_hook};
b.suggest("suggest",{_init:function(){var a=this,c=this.options;if(c.flyout_service_url==null)c.flyout_service_url=c.service_url;this.flyout_url=c.flyout_service_url;if(c.flyout_service_path)this.flyout_url+=c.flyout_service_path;this.jsonp=true;this.jsonp_flyout=b.suggest.use_jsonp(c.flyout_service_url);if(!b.suggest.cache)b.suggest.cache={};if(c.flyout){this.flyoutpane=b('<div style="display:none;" class="fbs-reset">').addClass(c.css.flyoutpane);if(c.flyout_parent)b(c.flyout_parent).append(this.flyoutpane);
else{this.flyoutpane.css("position","absolute");c.zIndex&&this.flyoutpane.css("z-index",c.zIndex);b(document.body).append(this.flyoutpane)}this.flyoutpane.hover(function(f){a.hoverover_list(f)},function(f){a.hoverout_list(f)}).bind("mousedown.suggest",function(f){f.stopPropagation();a.pane.click()});if(!b.suggest.flyout)b.suggest.flyout={};if(!b.suggest.flyout.cache)b.suggest.flyout.cache={}}},_destroy:function(){e._destroy.call(this);this.flyoutpane&&this.flyoutpane.remove();this.input.removeData("request.count.suggest");
this.input.removeData("flyout.request.count.suggest")},shift_enter:function(){if(this.options.suggest_new){this.suggest_new();this.hide_all()}},hide_all:function(){this.pane.hide();this.flyoutpane&&this.flyoutpane.hide();this.input.trigger("fb-pane-hide",this);this.input.trigger("fb-flyoutpane-hide",this)},request:function(a,c){var f=this,j=this.options;if(this.ac_xhr){!this.jsonp&&this.ac_xhr.abort&&this.ac_xhr.abort();this.ac_xhr=null}var h=a,i=j.ac_param.filter||[];if(b.type(i)==="string")i=[i];
i=i.slice();if(j.advanced){var k=b.suggest.parse_input(h);h=k[0];k[1].length&&i.push("(all "+k[1].join(" ")+")");if(b.suggest.check_mql_id(h)){i.push('(all mid:"'+h+'")');h=""}}k={};k[j.query_param_name]=h;if(c)k.cursor=c;b.extend(k,j.ac_param);if(i.length)k.filter=i;var n=j.service_url+j.service_path+"?"+b.param(k,true);if(h=b.suggest.cache[n])this.response(h,c?c:-1,true);else{clearTimeout(this.request.timeout);var o={url:j.service_url+j.service_path,data:k,traditional:true,beforeSend:function(){var m=
f.input.data("request.count.suggest")||0;m||f.trackEvent(f.name,"start_session");m+=1;f.trackEvent(f.name,"request","count",m);f.input.data("request.count.suggest",m)},success:function(m){b.suggest.cache[n]=m;m.prefix=a;f.response(m,c?c:-1)},error:function(m){f.status_error();f.trackEvent(f.name,"request","error",{url:this.url,response:m?m.responseText:""});f.input.trigger("fb-error",Array.prototype.slice.call(arguments))},complete:function(m){m&&f.trackEvent(f.name,"request","tid",m.getResponseHeader("X-Metaweb-TID"))},
dataType:f.jsonp?"jsonp":"json",cache:true};this.request.timeout=setTimeout(function(){f.ac_xhr=b.ajax(o)},j.xhr_delay)}},create_item:function(a,c){var f=this.options.css,j=b("<li>").addClass(f.item),h=b("<div>").addClass(f.item_name).append(b("<label>").append(b.suggest.strongify(a.name||a.id,c.prefix)));j.append(h);var i=a.notable;f=b("<div>").addClass(f.item_type);if(i&&i.name)f.text(i.name);else a.id&&f.text(a.id);h.prepend(f);return j},mouseover_item_hook:function(a){a=a.data("data.suggest");
this.options.flyout&&a&&this.flyout_request(a)},check_response:function(a){return a.prefix===this.input.val()},response_hook:function(a,c){this.flyoutpane&&this.flyoutpane.hide();c>0?b(".fbs-more",this.pane).remove():this.list.empty()},show_hook:function(a,c,f){e.show_hook.apply(this,[a]);var j=this.options,h=this,i=this.pane,k=this.list,n=a.result,o=b(".fbs-more",i),m=b(".fbs-suggestnew",i);b(".fbs-status",i);var q=a.correction;if(q&&q.length){var l=b('<a class="fbs-spell-link" href="#">').append(q[0]).bind("click.suggest",
function(p){p.preventDefault();p.stopPropagation();h.input.val(q[0]).trigger("textchange")});h.status.empty().append("Search instead for ").append(l).show()}if(n&&n.length&&"cursor"in a){if(!o.length){n=b('<a class="fbs-more-link" href="#" title="(Ctrl+m)">view more</a>');o=b('<div class="fbs-more">').append(n);n.bind("click.suggest",function(p){p.preventDefault();p.stopPropagation();p=b(this).parent(".fbs-more");h.more(p.data("cursor.suggest"))});k.after(o)}o.data("cursor.suggest",a.cursor);o.show()}else o.remove();
if(j.suggest_new){if(!m.length){a=b('<button class="fbs-suggestnew-button">');a.text(j.suggest_new);m=b('<div class="fbs-suggestnew">').append('<div class="fbs-suggestnew-description">Your item not in the list?</div>').append(a).append('<span class="fbs-suggestnew-shortcut">(Shift+Enter)</span>').bind("click.suggest",function(p){p.stopPropagation();h.suggest_new(p)});i.append(m)}m.show()}else m.remove();if(f&&f.length&&c>0){c=f.prevAll().length*f.outerHeight();k.scrollTop();k.animate({scrollTop:c},
"slow",function(){f.trigger("mouseover.suggest")})}},suggest_new:function(){var a=this.input.val();if(a!==""){this.input.data("data.suggest",a).trigger("fb-select-new",a);this.trackEvent(this.name,"fb-select-new","index","new");this.hide_all()}},more:function(a){if(a){var c=this.input.data("original.suggest");c!==null&&this.input.val(c);this.request(this.input.val(),a);this.trackEvent(this.name,"more","cursor",a)}return false},flyout_request:function(a){var c=this;if(this.flyout_xhr){!this.jsonp_flyout&&
this.flyout_xhr.abort&&this.flyout_xhr.abort();this.flyout_xhr=null}var f=this.options,j=this.flyoutpane.data("data.suggest");if(j&&a.id===j.id){if(!this.flyoutpane.is(":visible")){this.flyout_position(this.get_selected());this.flyoutpane.show();this.input.trigger("fb-flyoutpane-show",this)}}else if((j=b.suggest.flyout.cache[a.id])&&j.id&&j.html)this.flyout_response(j);else{var h=a.id,i={url:this.flyout_url.replace(/\$\{id\}/g,a.id),traditional:true,data:{},beforeSend:function(){var k=c.input.data("flyout.request.count.suggest")||
0;k+=1;c.trackEvent(c.name,"flyout.request","count",k);c.input.data("flyout.request.count.suggest",k)},success:function(k){k=c.jsonp_flyout?k:{id:h,html:k};b.suggest.flyout.cache[k.id]=k;c.flyout_response(k)},error:function(k){c.trackEvent(c.name,"flyout","error",{url:this.url,response:k?k.responseText:""})},complete:function(k){k&&c.trackEvent(c.name,"flyout","tid",k.getResponseHeader("X-Metaweb-TID"))},dataType:c.jsonp_flyout?"jsonp":"html",cache:true};if(f.ac_param.lang)i.data.lang=f.ac_param.lang;
clearTimeout(this.flyout_request.timeout);this.flyout_request.timeout=setTimeout(function(){c.flyout_xhr=b.ajax(i)},f.xhr_delay);this.input.trigger("fb-request-flyout",i)}},flyout_response:function(a){var c=this.pane,f=this.get_selected()||[];if(c.is(":visible")&&f.length)if((c=f.data("data.suggest"))&&a.id===c.id&&a.html){this.flyoutpane.html(a.html);this.flyout_position(f);this.flyoutpane.show().data("data.suggest",c);this.input.trigger("fb-flyoutpane-show",this)}},flyout_position:function(a){if(!this.options.flyout_parent){var c=
this.pane,f=this.flyoutpane,j=this.options.css,h=g,i={top:parseInt(f.css("top"),10),left:parseInt(f.css("left"),10)},k=c.offset(),n=c.outerWidth(),o=f.outerHeight(),m=f.outerWidth();if(this.options.flyout==="bottom"){h=k;n=this.input.offset();if(k.top<n.top)h.top-=o;else h.top+=c.outerHeight();f.addClass(j.flyoutpane+"-bottom")}else{h=a.offset();a=a.outerHeight();h.left+=n;var q=h.left+m;c=b(document.body).scrollLeft();var l=b(window).width()+c;h.top=h.top+a-o;if(h.top<k.top)h.top=k.top;if(q>l){k=
h.left-(n+m);if(k>c)h.left=k}f.removeClass(j.flyoutpane+"-bottom")}h.top===i.top&&h.left===i.left||f.css({top:h.top,left:h.left})}},hoverout_list:function(){this.flyoutpane&&!this.get_selected()&&this.flyoutpane.hide()}});b.extend(b.suggest.suggest,{defaults:{filter:null,spell:"always",exact:false,scoring:null,lang:null,key:null,prefixed:true,stemmed:null,format:"ac",advanced:true,query_param_name:"query",service_url:"https://www.googleapis.com",service_path:"/freebase/v1/search",align:null,flyout:true,
flyout_service_url:"http://dev.freebase.com",flyout_service_path:"/flyout?id=${id}",flyout_parent:null,suggest_new:null,nomatch:{title:"No suggested matches",heading:"Tips on getting better suggestions:",tips:["Enter more or fewer characters","Add words related to your original search","Try alternate spellings","Check your spelling"]},css:{item_type:"fbs-item-type",flyoutpane:"fbs-flyout-pane"},xhr_delay:200}});document.createElement("input")})(jQuery);
(function(b){b.fn.extend({simulate:function(g,d){return this.each(function(){var e=b.extend({},b.simulate.defaults,d||{});new b.simulate(this,g,e)})}});b.simulate=function(g,d,e){this.target=g;this.options=e;/^drag$/.test(d)?this[d].apply(this,[this.target,e]):this.simulateEvent(g,d,e)};b.extend(b.simulate.prototype,{simulateEvent:function(g,d,e){var a=this.createEvent(d,e);this.dispatchEvent(g,d,a,e);return a},createEvent:function(g,d){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(g))return this.mouseEvent(g,
d);else if(/^key(up|down|press)$/.test(g))return this.keyboardEvent(g,d)},mouseEvent:function(g,d){var e,a=b.extend({bubbles:true,cancelable:g!="mousemove",view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},d);b(a.relatedTarget);if(b.isFunction(document.createEvent)){e=document.createEvent("MouseEvents");e.initMouseEvent(g,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,
a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget||document.body.parentNode)}else if(document.createEventObject){e=document.createEventObject();b.extend(e,a);e.button={0:1,1:4,2:2}[e.button]||e.button}return e},keyboardEvent:function(g,d){var e,a=b.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},d);if(b.isFunction(document.createEvent))try{e=document.createEvent("KeyEvents");e.initKeyEvent(g,a.bubbles,a.cancelable,
a.view,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode)}catch(c){e=document.createEvent("Events");e.initEvent(g,a.bubbles,a.cancelable);b.extend(e,{view:a.view,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,metaKey:a.metaKey,keyCode:a.keyCode,charCode:a.charCode})}else if(document.createEventObject){e=document.createEventObject();b.extend(e,a)}if(b.browser.msie||b.browser.opera){e.keyCode=a.charCode>0?a.charCode:a.keyCode;e.charCode=undefined}return e},dispatchEvent:function(g,
d,e){if(g.dispatchEvent)g.dispatchEvent(e);else g.fireEvent&&g.fireEvent("on"+d,e);return e},drag:function(){var g=this.findCenter(this.target),d=this.options,e=Math.floor(g.x);g=Math.floor(g.y);var a=d.dx||0;d=d.dy||0;var c=this.target,f={clientX:e,clientY:g};this.simulateEvent(c,"mousedown",f);f={clientX:e+1,clientY:g+1};this.simulateEvent(document,"mousemove",f);f={clientX:e+a,clientY:g+d};this.simulateEvent(document,"mousemove",f);this.simulateEvent(document,"mousemove",f);this.simulateEvent(c,
"mouseup",f)},findCenter:function(g){g=b(this.target);var d=g.offset();return{x:d.left+g.outerWidth()/2,y:d.top+g.outerHeight()/2}}});b.extend(b.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})})(jQuery);var test_input1,test_input2,test_input3,test_input4,TIMEOUT_DELAY=5E3;$(function(){test_input1=$("#test1");test_input2=$("#test2");test_input3=$("#test3");test_input4=$("#test4")});
var module_options={setup:function(){},teardown:function(){$.suggest.cache={};if($.suggest.flyout)$.suggest.flyout.cache={};$.each([test_input1,test_input2,test_input3,test_input4],function(b,g){g.unbind();var d=get_instance(g);d&&d._destroy();g.val("")})}},default_options={service_path:"/freebase/v1/search",key:"AIzaSyBij3tRJN2VdWiLQN48-BmPFjNWpHe7MQE",flyout_service_url:"",advanced:true},test_value="bob dyla",bob_dylan_id="/m/01vrncs",position_threshold=10;
function get_instance(b){b=b||test_input1;return b.data("suggest")}function simulate_keypress(b,g){var d=g;if(typeof d!=="object")d={keyCode:d};b.simulate("keydown",d);b.simulate("keyup",d);b.simulate("keypress",d)}function simulate_mouseclick(b){b.simulate("mousedown").simulate("mouseup").simulate("mouseclick").click()}
$(function(){function b(d){var e=get_instance();ok(e.pane.hasClass(d.pane),"css.pane");ok(e.status.hasClass(d.status),"css.status");ok(e.list.hasClass(d.list),"css.list");ok(e.flyoutpane.hasClass(d.flyoutpane),"css.flyoutpane");stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){$(">li",e.list).each(function(){$(this).hasClass(d.item);var a=$("."+d.item_name,this);equals(a.length,1);a=$("."+d.item_type,a);equals(a.length,1)});start()}}).val("css").trigger("textchange")}
function g(d,e,a,c){d=$.extend({},default_options,d);test_input1.suggest(d);var f=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){var j=false,h;h=typeof a==="function"?function(k){return a(k)}:function(k){return k.id===a};var i=$(">li",f.list);if(i.length){i.each(function(){var k=$(this).data("data.suggest");if(j=h(k))return false});ok(j);start()}else if(c){ok(c());start()}}).val(e).trigger("textchange")}module("options",module_options);test("css_prefix",function(){var d=
$.extend({},default_options,{css_prefix:"test-"});test_input1.suggest(d);var e={};d=$.extend(true,{},$.suggest.defaults.css,$.suggest.suggest.defaults.css);$.each(d,function(a,c){e[a]="test-"+c});b(e)});test("css",function(){var d={pane:"my-pane",list:"my-list",item:"my-item",item_name:"my-item-name",selected:"my-selected",status:"my-status",item_type:"my-item-type",flyoutpane:"my-flyout-pane"},e=$.extend({},default_options,{css:d});test_input1.suggest(e);b(d)});test("parent",1,function(){var d=$('<div id="parent">');
$(document.body).append(d);var e=$.extend({},default_options,{parent:"#parent"});test_input1.suggest(e);var a=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",a.list).length){equals(a.pane.parent()[0],d[0]);start()}}).val("bob dyl").trigger("textchange")});test("flyout_parent",1,function(){var d=$('<div id="flyout_parent">');$(document.body).append(d);var e=$.extend({},default_options,{flyout_parent:"#flyout_parent"});test_input1.suggest(e);var a=get_instance();
stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){$("li:first",a.list).trigger("mouseover")}).bind("fb-flyoutpane-show",function(){equals(a.flyoutpane.parent()[0],d[0]);start()}).val("stephen colb").trigger("textchange")});test("status[0]",1,function(){var d=$.extend({},default_options,{status:["0","1","2","3"]});test_input1.suggest(d);d=get_instance();test_input1.val("").trigger("textchange");equals(d.status.text(),"0")});test("status[1]",1,function(){var d=$.extend({},default_options,
{status:["0","1","2","3"]});test_input1.suggest(d);d=get_instance();test_input1.val("obama").trigger("textchange");equals(d.status.text(),"1")});test("status[2]",1,function(){var d=$.extend({},default_options,{status:["0","1","2","3"]});test_input1.suggest(d);var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){equals(e.status.text(),"2");start()}}).val("hillary cli").trigger("textchange")});test("status[3]",1,function(){var d=$.extend({},
default_options,{status:["0","1","2","3"]});test_input1.suggest(d);d=get_instance();d.status_error();equals(d.status.text(),"3")});test("zIndex",1,function(){var d=$.extend({},default_options,{zIndex:1E3});test_input1.suggest(d);var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){equals(e.pane.css("z-index"),1E3);start()}).val("shohoku").trigger("textchange")});test("flyout=false",1,function(){var d=$.extend({},default_options,{flyout:false});test_input1.suggest(d);
var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){$("li:first",e.list).trigger("mouseover");if(!e.flyoutpane){ok("flyout not shown");start()}}}).bind("fb-flyoutpane-show",function(){fail("flyout shown when flyout=false");start()}).val("avatar").trigger("textchange")});test("flyout=bottom",1,function(){var d=$.extend({},default_options,{flyout:"bottom"});test_input1.suggest(d);var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",
function(){$("li:first",e.list).trigger("mouseover")}).bind("fb-flyoutpane-show",function(){var a=e.pane.offset(),c=e.flyoutpane.offset();ok(Math.abs(c.top-(a.top+e.pane.height()))<position_threshold);start()}).val("avatar").trigger("textchange")});test("align=left",1,function(){var d=$.extend({},default_options,{align:"left"});test_input1.suggest(d);var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){ok(Math.abs(e.pane.offset().left-test_input1.offset().left)<
position_threshold);start()}}).val("lady ga").trigger("textchange")});test("align=right",1,function(){var d=$.extend({},default_options,{align:"right"});test_input3.suggest(d);var e=get_instance(test_input3);stop(TIMEOUT_DELAY);test_input3.bind("fb-pane-show",function(){if($(">li",e.list).length){var a=e.pane.offset().left+e.pane.width(),c=test_input3.offset().left+test_input3.width();ok(Math.abs(a-c)<position_threshold);start()}}).val("jessica alb").trigger("textchange")});test("suggest_new",1,function(){var d=
$.extend({},default_options,{suggest_new:"suggest_new"});test_input1.suggest(d);var e=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",e.list).length){equals($("button:first",e.pane).text(),"suggest_new");start()}}).val("aplusk").trigger("textchange")});$.each(["(any type:/music/artist)","(any type:/people/person type:/music/artist)","(all type:/music/artist)","(all type:/people/person type:/music/artist)","(should type:/music/artist)","(should type:/people/person)"],
function(d,e){test("filter="+e,1,function(){g({filter:e},bob_dylan_id,bob_dylan_id)})});test("lang [default]",function(){g(null,"/en/seoul",function(d){return d.name==="Seoul"})});test("lang=en",function(){g({lang:"en"},"/en/seoul",function(d){return d.name==="Seoul"})});test("lang=ko",function(){g({lang:"ko"},"/en/seoul",function(d){return d.name.indexOf("\uc11c\uc6b8")!==-1})});test("lang=es,ko",function(){g({lang:"es,ko"},"/en/cheong_wa_dae",function(d){return d.name==="\uccad\uc640\ub300"})});
test("spell=always",function(){var d=$.extend({},default_options,{spell:"always"});test_input1.suggest(d);var e=get_instance(),a=false;stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){var c=$(">li",e.list);if(a&&c.length){ok(true,"Got spell correction results");start()}else if($(".fbs-spell-link",e.pane).length){ok(true,"Found spell/correction");$(".fbs-spell-link",e.pane).click();a=true}}).val("Bob Dylon").trigger("textchange")});test("exact [default]",function(){g(null,"Bob Dylon",
bob_dylan_id)});test("exact=false",function(){g(null,"Bob Dylon",bob_dylan_id)});test("exact=true",function(){g(null,"Bob Dylon",function(){return false},function(){return true})})});
$(function(){module("events",module_options);test("fb-pane-show",1,function(){test_input1.suggest(default_options);var b=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",b.list).length){ok(true,"got fb-pane-show");start()}}).focus().val("bob dylan").trigger("textchange")});test("fb-flyoutpane-show",1,function(){test_input1.suggest(default_options);var b=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-flyoutpane-show",function(){ok(true,"got fb-flyoutpane-show");
start()}).bind("fb-pane-show",function(){$(">li",b.list).length&&$("li:first",b.list).simulate("mouseover")}).focus().val("bob dylan").trigger("textchange")});test("fb-select",2,function(){var b=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(b);var g=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(d,e){ok(e);equals(e.id,bob_dylan_id);start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");
simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val(bob_dylan_id).trigger("textchange")});test("fb-select-new",1,function(){var b=$.extend({},default_options,{suggest_new:"new"});test_input1.suggest(b);var g=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-select-new",function(d,e){equals(e,"bob dylan");start()}).bind("fb-pane-show",function(){$(">li",g.list).length&&$(".fbs-suggestnew",g.pane).click()}).focus().val("bob dylan").trigger("textchange")});test("fb-textchange",1,
function(){test_input1.suggest(default_options);stop(TIMEOUT_DELAY);test_input1.bind("fb-textchange",function(){ok(true,"got fb-textchange");start()}).focus();simulate_keypress(test_input1,68)})});
$(function(){function b(g,d){test("select: "+g,2,function(){var e=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(e);var a=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(c,f){ok(f);equals(f.id,bob_dylan_id);start()}).bind("fb-pane-show",function(){$(">li",a.list).length&&d()}).focus().val(bob_dylan_id).trigger("textchange")})}module("ux",module_options);b("MOUSEOVER MOUSECLICK",function(){var g=get_instance();g=$("li:first",g.list).simulate("mouseover");
simulate_mouseclick(g)});b("MOUSEOVER ENTER",function(){var g=get_instance();$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)});b("ENTER ENTER",function(){simulate_keypress(test_input1,$.simulate.VK_ENTER);simulate_keypress(test_input1,$.simulate.VK_ENTER)});b("DOWN ENTER",function(){simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_ENTER)});b("UP DOWN DOWN ENTER",function(){simulate_keypress(test_input1,$.simulate.VK_UP);
simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_ENTER)});b("CTRL+UP ENTER",function(){simulate_keypress(test_input1,{keyCode:$.simulate.VK_UP,ctrlKey:true});simulate_keypress(test_input1,$.simulate.VK_ENTER)});b("CTRL+DOWN DOWN DOWN ENTER",function(){simulate_keypress(test_input1,{keyCode:$.simulate.VK_DOWN,ctrlKey:true});simulate_keypress(test_input1,$.simulate.VK_DOWN);simulate_keypress(test_input1,$.simulate.VK_DOWN);
simulate_keypress(test_input1,$.simulate.VK_ENTER)});test("select: flyout",2,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(e,a){ok(a);equals(a.id,bob_dylan_id);start()}).bind("fb-flyoutpane-show",function(){simulate_mouseclick(d.flyoutpane)}).bind("fb-pane-show",function(){$(">li",d.list).length&&simulate_keypress(test_input1,$.simulate.VK_DOWN)}).focus().val(bob_dylan_id).trigger("textchange")});
test("suggest_new: SHIFT+ENTER",1,function(){var g=$.extend({},default_options,{suggest_new:"new"});test_input1.suggest(g);var d=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-select-new",function(e,a){equals(a,"bob dylan");start()}).bind("fb-pane-show",function(){$(">li",d.list).length&&simulate_keypress(test_input1,{keyCode:$.simulate.VK_ENTER,shiftKey:true})}).focus().val("bob dylan").trigger("textchange")});test("more: CLICK",1,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});
test_input1.suggest(g);var d=get_instance(),e=false,a=0;stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if(e){ok($(">li",d.list).length>a,"got more");start()}else if(a=$(">li",d.list).length){$(".fbs-more-link",d.pane).click();e=true}}).focus().val("bob dylan").trigger("textchange")});test("more: CTRL+M",1,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance(),e=false,a=0;stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",
function(){if(e){ok($(">li",d.list).length>a,"got more");start()}else if(a=$(">li",d.list).length){simulate_keypress(test_input1,{keyCode:77,ctrlKey:true});e=true}}).focus().val("bob dylan").trigger("textchange")});test("cancel: ESC",2,function(){var g=$.extend({},default_options,{filter:"(any type:/music/artist)"});test_input1.suggest(g);var d=get_instance();stop(TIMEOUT_DELAY);test_input1.bind("fb-pane-show",function(){if($(">li",d.list).length){ok(d.pane.is(":visible"),"pane visible");simulate_keypress(test_input1,
$.simulate.VK_ESC);ok(!d.pane.is(":visible"),"pane NOT visible");start()}}).focus().val("bob dylan").trigger("textchange")})});
$(function(){module("functional",module_options);test("remove",function(){var b=$.extend({},default_options,{type:"/music/artist"});test_input4.suggest(b);b=get_instance(test_input4);var g=b.pane,d=b.flyoutpane;ok(b,"suggest initialized");test_input4.remove();ok(!g.parent().is("body"),"suggest pane not removed");ok(!d.parent().is("body"),"suggest flyoutpane not removed")});test("flyout abort (CLI-10009)",function(){test_input1.suggest(default_options);var b=get_instance();stop(TIMEOUT_DELAY);var g;
test_input1.bind("fb-flyoutpane-show",function(){ok(true,"got fb-flyoutpane-show");ok(b.flyoutpane.html(),"got non-empty flyout pane");start()}).bind("fb-request-flyout",function(){clearTimeout(b.flyout_request.timeout);var d=g.data("data.suggest").id;$.suggest.flyout.cache[d]={id:d};test_input1.unbind("fb-request-flyout").trigger("textchange")}).bind("fb-pane-show",function(){if($(">li",b.list).length){g=$("li:first",b.list);g.simulate("mouseover")}}).focus().val("bob dylan").trigger("textchange")})});
$(function(){var b={teardown:module_options.teardown,response:$.suggest.suggest.prototype.response};module("xss",$.extend({},module_options,{teardown:function(){b.teardown.apply();$.suggest.suggest.prototype.response=b.response}}));test("script_injection",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=function(d){var e=d.result;if(e&&e.length)e[0].name="<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>";return b.response.apply(this,
arguments)};stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(d,e){ok(e);equals(e.name,"<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>");var a=$("#xss");ok(!a.length,"script injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("script_injection strongified",function(){test_input1.suggest(default_options);
var g=get_instance();$.suggest.suggest.prototype.response=function(d){var e=d.result;if(e&&e.length)e[0].name="bob dylan<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>";return b.response.apply(this,arguments)};stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(d,e){ok(e);equals(e.name,"bob dylan<script>$(document.body).append('<div id=\"xss\">XSS</div>')<\/script>");var a=$("#xss");ok(!a.length,"script injection!");start()}).bind("fb-pane-show",function(){if($(">li",
g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("link_injection",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=function(d){var e=d.result;if(e&&e.length)e[0].name='<a href="javascript:alert("XSS");">click me</a>';return b.response.apply(this,arguments)};stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(d,e){ok(e);
equals(e.name,'<a href="javascript:alert("XSS");">click me</a>');var a=$("li:first",g.list);a=$("a",a);ok(!a.length,"link injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")});test("link_injection strongified",function(){test_input1.suggest(default_options);var g=get_instance();$.suggest.suggest.prototype.response=function(d){var e=
d.result;if(e&&e.length)e[0].name='<a href="javascript:alert("XSS");">click me</a>bob dylan';return b.response.apply(this,arguments)};stop(TIMEOUT_DELAY);test_input1.bind("fb-select",function(d,e){ok(e);equals(e.name,'<a href="javascript:alert("XSS");">click me</a>bob dylan');var a=$("li:first",g.list);a=$("a",a);ok(!a.length,"link injection!");start()}).bind("fb-pane-show",function(){if($(">li",g.list).length){$("li:first",g.list).simulate("mouseover");simulate_keypress(test_input1,$.simulate.VK_ENTER)}}).focus().val("bob dylan").trigger("textchange")})});
$(function(){module("advanced",module_options);test("advanced parsing",function(){for(var b=["bob dylan",["bob dylan",[]],"bob dylan type",["bob dylan type",[]],"bob dylan type:",["bob dylan type:",[]],"type:",["type:",[]]," type:album",["",["type:album"]],'bob dylan type:"music artist"',["bob dylan",['type:"music artist"']],"Dear... name{full}:Dear... type:/film/film",["Dear...",["name{full}:Dear...","type:/film/film"]],"Monty Python: Life of Brian",["Monty Python: Life of Brian",[]],"bob dylan a: b  c: d e",
["bob dylan a: b  c: d e",[]],"bob a:b c   d e: f g h:",["bob",["a:b"]],"bob a:b c : d:e",["bob",["a:b","d:e"]]],g=0,d=b.length;g<d;g+=2){var e=b[g+1];same($.suggest.parse_input(b[g]),e)}});test("check_mql_key",function(){$.each(["A","a","0","a-b","0-A-9_","0-","abc","1023","$30DE$30C4$30BF$30B1","$30DEa-z$30C4_$30BF4$30B1-"],function(b,g){ok($.suggest.check_mql_key(g),g)});$.each(["a$001","0.ca","$30DE$30C4$30BF$30B"],function(b,g){ok(!$.suggest.check_mql_key(g),g)})});test("check_mql_id",function(){$.each(["/",
"/freebase","/type/type","/film/film/property","/0/1/2","/A/b_-","/wikipedia/ja/$30DE$30C4$30BF$30B1","/_"],function(b,g){ok($.suggest.check_mql_id(g),g)});$.each(["/freebase/","#9202a8c04000641f80000000010c393g","#00000000000000000000000000000000","foobar","","!/freebase","/A/-"],function(b,g){ok(!$.suggest.check_mql_id(g),g)})})});
